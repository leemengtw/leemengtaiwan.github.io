<!DOCTYPE html>
<!--[if lt IE 9 ]><html class="no-js oldie" lang="zh-hant-tw"> <![endif]-->
<!--[if IE 9 ]><html class="no-js oldie ie9" lang="zh-hant-tw"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html class="no-js" lang="zh-hant-tw">
<!--<![endif]-->

<head>

    <!--- basic page needs
    ================================================== -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Lee Meng" />
<title>LeeMeng - åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–</title>
    <!--- article-specific meta data
    ================================================== -->
        <meta name="description" content="æ‰€è¬‚çš„è³‡æ–™æ¹–æŒ‡çš„æ˜¯ä¸€ä¼æ¥­è£¡é ­æ‰€æœ‰å½¢å¼çš„è³‡æ–™çš„é›†åˆã€‚é€™äº›è³‡æ–™åŒ…å«åŸå§‹è³‡æ–™ï¼Œä»¥åŠç¶“éè½‰æ›çš„è¡ç”Ÿè³‡æ–™ã€‚è³‡æ–™æ¹–çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å°‡æ‰€æœ‰å¯ç”¨çš„è³‡æ–™å…¨éƒ¨æ•´åˆåœ¨ä¸€å€‹é‚è¼¯ä¸Šç›¸è¿‘çš„åœ°æ–¹ä»¥ä¾›ä¼æ¥­è‡ªç”±çµåˆä¸¦åšå„å¼å„æ¨£çš„é‹ç”¨ã€‚è³‡æ–™æ¹–å¯ä»¥ç”¨å¾ˆå¤šæ–¹å¼å»ºç«‹ï¼Œé€™è£æˆ‘å€‘ä¸»è¦ä»‹ç´¹å¦‚ä½•åˆ©ç”¨ Amazon Kinesis å°‡ä¸²æµè³‡æ–™è¼‰å…¥è³‡æ–™æ¹–ã€‚" />
        <meta name="keywords" content="è³‡æ–™å·¥ç¨‹, python, aws, kinesis" />
        <meta name="tags" content="è³‡æ–™å·¥ç¨‹" />
        <meta name="tags" content="python" />
        <meta name="tags" content="aws" />
        <meta name="tags" content="kinesis" />


    <!--- Open Graph Object metas
    ================================================== -->
        <meta property="og:image" content="https://leemeng.tw/theme/images/background/jackson-hendry-435713-unsplash.jpg" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html" />
        <meta property="og:title" content="åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–" />
        <meta property="og:description" content="æ‰€è¬‚çš„è³‡æ–™æ¹–æŒ‡çš„æ˜¯ä¸€ä¼æ¥­è£¡é ­æ‰€æœ‰å½¢å¼çš„è³‡æ–™çš„é›†åˆã€‚é€™äº›è³‡æ–™åŒ…å«åŸå§‹è³‡æ–™ï¼Œä»¥åŠç¶“éè½‰æ›çš„è¡ç”Ÿè³‡æ–™ã€‚è³‡æ–™æ¹–çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å°‡æ‰€æœ‰å¯ç”¨çš„è³‡æ–™å…¨éƒ¨æ•´åˆåœ¨ä¸€å€‹é‚è¼¯ä¸Šç›¸è¿‘çš„åœ°æ–¹ä»¥ä¾›ä¼æ¥­è‡ªç”±çµåˆä¸¦åšå„å¼å„æ¨£çš„é‹ç”¨ã€‚è³‡æ–™æ¹–å¯ä»¥ç”¨å¾ˆå¤šæ–¹å¼å»ºç«‹ï¼Œé€™è£æˆ‘å€‘ä¸»è¦ä»‹ç´¹å¦‚ä½•åˆ©ç”¨ Amazon Kinesis å°‡ä¸²æµè³‡æ–™è¼‰å…¥è³‡æ–™æ¹–ã€‚" />

    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <!--for customized css in individual page-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/bootstrap.min.css">

    <!--for showing toc navigation which slide in from left-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/toc-nav.css">

    <!--for responsive embed youtube video-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/embed_youtube.css">

    <!--for prettify dark-mode result-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/darkmode.css">

    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/base.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/vendor.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/main.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/ipython.css">
    <link rel="stylesheet" type="text/css" href='https://leemeng.tw/theme/css/progress-bar.css' />


    <!--TiqueSearch-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400">
    <link rel="stylesheet" href="https://leemeng.tw/theme/tipuesearch/css/normalize.css">
    <link rel="stylesheet" href="https://leemeng.tw/theme/tipuesearch/css/tipuesearch.css">

    <!-- script
    ================================================== -->
    <script src="https://leemeng.tw/theme/js/modernizr.js"></script>
    <script src="https://leemeng.tw/theme/js/pace.min.js"></script>


    <!-- favicons
    ================================================== -->
    <link rel="shortcut icon" href="../theme/images/favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="../theme/images/favicon.ico" type="image/x-icon"/>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106559980-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106559980-1');
</script>



</head>


<body id="top">

    <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="header-logo">
            <a class="site-logo" href="../index.html"><img src="https://leemeng.tw/theme/images/logo.png" alt="Homepage"></a>
        </div>
<!--navigation bar ref: http://jinja.pocoo.org/docs/2.10/tricks/-->



<nav class="header-nav-wrap">
    <ul class="header-nav">
        <li>
            <a href="../index.html#home">Home</a>
        </li>
        <li>
            <a href="../index.html#about">About</a>
        </li>
        <li>
            <a href="../index.html#projects">Projects</a>
        </li>
        <li class="current">
            <a href="../blog.html">Blog</a>
        </li>
        <li>
            <a href="https://demo.leemeng.tw">Demo</a>
        </li>
        <li>
            <a href="../books.html">Books</a>
        </li>
        <li>
            <a href="../index.html#contact">Contact</a>
        </li>

    </ul>

    <!--<div class="search-container">-->
        <!--<form action="../search.html">-->
            <!--<input type="text" placeholder="Search.." name="search">-->
            <!--<button type="submit"><i class="im im-magnifier" aria-hidden="true"></i></button>-->
        <!--</form>-->
    <!--</div>-->

</nav>
        <a class="header-menu-toggle" href="#0"><span>Menu</span></a>

    </header> <!-- end s-header -->



    <!--TOC navigation displayed when clicked from left-navigation button-->
    <div id="tocNav" class="overlay" onclick="closeTocNav()">
      <div class="overlay-content">
        <div id="toc"><ul><li><a class="toc-href" href="#" title="åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–">åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–</a><ul><li><a class="toc-href" href="#æ¦‚è§€" title="æ¦‚è§€">æ¦‚è§€</a></li><li><a class="toc-href" href="#å»ºæ§‹æµç¨‹" title="å»ºæ§‹æµç¨‹">å»ºæ§‹æµç¨‹</a></li><li><a class="toc-href" href="#å»ºç«‹ä¸€å€‹-Kinesis-data-stream" title="å»ºç«‹ä¸€å€‹ Kinesis data stream">å»ºç«‹ä¸€å€‹ Kinesis data stream</a><ul><li><a class="toc-href" href="#Scalability" title="Scalability">Scalability</a></li><li><a class="toc-href" href="#How-to-scale" title="How to scale">How to scale</a></li><li><a class="toc-href" href="#Availability" title="Availability">Availability</a></li></ul></li><li><a class="toc-href" href="#å»ºç«‹ä¸€å€‹-Firehose-delivery-stream_1" title="å»ºç«‹ä¸€å€‹ Firehose delivery stream">å»ºç«‹ä¸€å€‹ Firehose delivery stream</a><ul><li><a class="toc-href" href="#Configuration" title="Configuration">Configuration</a></li><li><a class="toc-href" href="#é¸æ“‡-delivery-stream-ç›®çš„åœ°" title="é¸æ“‡ delivery stream ç›®çš„åœ°">é¸æ“‡ delivery stream ç›®çš„åœ°</a></li></ul></li><li><a class="toc-href" href="#ç”¨-Python-å‚³ä¸²æµè³‡æ–™_1" title="ç”¨ Python å‚³ä¸²æµè³‡æ–™">ç”¨ Python å‚³ä¸²æµè³‡æ–™</a></li><li><a class="toc-href" href="#ç¢ºèª-S3-ä¸Šçš„è³‡æ–™" title="ç¢ºèª S3 ä¸Šçš„è³‡æ–™">ç¢ºèª S3 ä¸Šçš„è³‡æ–™</a></li><li><a class="toc-href" href="#çµèª" title="çµèª">çµèª</a></li><li><a class="toc-href" href="#References" title="References">References</a></li></ul></li></ul></div>
      </div>
    </div>

    <!--custom images with icon shown on left nav-->
    <!--the details are set in `pelicanconf.py` as `LEFT_NAV_IMAGES`-->

    <article class="blog-single">

        <!-- page header/blog hero, use custom cover image if available
        ================================================== -->
            <div class="page-header page-header--single page-hero" style="background-image:url(https://leemeng.tw/theme/images/background/jackson-hendry-435713-unsplash.jpg)">

            <div class="row page-header__content narrow">
                <article class="col-full">
                    <div class="page-header__info">
                        <div class="page-header__cat">
                            <a href="https://leemeng.tw/tag/zi-liao-gong-cheng.html" rel="tag">è³‡æ–™å·¥ç¨‹</a>
                            <a href="https://leemeng.tw/tag/python.html" rel="tag">python</a>
                            <a href="https://leemeng.tw/tag/aws.html" rel="tag">aws</a>
                            <a href="https://leemeng.tw/tag/kinesis.html" rel="tag">kinesis</a>
                        </div>
                    </div>
                    <h1 class="page-header__title">
                        <a href="https://leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html" title="">
                            åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–
                        </a>
                    </h1>
                    <ul class="page-header__meta">
                        <li class="date">2018-04-04 (Wed)</li>
                        <li class="page-view">
                            2,697 views
                        </li>
                    </ul>

                </article>
            </div>

        </div> <!-- end page-header -->

        <div class="KW_progressContainer">
            <div class="KW_progressBar"></div>
        </div>

        <div class="row blog-content" style="position: relative">
<div id="left-navigation">

    <div id="search-wrap">
        <i class="im im-magnifier" aria-hidden="true"></i>
        <div id="search">
            <form action="../search.html">
            <div class="tipue_search_right"><input type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="æƒ³æœå°‹ä»€éº¼å‘¢ï¼Ÿï¼ˆè«‹è‡³å°‘è¼¸å…¥å…©å€‹å­—ï¼‰" required></div>
            </form>
        </div>
    </div>

    <div id="toc-wrap">
        <a title="é¡¯ç¤º/éš±è— æ–‡ç« ç« ç¯€">
            <i class="im im-menu" aria-hidden="true" onclick="toggleTocNav()"></i>
        </a>
    </div>

    <div id="social-wrap" style="cursor: pointer">
        <a class="open-popup" title="è¨‚é–±æœ€æ–°æ–‡ç« ">
            <i class="im im-newspaper-o" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html" target="_blank" title="åˆ†äº«åˆ° Facebook">
            <i class="im im-facebook" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html&title=%E5%88%A9%E7%94%A8%20Kinesis%20%E8%99%95%E7%90%86%E4%B8%B2%E6%B5%81%E8%B3%87%E6%96%99%E4%B8%A6%E5%BB%BA%E7%AB%8B%E8%B3%87%E6%96%99%E6%B9%96&summary=%E6%89%80%E8%AC%82%E7%9A%84%E8%B3%87%E6%96%99%E6%B9%96%E6%8C%87%E7%9A%84%E6%98%AF%E4%B8%80%E4%BC%81%E6%A5%AD%E8%A3%A1%E9%A0%AD%E6%89%80%E6%9C%89%E5%BD%A2%E5%BC%8F%E7%9A%84%E8%B3%87%E6%96%99%E7%9A%84%E9%9B%86%E5%90%88%E3%80%82%E9%80%99%E4%BA%9B%E8%B3%87%E6%96%99%E5%8C%85%E5%90%AB%E5%8E%9F%E5%A7%8B%E8%B3%87%E6%96%99%EF%BC%8C%E4%BB%A5%E5%8F%8A%E7%B6%93%E9%81%8E%E8%BD%89%E6%8F%9B%E7%9A%84%E8%A1%8D%E7%94%9F%E8%B3%87%E6%96%99%E3%80%82%E8%B3%87%E6%96%99%E6%B9%96%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E6%98%AF%E5%B0%87%E6%89%80%E6%9C%89%E5%8F%AF%E7%94%A8%E7%9A%84%E8%B3%87%E6%96%99%E5%85%A8%E9%83%A8%E6%95%B4%E5%90%88%E5%9C%A8%E4%B8%80%E5%80%8B%E9%82%8F%E8%BC%AF%E4%B8%8A%E7%9B%B8%E8%BF%91%E7%9A%84%E5%9C%B0%E6%96%B9%E4%BB%A5%E4%BE%9B%E4%BC%81%E6%A5%AD%E8%87%AA%E7%94%B1%E7%B5%90%E5%90%88%E4%B8%A6%E5%81%9A%E5%90%84%E5%BC%8F%E5%90%84%E6%A8%A3%E7%9A%84%E9%81%8B%E7%94%A8%E3%80%82%E8%B3%87%E6%96%99%E6%B9%96%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%BE%88%E5%A4%9A%E6%96%B9%E5%BC%8F%E5%BB%BA%E7%AB%8B%EF%BC%8C%E9%80%99%E8%A3%8F%E6%88%91%E5%80%91%E4%B8%BB%E8%A6%81%E4%BB%8B%E7%B4%B9%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%20Amazon%20Kinesis%20%E5%B0%87%E4%B8%B2%E6%B5%81%E8%B3%87%E6%96%99%E8%BC%89%E5%85%A5%E8%B3%87%E6%96%99%E6%B9%96%E3%80%82&source=https%3A//leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html" target="_blank" title="åˆ†äº«åˆ° LinkedIn">
            <i class="im im-linkedin" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://twitter.com/intent/tweet?text=%E5%88%A9%E7%94%A8%20Kinesis%20%E8%99%95%E7%90%86%E4%B8%B2%E6%B5%81%E8%B3%87%E6%96%99%E4%B8%A6%E5%BB%BA%E7%AB%8B%E8%B3%87%E6%96%99%E6%B9%96&url=https%3A//leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html&hashtags=zi-liao-gong-cheng,python,aws,kinesis" target="_blank" title="åˆ†äº«åˆ° Twitter">
            <i class="im im-twitter" aria-hidden="true"></i>
        </a>
    </div>


    <!--custom images with icon shown on left nav-->

</div>

            <div class="col-full blog-content__main">

                <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>æ‰€è¬‚çš„<a href="https://en.wikipedia.org/wiki/Data_lake">è³‡æ–™æ¹– (data lake) </a> æŒ‡çš„æ˜¯ä¸€ä¼æ¥­è£¡é ­æ‰€æœ‰å½¢å¼çš„è³‡æ–™çš„é›†åˆã€‚é€™äº›è³‡æ–™åŒ…å«åŸå§‹è³‡æ–™ (raw data)ï¼Œä»¥åŠç¶“éè½‰æ›çš„è¡ç”Ÿè³‡æ–™ (derived data)ã€‚</p>
<p>è³‡æ–™æ¹–çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å°‡æ‰€æœ‰å¯ç”¨çš„è³‡æ–™å…¨éƒ¨æ•´åˆåœ¨ä¸€å€‹é‚è¼¯ä¸Šç›¸è¿‘çš„åœ°æ–¹ä»¥ä¾›ä¼æ¥­è‡ªç”±çµåˆä¸¦åšå„å¼å„æ¨£çš„é‹ç”¨ã€‚è³‡æ–™æ¹–å¯ä»¥ç”¨å¾ˆå¤šæ–¹å¼å»ºç«‹ï¼Œé€™è£æˆ‘å€‘ä¸»è¦ä»‹ç´¹å¦‚ä½•åˆ©ç”¨ <a href="https://aws.amazon.com/tw/kinesis/">Amazon Kinesis</a> å°‡ä¸²æµè³‡æ–™ (streaming data) è¼‰å…¥è³‡æ–™æ¹–ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="æ¦‚è§€">æ¦‚è§€<a class="anchor-link" href="#æ¦‚è§€">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>è³‡æ–™æ¹–æ¦‚å¿µä¸Šå¯ä»¥èªªæ˜¯ä¼æ¥­çš„æ‰€æœ‰è³‡æ–™çš„æœ€çµ‚ç›®çš„åœ°ã€‚ç¾åœ¨å‡è¨­æˆ‘å€‘æ‰“ç®—ä»¥ <a href="https://aws.amazon.com/tw/s3/">Amazon S3</a> ä¸­ä½œç‚ºæˆ‘å€‘çš„è³‡æ–™æ¹–ï¼Œå•é¡Œå°±è®Šæˆï¼šè¦å¦‚ä½•å°‡ä¸²æµè³‡æ–™ç©©å®šåœ°å‚³åˆ° S3ã€‚é€™éƒ¨åˆ†æˆ‘å€‘å°‡é€é <a href="https://aws.amazon.com/tw/kinesis/">Amazon Kinesis</a> ä¾†é”æˆã€‚ Kinesis æœ¬è³ªä¸Šæ˜¯è·Ÿ <a href="https://kafka.apache.org/">Apache Kafka</a> é¡ä¼¼çš„ <a href="https://en.wikipedia.org/wiki/Message_broker">message broker</a>ï¼Œå°‡è¨Šæ¯ä¾ç…§ message producers ç”¢ç”Ÿçš„é †åºå‚³éçµ¦ message consumersã€‚å¯¦éš›ä¸Šè³‡æ–™çš„æµå‹•æœƒå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="https://leemeng.tw/images/kinesis/simple-streaming-data-flow.png" style="mix-blend-mode: initial;width:80%;"/>
</center>
<center>
                        Simple Dataflowï¼šå°‡ streaming data é€é Kinesis ä¿å­˜åœ¨ S3
                        <br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ä¸Šåœ–æœ‰å¹¾é»å€¼å¾—èªªæ˜ï¼š</p>
<ul>
<li>ä½œç‚ºä¸€å€‹ç°¡æ˜“çš„ demoï¼Œé€™é‚Šæˆ‘å€‘çš„ä¸²æµè³‡æ–™ç”¢ç”Ÿè€… (streaming data producer) æ˜¯ä¸€å€‹ç°¡æ˜“ python script</li>
<li>Streams æŒ‡çš„æ˜¯ <a href="https://aws.amazon.com/tw/kinesis/data-streams/">Amazon Kinesis Data Streams</a>ã€‚åœ¨ Kinesis æ¶æ§‹è£¡é ­ï¼Œä¸€å€‹ data stream é€šå¸¸ä»£è¡¨ä¸€å€‹ä¸»é¡Œ (topic)ï¼Œ
è·Ÿé€™å€‹ä¸»é¡Œç›¸é—œçš„ producers æœƒæŠŠè³‡æ–™å‚³å…¥è©² stream ä»¥è®“è©²ä¸»é¡Œçš„ consumers ä¹‹å¾Œèƒ½æ¥å—è¨Šæ¯ã€‚</li>
<li>Firehose æŒ‡çš„æ˜¯ <a href="https://aws.amazon.com/tw/kinesis/data-firehose/">Amazon Kinesis Data Firehose</a>ï¼Œæ˜¯å°ˆé–€æŠŠæ¥å—åˆ°çš„ä¸²æµè³‡æ–™å¯«å…¥ AWS ä¸Šçš„è³‡æ–™å­˜æ”¾å€ï¼ˆå¦‚ S3ã€Redshiftã€ElasticSearchï¼‰ä»¥ä¾›å¾ŒçºŒåˆ†æçš„æœå‹™ã€‚</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="å»ºæ§‹æµç¨‹">å»ºæ§‹æµç¨‹<a class="anchor-link" href="#å»ºæ§‹æµç¨‹">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>è¦å®Œæˆä¸Šè¿°çš„è³‡æ–™å‚³è¼¸ pipelineï¼Œæˆ‘å€‘æœƒ follow ä»¥ä¸‹æ­¥é©Ÿï¼š</p>
<ul>
<li><a href="#å»ºç«‹ä¸€å€‹-Kinesis-data-stream">å»ºç«‹ä¸€å€‹ Kinesis data stream</a></li>
<li><a href="#å»ºç«‹ä¸€å€‹-Firehose-delivery-stream">å»ºç«‹ä¸€å€‹ Firehose delivery stream</a></li>
<li><a href="#ç”¨-Python-å‚³ä¸²æµè³‡æ–™">ç”¨ Python å‚³ä¸²æµè³‡æ–™</a></li>
<li><a href="#ç¢ºèª-S3-ä¸Šçš„è³‡æ–™">ç¢ºèª S3 ä¸Šçš„è³‡æ–™</a></li>
</ul>
<p>åœ¨æ¯å€‹æ­¥é©Ÿè£¡é ­æœƒç¨å¾®æ¾„æ¸…ä¸€äº›æ¦‚å¿µã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="å»ºç«‹ä¸€å€‹-Kinesis-data-stream">å»ºç«‹ä¸€å€‹ Kinesis data stream<a class="anchor-link" href="#å»ºç«‹ä¸€å€‹-Kinesis-data-stream">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç¾åœ¨å‡è¨­æœ‰ä¸€å€‹åç‚º naive-app çš„æ‡‰ç”¨ç¨‹å¼ï¼Œæˆ‘å€‘æƒ³è¦æŠŠä½¿ç”¨è€…åœ¨ä¸Šé¢åšçš„æ“ä½œç´€éŒ„ä¸‹ä¾†ã€‚é€™æ™‚å€™æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹æ–°çš„ Kinesis Data Stream ä¾†æ¥å— app çš„ streaming dataã€‚é€™é‚ŠæŒ‡çš„ streaming data æ˜¯ä½¿ç”¨è€…å­˜å–æ‡‰ç”¨ç¨‹å¼æ™‚ç”¢ç”Ÿçš„ access logã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<img src="https://leemeng.tw/images/kinesis/create-kinesis-stream.png" style="mix-blend-mode: initial;width:80%;"/>
<br/>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scalability">Scalability<a class="anchor-link" href="#Scalability">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>é€™é‚Šæœ€é‡è¦çš„æ˜¯ <code>Number of shards</code> çš„è¨­å®šã€‚Kinesis å°‡æ¥æ”¶åˆ°çš„è³‡æ–™ä»¥ log çš„æ–¹å¼å„²å­˜åœ¨ç¡¬ç¢Ÿä¸Šï¼Œè€Œç‚ºäº†æé«˜ scalabilityï¼ŒKinesis åˆ©ç”¨ Partitioning çš„æ¦‚å¿µå°‡ log åˆ‡å‰²æˆå¤šå€‹éƒ¨åˆ†ä¸¦åˆ†é…åˆ°ä¸åŒçš„ shards ä¸Šï¼Œå†å°‡é€™äº› shards åˆ†åˆ¥å­˜åœ¨ä¸åŒæ©Ÿå™¨ä¸Šé¢ä»¥æé«˜ read/write capacityã€‚å› æ­¤æˆ‘å€‘å¯ä»¥ç†è§£ä¸€å€‹ Kinesis Stream (Topic) çš„è³‡æ–™ååé‡ (throughput) ç›´æ¥å—åˆ° shard çš„æ•¸ç›®å½±éŸ¿ï¼š shard æ•¸ç›®è¶Šå¤šï¼ŒåŒæ™‚èƒ½è™•ç† read/write çš„æ©Ÿå™¨è¶Šå¤šï¼Œè³‡æ–™ååé‡è¶Šé«˜ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-to-scale">How to scale<a class="anchor-link" href="#How-to-scale">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç†æƒ³ä¸Šæ˜¯ä¸€é–‹å§‹å°±æŒæ¡è©² Stream/Topic éœ€è¦çš„è³‡æ–™ååé‡ï¼Œé€²è€Œæ±ºå®šæœ€ä½³çš„ <code>Number of shards</code> ï¼Œä½†æœ‰æ™‚å€™äº‹èˆ‡é¡˜é•ã€‚äº‹å¾Œæƒ³è¦æ”¹è®Š shard æ•¸ç›®æ™‚éœ€è¦é€é <a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/">AWS Streams API</a> åš Reshardingã€‚Resharding å¯¦éš›ä¸Šå°±æ˜¯åœ¨æ”¹è®Š shard æ•¸ç›®ï¼šå¢åŠ  shard æœƒè®“å·²å­˜åœ¨çš„ shard å†åº¦è¢«åˆ‡å‰²ï¼›æ¸›å°‘ shard å‰‡æœƒåˆä½µå·²å­˜åœ¨çš„ shardã€‚</p>
<p>åœ¨é€™é‚Šæˆ‘å€‘å°±åªç›´æ¥ä½¿ç”¨ä¸€å€‹ shard for demoã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Availability">Availability<a class="anchor-link" href="#Availability">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ Kinesis ç‚ºäº†é¿å…è³‡æ–™æå¤±ï¼Œæœƒåœ¨ä¸‰å€‹ä¸åŒçš„ availability zones é€²è¡Œè³‡æ–™çš„ replicationã€‚å› ç‚ºé€™å€‹é¡å¤–çš„ overhead å¯èƒ½ä½¿å¾—åœ¨åŒæ¨£è¨­å®šä¸‹ï¼Œ <a href="https://www.opsclarity.com/evaluating-message-brokers-kafka-vs-kinesis-vs-sqs/">Kinesis æ¯” Kafka æ…¢</a> çš„æƒ…æ³ã€‚å› ç‚ºæ˜¯ log-based message brokerï¼Œè³‡æ–™æœƒè¢«æš«æ™‚å­˜åœ¨ç¡¬ç¢Ÿä¸Šï¼Œé è¨­ä¿ç•™ 24 å°æ™‚ï¼Œè€Œæœ€å¤šå¯ä»¥ä»˜è²»æå‡åˆ°ç¶­æŒ 7 å¤©ä»¥ç”¨ä¾† replay dataã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="å»ºç«‹ä¸€å€‹-Firehose-delivery-stream_1">å»ºç«‹ä¸€å€‹ Firehose delivery stream<a class="anchor-link" href="#å»ºç«‹ä¸€å€‹-Firehose-delivery-stream">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>æœ‰äº†æ¥å— naive-app ä¸²æµè³‡æ–™çš„ Kinesis stream ä»¥å¾Œï¼Œæˆ‘å€‘è¦å»ºç«‹ä¸€å€‹ Firehose delivery stream ä¾†æ¥æ”¶ Kinesis stream çš„è³‡æ–™ã€‚</p>
<p>Firehouse delivery stream ç°¡å–®ä¾†èªªæ˜¯ä¸€å€‹å°‡ä¸²æµè³‡æ–™å­˜åˆ° AWS è³‡æ–™å­˜æ”¾å€çš„æœå‹™ï¼ˆå¦‚ S3ã€Redshiftã€ElasticSearchï¼‰ã€‚å› æ­¤é™¤äº† <a href="https://aws.amazon.com/tw/about-aws/whats-new/2017/08/amazon-kinesis-firehose-can-now-read-data-directly-from-amazon-kinesis-streams/">Kinesis stream çš„ä¸²æµè³‡æ–™</a>ä»¥å¤–ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥æ¥å…¶ä»–çš„ä¸²æµè³‡æ–™ï¼š</p>
<ul>
<li>CloudWatch çš„ log </li>
<li>AWS IoT</li>
<li>ä½¿ç”¨è€…è‡ªå®šç¾©çš„ä¸²æµè³‡æ–™</li>
</ul>
<p>åœ¨é€™ç¯‡è£¡é ­æˆ‘å€‘çš„ä¸²æµè³‡æ–™æ˜¯ Kinesis streamï¼Œå› æ­¤ Source é¸æ“‡ <code>Kinesis stream</code> ä¸¦å¡«å…¥æˆ‘å€‘å‰›å‰›å»ºç«‹çš„ stream åç¨±ï¼š <code>naive-app-access-log</code>ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<img src="https://leemeng.tw/images/kinesis/create-delivery-stream.png" style="mix-blend-mode: initial;width:80%;"/>
<br/>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å€¼å¾—ä¸€æçš„æ˜¯ Firehose delivery stream æœƒ auto-scaleï¼Œä¸¦ä¸åƒ Kinesis stream è¦æ‰‹å‹•èª¿æ•´ shard æ•¸ç›®ã€‚ä¸éç•¶ç„¶å‚³è¶Šå¤šèŠ±è¶Šå¤šã€‚</p>
<p>å¦‚ä¸Šå¼µåœ–æ‰€ç¤ºï¼Œå¯¦éš›ä¸Š Firehose é‚„å…è¨±æˆ‘å€‘åœ¨ delivery stream æ¥å—åˆ°ä¸²æµè³‡æ–™ä»¥å¾ŒæŠŠåŸå§‹è³‡æ–™å‚³åˆ°æŒ‡å®šçš„ <a href="https://aws.amazon.com/tw/lambda/">Lambda function</a> åšé€²ä¸€æ­¥çš„è½‰æ›ã€‚
ä½†å› ç‚ºæˆ‘å€‘æƒ³è¦è³‡æ–™æ¹–å„²å­˜åŸå§‹çš„ä¸²æµè³‡æ–™ï¼Œé€™é‚Šæˆ‘å€‘çœç•¥é€™æ­¥é©Ÿã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configuration">Configuration<a class="anchor-link" href="#Configuration">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¯¦éš›ä¸Š Firehose ä¸æœƒä¸€æ¥æ”¶åˆ°è³‡æ–™å°±é€²è¡Œè³‡æ–™è½‰ç§»ã€‚æˆ‘å€‘å¯ä»¥è¨­å®š Buffer size ä»¥åŠ Buffer interval è®“ Firehose åœ¨é”åˆ°å…¶ä¸­ä¸€å€‹æ¢ä»¶çš„æ™‚å€™æŠŠæ¥æ”¶åˆ°çš„è¨Šæ¯çµ±æ•´èµ·ä¾†ä¸€æ¬¡åšè³‡æ–™çš„è½‰ç§» (batch processing)ã€‚é€™é‚Šç‚ºäº†èƒ½è®“ Firehose ç›¡å¿«æŠŠæ”¶åˆ°çš„è³‡æ–™è½‰ç§»åˆ° S3ï¼Œè¨­å®š Buffer interval ç‚º <code>60</code> ç§’ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<img src="https://leemeng.tw/images/kinesis/firehose-configure-settings.png" style="mix-blend-mode: initial;width:80%;"/>
<br/>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="é¸æ“‡-delivery-stream-ç›®çš„åœ°">é¸æ“‡ delivery stream ç›®çš„åœ°<a class="anchor-link" href="#é¸æ“‡-delivery-stream-ç›®çš„åœ°">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>åœ¨è¨­å®šå¥½ Firehose delivery stream çš„ä¸²æµè³‡æ–™ä¾†æºï¼ˆe.g., Kinesis streamï¼‰ä»¥åŠåŸºæœ¬è¨­å®šä»¥å¾Œï¼Œæˆ‘å€‘è¦æ±ºå®šä¸²æµè³‡æ–™çš„ç›®çš„åœ°ã€‚é€™é‚ŠåŸºæœ¬ä¸Šå¾ˆç›´è¦ºï¼Œ Destination é¸æ“‡ <code>Amazon S3</code> ä»¥åŠæƒ³è¦æ”¾è³‡æ–™çš„ bucket å³å¯ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<img src="https://leemeng.tw/images/kinesis/firehose-select-destination.png" style="mix-blend-mode: initial;width:80%;"/>
<br/>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>æ¯”è¼ƒéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘å€‘å¯ä»¥æŒ‡å®šæ­¤ Firehose delivery stream åœ¨æ”¾è³‡æ–™é€²å…¥ bucket æ™‚è¦ç‚ºæª”æ¡ˆåŠ ä»€éº¼å‰ç¶´ã€‚</p>
<p>å‡è¨­æœªä¾†å…¶ä»–çš„ä¸²æµè³‡æ–™æˆ‘å€‘ä¹Ÿæƒ³è¦çµ±ä¸€æ”¾åœ¨ <code>me-data-lake</code> é€™å€‹ bucket è£¡é ­ã€‚ç‚ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘å€‘å¯ä»¥ç‚ºæ¯å€‹ delivery stream è¨­å®šä¸€å€‹è­˜åˆ¥ç”¨çš„ Prefixã€‚ä»¥ naive-app ä¾†èªªï¼Œæˆ‘å€‘æŒ‡å®š Prefix ç‚º <code>naive-app-access-log/</code> ã€‚åŠ ä¸Š Firehose é è¨­çš„ <code>YYYY/MM/DD/HH/</code> ï¼Œè©² stream çš„æ¯å€‹æª”æ¡ˆçš„è·¯å¾‘å°±æœƒè®Šæˆå¦‚ä¸‹åœ–çš„ <code>naive-app-access-log/YYYY/MM/DD/HH/file_name</code>ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="https://leemeng.tw/images/kinesis/s3-bucket-path.png" style="mix-blend-mode: initial;width:80%;"/>
</center>
<center>
                        åŠ å…¥ Prefix å¾Œå¯¦éš›å°‡ä¸²æµè³‡æ–™å­˜å…¥ S3 æ™‚çš„æª”æ¡ˆè·¯å¾‘
                        <br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ç”¨-Python-å‚³ä¸²æµè³‡æ–™_1">ç”¨ Python å‚³ä¸²æµè³‡æ–™<a class="anchor-link" href="#ç”¨-Python-å‚³ä¸²æµè³‡æ–™">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç¢ºä¿ Kinesis stream -&gt; Firehose delivery stream -&gt; S3 çš„è³‡æ–™æµè¨­å®šä»¥å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¯«ä¸€å€‹ç°¡å–®çš„ Python script å¯¦éš›å‚³è³‡æ–™é€² Kinesis stream åšæ¸¬è©¦ã€‚ä½†é¦–å…ˆå…ˆè®“æˆ‘å€‘ä½¿ç”¨ <a href="https://boto3.readthedocs.io/en/latest/">AWS SDK for Python</a> å¯¦ä½œä¸€å€‹å¯„è¨Šæ¯çµ¦ Kinesis stream çš„ function <code>write_to_stream</code> ï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">def</span> <span class="nf">write_to_stream</span><span class="p">(</span><span class="n">event_id</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">region_name</span><span class="p">,</span> <span class="n">stream_name</span><span class="p">):</span>
    <span class="sd">"""Write streaming event to specified Kinesis Stream within specified region.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    event_id: str</span>
<span class="sd">        The unique identifer for the event which will be needed in partitioning.</span>
<span class="sd">    event: dict</span>
<span class="sd">        The actual payload including all the details of the event.</span>
<span class="sd">    region_name: str</span>
<span class="sd">        AWS region identifier, e.g., "ap-northeast-1".</span>
<span class="sd">    stream_name: str</span>
<span class="sd">        Kinesis Stream name to write.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: Response returned by `put_record` func defined in boto3.client('kinesis')</span>
<span class="sd">    """</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'kinesis'</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region_name</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put_record</span><span class="p">(</span>
        <span class="n">StreamName</span><span class="o">=</span><span class="n">stream_name</span><span class="p">,</span>
        <span class="n">Data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span>
        <span class="n">PartitionKey</span><span class="o">=</span><span class="n">event_id</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>write_to_stream</code> åŸºæœ¬ä¸Šæ˜¯æŠŠä¸€å€‹ Python dict <code>event</code> åˆ©ç”¨ <code>json.dumps</code> è½‰æˆå­—ä¸²å¾Œå‚³åˆ°æŒ‡å®šçš„ region çš„ Kinesis stream è£¡çš„å‡½å¼ã€‚ï¼ˆå®Œæ•´çš„ <a href="https://gist.github.com/leemengtaiwan/b5edca45e12664164e6634d6fe24d913">Gist</a> ï¼‰</p>
<p>é€™é‚Šå€¼å¾—æ³¨æ„çš„æ˜¯ <code>Data=json.dumps(event) + '\n'</code> è£¡é ­çš„ <code>'\n'</code> ã€‚å¦‚æœä¹‹å¾Œæƒ³è¦åˆ©ç”¨ <a href="https://aws.amazon.com/tw/glue/">AWS Glue</a> æˆ–è€… <a href="https://aws.amazon.com/tw/athena/">Athena</a> ä¾†é€²ä¸€æ­¥åˆ†ææ­¤ä¸²æµè³‡æ–™çš„è©±ï¼Œæ¨è–¦åœ¨ä»£è¡¨ä¸€å€‹ event çš„å­—ä¸²å¾Œé¢åŠ ä¸Šæ›è¡Œç¬¦è™Ÿä»¥ç¶­æŒã€Œä¸€è¡Œä¸€äº‹ä»¶ã€çš„è³‡æ–™å½¢å¼ï¼Œæ–¹ä¾¿ schema çš„è‡ªå‹•ç”¢ç”Ÿã€‚</p>
<p>ç¯„ä¾‹æ—¥èªŒæª”æ¡ˆå…§å®¹æœƒåƒæ˜¯é€™æ¨£ï¼š</p>
<div class="highlight"><pre><span></span>{"event_id": "56262", "timestamp": 1522740951, "event_type": "write_post"}
{"event_id": "35672", "timestamp": 1522740956 ...
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯å› ç‚º Kinesis èƒŒå¾Œæ˜¯ä½¿ç”¨ <a href="https://docs.aws.amazon.com/streams/latest/dev/key-concepts.html">Hash partitioning</a> ä¾†åˆ†é…è³‡æ–™åˆ° shardï¼ŒåŸºæœ¬ä¸Š <code>PartitionKey=event_id</code> è£¡é ­çš„ <code>event_id</code> åªè¦æ¯å€‹è¨Šæ¯éƒ½æ˜¯ç¨ä¸€ç„¡äºŒçš„ï¼Œå°±èƒ½ä¿è­‰è³‡æ–™èƒ½ã€Œå¹³å‡åœ°ã€åˆ†é…åˆ°å„å€‹ shard ä¸Šã€‚</p>
<p>æœ‰äº†æ­¤å‡½å¼ä»¥å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¯¦éš›å‚³ä¸€äº›è¨Šæ¯é€² Kinesis streamï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"event_id"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)),</span>
        <span class="s2">"event_type"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">'read_post'</span><span class="p">,</span> <span class="s1">'write_post'</span><span class="p">,</span> <span class="s1">'make_comments'</span><span class="p">]),</span>
        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="c1"># send to Kinesis Stream</span>
    <span class="n">event_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">'event_id'</span><span class="p">]</span>
    <span class="n">write_to_stream</span><span class="p">(</span><span class="n">event_id</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">REGION_NAME</span><span class="p">,</span> <span class="n">KINESIS_STREAM_NAME</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å‡è¨­æˆ‘å€‘çš„ naive-app å¯ä»¥è®“ä½¿ç”¨è€…è®€æ–‡ç« ã€å¯«æ–‡ç« ä»¥åŠå¯«è©•è«–ï¼Œå‰‡ä¸Šé¢çš„ç¨‹å¼ç¢¼æ˜¯æ¨¡æ“¬ä½¿ç”¨è€…ä½¿ç”¨ naive-app æ™‚ç”¢ç”Ÿçš„äº‹ä»¶ï¼Œä¸¦å°‡è©²äº‹ä»¶çš„å…§å®¹å‚³åˆ° Kinesis stream <code>naive-app-access-log</code>ã€‚60 ç§’å…§å¹¾ç­†ç”¢ç”Ÿçš„äº‹ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span>{'event_id': '56262', 'event_type': 'write_post', 'timestamp': 1522740951}
{'event_id': '35672', 'event_type': 'make_comments', 'timestamp': 1522740956}
{'event_id': '71613', 'event_type': 'read_post', 'timestamp': 1522740962}
{'event_id': '48160', 'event_type': 'make_comments', 'timestamp': 1522740967}
{'event_id': '96093', 'event_type': 'write_post', 'timestamp': 1522740972}
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ç¢ºèª-S3-ä¸Šçš„è³‡æ–™">ç¢ºèª S3 ä¸Šçš„è³‡æ–™<a class="anchor-link" href="#ç¢ºèª-S3-ä¸Šçš„è³‡æ–™">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>æ³¨æ„å› ç‚ºä¸Šé¢çš„ 5 å€‹äº‹ä»¶åœ¨ $5 * 5 = 25$ ç§’å…§å°±ç”¢ç”Ÿäº†ã€‚ä¸”å› ç‚ºæˆ‘å€‘å‰é¢è¨­å®š Firehose delivery stream çš„ Buffer interval ç‚º 60 ç§’ï¼ŒFirehose æœƒæŠŠä»¥ä¸Šçš„äº‹ä»¶çš„è¨Šæ¯å…¨éƒ¨ä¸²æ¥èµ·ä¾†ï¼Œæ”¾åˆ°ä¸€å€‹æª”æ¡ˆè£¡é ­ï¼Œè€Œä¸æ˜¯åˆ†æˆäº”å€‹æª”æ¡ˆï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="https://leemeng.tw/images/kinesis/s3-bucket-path.png" style="mix-blend-mode: initial;width:80%;"/>
</center>
<center>
                        åŠ å…¥ Prefix å¾Œå¯¦éš›å°‡ä¸²æµè³‡æ–™å­˜å…¥ S3 æ™‚çš„æª”æ¡ˆè·¯å¾‘
                        <br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>è€Œå¯¦éš›æª”æ¡ˆçš„å…§å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span>{"event_id": "56262", "timestamp": 1522740951, "event_type": "write_post"}
{"event_id": "35672", "timestamp": 1522740956 ...
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="çµèª">çµèª<a class="anchor-link" href="#çµèª">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>åˆ°é€™é‚Šç‚ºæ­¢æˆåŠŸæŠŠï¼ˆå½ï¼‰ä¸²æµè³‡æ–™é€é Kinesis å­˜åˆ° S3 äº†ï¼ç‚ºäº†æ–¹ä¾¿ä¹‹å¾Œçš„æ‡‰ç”¨ï¼Œè¼¸å‡ºçš„æª”æ¡ˆçš„å…§å®¹æ ¼å¼æˆ–è¨±é‚„å¯ä»¥å†æ”¹é€²ï¼Œä½†è³‡æ–™æ¹–çš„å…¶ä¸­ä¸€å€‹æƒ³æ³•æ˜¯ <a href="https://www.youtube.com/watch?v=JHGkaShoyNs">Command Query Responsibility Segregation (CQRS)</a>ï¼Œä¹Ÿå°±æ˜¯åœ¨å­˜æ”¾è³‡æ–™çš„æ™‚å€™å°±åªå°ˆå¿ƒä¸Ÿè³‡æ–™ï¼Œä¸å»åœ¨æ„ä¹‹å¾Œè³‡æ–™æœƒè¢«ä»¥ä»€éº¼æ–¹å¼ã€schema ä½¿ç”¨ï¼Œå¯ä»¥ä¿è­‰ä¹‹å¾Œå¯¦éš›æ‡‰ç”¨è³‡æ–™æ™‚æœ‰æœ€å¤§çš„å½ˆæ€§ã€‚</p>
<p>å¦å¤–åœ¨ç¢ºä¿è³‡æ–™å¥½å¥½åœ°å„²å­˜åœ¨è³‡æ–™æ¹–ä»¥å¾Œï¼Œæˆ‘å€‘é€šå¸¸æœƒå¯¦éš›é‡å°ä¸²æµè³‡æ–™å†é€²è¡Œä¸€äº›è™•ç† / åˆ†æåƒæ˜¯ï¼š</p>
<ul>
<li><a href="https://aws.amazon.com/tw/blogs/big-data/building-a-near-real-time-discovery-platform-with-aws/">æ”¾åˆ° Elasticsearch ä¸¦ç”¨ Kibana åš Visualization</a></li>
<li>è§¸ç™¼ Lambda function åšé€²ä¸€æ­¥è™•ç†</li>
<li>ä½¿ç”¨ Athena åš ad-hoc åˆ†æ</li>
<li>...</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="https://leemeng.tw/images/kinesis/kinesis-firehose-intro.png" style="mix-blend-mode: initial;width:80%;"/>
</center>
<center>
                        åŠ å…¥ Prefix å¾Œå¯¦éš›å°‡ä¸²æµè³‡æ–™å­˜å…¥ S3 æ™‚çš„æª”æ¡ˆè·¯å¾‘
                        <br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ä½†é€™é‚Šæ™‚é–“æœ‰é™ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒå†ä¾†è¨˜éŒ„è³‡æ–™æ¹–ä¹‹å¾Œçš„åˆ†æç­†è¨˜ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="https://www.youtube.com/watch?v=814aUb5n_Fk">Youtube: Introduction to Amazon Kinesis Firehose</a></li>
<li><a href="https://www.sumologic.com/blog/devops/kinesis-streams-vs-firehose/">sumologic - Kinesis Stream vs Firehose</a></li>
<li><a href="https://acloud.guru/forums/aws-certified-big-data-specialty/discussion/-KhI3MgPEo-FY5rfgl3J/what_is_difference_between_kin">A Cloud Guru - difference betwwen Kinesis Streams and Kinesis Firehose</a></li>
<li><a href="https://www.arundhaj.com/blog/getting-started-kinesis-python.html">Getting started with AWS Kinesis using Python</a></li>
<li><a href="https://www.opsclarity.com/evaluating-message-brokers-kafka-vs-kinesis-vs-sqs/">opsclarity - Evaluating Message Brokers: Kafka vs. Kinesis vs. SQS</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
</div>
<div class="cell border-box-sizing code_cell rendered">
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>


                <!-- Tags -->
                <p class="blog-content__tags">
                    <span>Post Tags</span>

                    <span class="blog-content__tag-list">
                        <a href="https://leemeng.tw/tag/zi-liao-gong-cheng.html" rel="tag">è³‡æ–™å·¥ç¨‹</a>
                        <a href="https://leemeng.tw/tag/python.html" rel="tag">python</a>
                        <a href="https://leemeng.tw/tag/aws.html" rel="tag">aws</a>
                        <a href="https://leemeng.tw/tag/kinesis.html" rel="tag">kinesis</a>
                    </span>

                </p>



































































                <!-- end Tags -->


                <!-- Mail-list-subscribe -->
                <div id="article-inner-subscribe" class="blog-content__pagenav">
                    <div class="blog-content__nav">
                        <div class="blog-content__prev">
                            <a class="open-popup" rel="subscribe">
                                <span>Get Latest Arrivals</span>
                                è¨‚é–±æœ€æ–°æ–‡ç« 
                            </a>
                        </div>
                        <div class="blog-content__next">
                            <p>
                                è·Ÿè³‡æ–™ç§‘å­¸ç›¸é—œçš„æœ€æ–°æ–‡ç« ç›´æ¥é€åˆ°å®¶ã€‚</br>
                                åªè¦åŠ å…¥è¨‚é–±åå–®ï¼Œç•¶æ–°æ–‡ç« å‡ºçˆæ™‚ï¼Œ</br>
                                ä½ å°‡èƒ½é¦¬ä¸Šæ”¶åˆ°é€šçŸ¥ <i class="im im-newspaper-o" aria-hidden="true"></i>
                            </p>
                        </div>
                    </div>
                    <div class="blog-content__all">
                        <a class="open-popup btn btn--primary ">&nbsp;&nbsp;Subscribe&nbsp;&nbsp;&nbsp;</a>
                    </div>
                </div>
                <!-- end Mail-list-subscribe -->

                <!--Pagination-->
                <div id="article-inner-neighbor-pages" class="blog-content__pagenav">
                    <div class="blog-content__nav">
                        <div class="blog-content__prev">
                            <a href="https://leemeng.tw/data-visualization-from-matplotlib-to-ggplot2.html" rel="prev">
                                <span>Previous Post</span>
                                æ·ºè«‡è³‡æ–™è¦–è¦ºåŒ–ä»¥åŠ ggplot2 å¯¦è¸
                            </a>
                        </div>
                        <div class="blog-content__next">
                            <a href="https://leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html" rel="next">
                                <span>Next Post</span>
                                AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift
                            </a>
                        </div>
                    </div>

                    <div class="blog-content__all">
                        <a href="blog.html" class="btn btn--primary">
                            View All Post
                        </a>
                    </div>
                </div>
                <!-- end Pagination-->

            </div><!-- end blog-content__main -->


        </div>
        </div> <!-- end blog-content -->

    </article>

<div class="comments-wrap">
    <div id="comments" class="row">
        <div class="col-full">
            <div id="disqus_thread"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
var disqus_shortname = 'leemengtaiwan';
var disqus_title = 'åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–';

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<!-- footer
================================================== -->
<footer style="background:#0a0809">
    <div class="row">
        <div class="col-full">

            <div class="footer-logo">
                <a class="footer-site-logo" href="#0"><img src="https://leemeng.tw/theme/images/logo.png" alt="Homepage"></a>
            </div>

            <ul class="footer-social">
<li><a href="https://github.com/leemengtaiwan" target="_blank">
    <i class="im im-github" aria-hidden="true"></i>
    <span>Github</span>
</a></li>
<li><a href="https://www.facebook.com/LeeMengTaiwan" target="_blank">
    <i class="im im-facebook" aria-hidden="true"></i>
    <span>Facebook</span>
</a></li>
<li><a href="https://www.instagram.com/leemengtaiwan/" target="_blank">
    <i class="im im-instagram" aria-hidden="true"></i>
    <span>Instagram</span>
</a></li>
<li><a href="https://www.linkedin.com/in/leemeng1990/" target="_blank">
    <i class="im im-linkedin" aria-hidden="true"></i>
    <span>LinkedIn</span>
</a></li>            </ul>
        </div>
    </div>
    <div class="row footer-bottom">
        <div class="col-twelve">
            <div class="go-top">
            <a class="smoothscroll" title="Back to Top" href="#top"><i class="im im-arrow-up" aria-hidden="true"></i></a>
            </div>
        </div>
    </div> <!-- end footer-bottom -->
</footer> <!-- end footer -->


        <!-- Javascript
    ================================================== -->
    <script src="https://leemeng.tw/theme/js/jquery-3.2.1.min.js"></script>
    <script src="https://leemeng.tw/theme/js/plugins.js"></script>
    <script src="https://leemeng.tw/theme/js/main_raw.js"></script>
    <script type='text/javascript' src='https://leemeng.tw/theme/js/scroll-detect.js'></script>

    <!--https://instant.page/-->
    <script src="//instant.page/1.0.0" type="module" integrity="sha384-6w2SekMzCkuMQ9sEbq0cLviD/yR2HfA/+ekmKiBnFlsoSvb/VmQFSi/umVShadQI"></script>


    <script type='text/javascript' src='https://leemeng.tw/theme/js/progress-bar.js'></script>
    <script type='text/javascript' src='https://leemeng.tw/theme/js/scroll-detect.js'></script>

    <!--show and hide left navigation by scrolling-->
    <script>
    $(document).scroll(function() {
        var y = $(this).scrollTop();
      if ( $(window).width() > 980 ) {
        if (y > 600) {
          $('#left-navigation').fadeIn(300);
        } else {
          $('#left-navigation').fadeOut(300);
        }
      }
    });
    </script>

<!--reference: https://gist.github.com/scottmagdalein/259d878ad46ed6f2cdce-->
<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false">
</script>

<script type="text/javascript">
  function showMailingPopUp() {
    require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us18.list-manage.com","uuid":"151cb59f2de814c499c76b77a","lid":"dd1d78cc5e"})})
    document.cookie = "MCPopupClosed=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    document.cookie = "MCPopupSubscribed=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
  };

  $(function() {
    $(".open-popup").on('click', function() {
      showMailingPopUp();
    });
  });
</script><!--https://darkmodejs.learn.uno/-->
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script>
<script>
var options = {
  bottom: '32px', // default: '32px'
  right: 'unset', // default: '32px'
  left: '32px', // default: 'unset'
  time: '0.2s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: 'ğŸŒ“', // default: ''
  autoMatchOsTheme: true // default: true
}

const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
<!--reference: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_overlay-->
<script>
function openTocNav() {
    document.getElementById("tocNav").style.width = "100%";
}

function closeTocNav() {
    document.getElementById("tocNav").style.width = "0%";
}

function toggleTocNav() {
    var current_width = document.getElementById("tocNav").style.width;
    if (current_width == "100%") {
        document.getElementById("tocNav").style.width = "0%";
    } else {
        document.getElementById("tocNav").style.width = "100%";
    }
}

function closeLeftNavImage(elementId) {
    document.getElementById(elementId).style.width = "0%";
}

function toggleLeftNavImage(elementId) {
    var current_width = document.getElementById(elementId).style.width;
    if (current_width == "100%") {
        document.getElementById(elementId).style.width = "0%";
    } else {
        document.getElementById(elementId).style.width = "100%";
    }
}

</script>


</body>
</html>