<!DOCTYPE html>
<!--[if lt IE 9 ]><html class="no-js oldie" lang="zh-hant-tw"> <![endif]-->
<!--[if IE 9 ]><html class="no-js oldie ie9" lang="zh-hant-tw"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html class="no-js" lang="zh-hant-tw">
<!--<![endif]-->

<head>

    <!--- basic page needs
    ================================================== -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Lee Meng" />
<title>LeeMeng - AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift</title>
    <!--- article-specific meta data
    ================================================== -->
        <meta name="description" content="åŒæ¨£ä¸€ä»½è³‡æ–™å› æ‡‰ä¸åŒçš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„å­˜å–æ–¹å¼ã€‚è€Œé‡å°é€™äº›ä¸åŒçš„å­˜å–æ–¹å¼ï¼Œæˆ‘å€‘é€šå¸¸éœ€è¦é¸æ“‡æœ€é©åˆçš„è³‡æ–™åº«ä¾†æœ€ä½³åŒ–ä½¿ç”¨è€…é«”é©—ã€‚é€™ç¯‡æ–‡ç« å°‡ç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ AWS Database Migration Serviceä¾†å¿«é€Ÿåœ°é”åˆ°æˆ‘å€‘çš„ç›®æ¨™ï¼šå°‡ MongoDB è³‡æ–™é·ç§»åˆ° Redshift ä¸Šã€‚" />
        <meta name="keywords" content="aws, è³‡æ–™åº«, è³‡æ–™å·¥ç¨‹" />
        <meta name="tags" content="aws" />
        <meta name="tags" content="è³‡æ–™åº«" />
        <meta name="tags" content="è³‡æ–™å·¥ç¨‹" />


    <!--- Open Graph Object metas
    ================================================== -->
        <meta property="og:image" content="https://leemeng.tw/theme/images/background/pelly-benassi-2368-unsplash.jpg" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html" />
        <meta property="og:title" content="AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift" />
        <meta property="og:description" content="åŒæ¨£ä¸€ä»½è³‡æ–™å› æ‡‰ä¸åŒçš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„å­˜å–æ–¹å¼ã€‚è€Œé‡å°é€™äº›ä¸åŒçš„å­˜å–æ–¹å¼ï¼Œæˆ‘å€‘é€šå¸¸éœ€è¦é¸æ“‡æœ€é©åˆçš„è³‡æ–™åº«ä¾†æœ€ä½³åŒ–ä½¿ç”¨è€…é«”é©—ã€‚é€™ç¯‡æ–‡ç« å°‡ç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ AWS Database Migration Serviceä¾†å¿«é€Ÿåœ°é”åˆ°æˆ‘å€‘çš„ç›®æ¨™ï¼šå°‡ MongoDB è³‡æ–™é·ç§»åˆ° Redshift ä¸Šã€‚" />

    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <!--for customized css in individual page-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/bootstrap.min.css">

    <!--for showing toc navigation which slide in from left-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/toc-nav.css">

    <!--for responsive embed youtube video-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/embed_youtube.css">

    <!--for prettify dark-mode result-->
        <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/darkmode.css">

    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/base.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/vendor.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/main.css">
    <link rel="stylesheet" type="text/css" href="https://leemeng.tw/theme/css/ipython.css">
    <link rel="stylesheet" type="text/css" href='https://leemeng.tw/theme/css/progress-bar.css' />


    <!--TiqueSearch-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400">
    <link rel="stylesheet" href="https://leemeng.tw/theme/tipuesearch/css/normalize.css">
    <link rel="stylesheet" href="https://leemeng.tw/theme/tipuesearch/css/tipuesearch.css">

    <!-- script
    ================================================== -->
    <script src="https://leemeng.tw/theme/js/modernizr.js"></script>
    <script src="https://leemeng.tw/theme/js/pace.min.js"></script>


    <!-- favicons
    ================================================== -->
    <link rel="shortcut icon" href="../theme/images/favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="../theme/images/favicon.ico" type="image/x-icon"/>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106559980-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106559980-1');
</script>



</head>


<body id="top">

    <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="header-logo">
            <a class="site-logo" href="../index.html"><img src="https://leemeng.tw/theme/images/logo.png" alt="Homepage"></a>
        </div>
<!--navigation bar ref: http://jinja.pocoo.org/docs/2.10/tricks/-->



<nav class="header-nav-wrap">
    <ul class="header-nav">
        <li>
            <a href="../index.html#home">Home</a>
        </li>
        <li>
            <a href="../index.html#about">About</a>
        </li>
        <li>
            <a href="../index.html#projects">Projects</a>
        </li>
        <li class="current">
            <a href="../blog.html">Blog</a>
        </li>
        <li>
            <a href="https://demo.leemeng.tw">Demo</a>
        </li>
        <li>
            <a href="../books.html">Books</a>
        </li>
        <li>
            <a href="../index.html#contact">Contact</a>
        </li>

    </ul>

    <!--<div class="search-container">-->
        <!--<form action="../search.html">-->
            <!--<input type="text" placeholder="Search.." name="search">-->
            <!--<button type="submit"><i class="im im-magnifier" aria-hidden="true"></i></button>-->
        <!--</form>-->
    <!--</div>-->

</nav>
        <a class="header-menu-toggle" href="#0"><span>Menu</span></a>

    </header> <!-- end s-header -->



    <!--TOC navigation displayed when clicked from left-navigation button-->
    <div id="tocNav" class="overlay" onclick="closeTocNav()">
      <div class="overlay-content">
        <div id="toc"><ul><li><a class="toc-href" href="#" title="AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift">AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift</a><ul><li><a class="toc-href" href="#ä½¿ç”¨æ¡ˆä¾‹" title="ä½¿ç”¨æ¡ˆä¾‹">ä½¿ç”¨æ¡ˆä¾‹</a></li><li><a class="toc-href" href="#AWS-DMS-åŸºæœ¬ä»‹ç´¹" title="AWS DMS åŸºæœ¬ä»‹ç´¹">AWS DMS åŸºæœ¬ä»‹ç´¹</a></li><li><a class="toc-href" href="#åŸºæœ¬é·ç§»æ­¥é©Ÿ" title="åŸºæœ¬é·ç§»æ­¥é©Ÿ">åŸºæœ¬é·ç§»æ­¥é©Ÿ</a></li><li><a class="toc-href" href="#å»ºç«‹-replication-instance" title="å»ºç«‹ replication instance">å»ºç«‹ replication instance</a></li><li><a class="toc-href" href="#ç¢ºä¿-replication-instance-èƒ½é€£çµåˆ°ä¾†æº-/-ç›®æ¨™è³‡æ–™åº«" title="ç¢ºä¿ replication instance èƒ½é€£çµåˆ°ä¾†æº / ç›®æ¨™è³‡æ–™åº«">ç¢ºä¿ replication instance èƒ½é€£çµåˆ°ä¾†æº / ç›®æ¨™è³‡æ–™åº«</a><ul><li><a class="toc-href" href="#MongoDB-as-Source-Database" title="MongoDB as Source Database">MongoDB as Source Database</a><ul><li><a class="toc-href" href="#Metadata-mode" title="Metadata mode">Metadata mode</a></li><li><a class="toc-href" href="#Numbers-of-documents-to-scan" title="Numbers of documents to scan">Numbers of documents to scan</a></li></ul></li><li><a class="toc-href" href="#Redshift-as-Target-Database_1" title="Redshift as Target Database">Redshift as Target Database</a></li></ul></li><li><a class="toc-href" href="#å®šç¾©-replication-task_1" title="å®šç¾© replication task">å®šç¾© replication task</a><ul><li><a class="toc-href" href="#Selection-Rules" title="Selection Rules">Selection Rules</a></li><li><a class="toc-href" href="#Transformation-Rules" title="Transformation Rules">Transformation Rules</a></li></ul></li><li><a class="toc-href" href="#Debugging_1" title="Debugging">Debugging</a></li></ul></li></ul></div>
      </div>
    </div>

    <!--custom images with icon shown on left nav-->
    <!--the details are set in `pelicanconf.py` as `LEFT_NAV_IMAGES`-->

    <article class="blog-single">

        <!-- page header/blog hero, use custom cover image if available
        ================================================== -->
            <div class="page-header page-header--single page-hero" style="background-image:url(https://leemeng.tw/theme/images/background/pelly-benassi-2368-unsplash.jpg)">

            <div class="row page-header__content narrow">
                <article class="col-full">
                    <div class="page-header__info">
                        <div class="page-header__cat">
                            <a href="https://leemeng.tw/tag/aws.html" rel="tag">aws</a>
                            <a href="https://leemeng.tw/tag/zi-liao-ku.html" rel="tag">è³‡æ–™åº«</a>
                            <a href="https://leemeng.tw/tag/zi-liao-gong-cheng.html" rel="tag">è³‡æ–™å·¥ç¨‹</a>
                        </div>
                    </div>
                    <h1 class="page-header__title">
                        <a href="https://leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html" title="">
                            AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift
                        </a>
                    </h1>
                    <ul class="page-header__meta">
                        <li class="date">2018-03-27 (Tue)</li>
                        <li class="page-view">
                            617 views
                        </li>
                    </ul>

                </article>
            </div>

        </div> <!-- end page-header -->

        <div class="KW_progressContainer">
            <div class="KW_progressBar"></div>
        </div>

        <div class="row blog-content" style="position: relative">
<div id="left-navigation">

    <div id="search-wrap">
        <i class="im im-magnifier" aria-hidden="true"></i>
        <div id="search">
            <form action="../search.html">
            <div class="tipue_search_right"><input type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="æƒ³æœå°‹ä»€éº¼å‘¢ï¼Ÿï¼ˆè«‹è‡³å°‘è¼¸å…¥å…©å€‹å­—ï¼‰" required></div>
            </form>
        </div>
    </div>

    <div id="toc-wrap">
        <a title="é¡¯ç¤º/éš±è— æ–‡ç« ç« ç¯€">
            <i class="im im-menu" aria-hidden="true" onclick="toggleTocNav()"></i>
        </a>
    </div>

    <div id="social-wrap" style="cursor: pointer">
        <a class="open-popup" title="è¨‚é–±æœ€æ–°æ–‡ç« ">
            <i class="im im-newspaper-o" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html" target="_blank" title="åˆ†äº«åˆ° Facebook">
            <i class="im im-facebook" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html&title=AWS%20Data%20Migration%20Service%20-%20%E5%BE%9E%20MongoDB%20%E9%81%B7%E7%A7%BB%E5%88%B0%20Redshift&summary=%E5%90%8C%E6%A8%A3%E4%B8%80%E4%BB%BD%E8%B3%87%E6%96%99%E5%9B%A0%E6%87%89%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B%EF%BC%8C%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%98%E5%8F%96%E6%96%B9%E5%BC%8F%E3%80%82%E8%80%8C%E9%87%9D%E5%B0%8D%E9%80%99%E4%BA%9B%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%98%E5%8F%96%E6%96%B9%E5%BC%8F%EF%BC%8C%E6%88%91%E5%80%91%E9%80%9A%E5%B8%B8%E9%9C%80%E8%A6%81%E9%81%B8%E6%93%87%E6%9C%80%E9%81%A9%E5%90%88%E7%9A%84%E8%B3%87%E6%96%99%E5%BA%AB%E4%BE%86%E6%9C%80%E4%BD%B3%E5%8C%96%E4%BD%BF%E7%94%A8%E8%80%85%E9%AB%94%E9%A9%97%E3%80%82%E9%80%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%87%E7%B0%A1%E5%96%AE%E4%BB%8B%E7%B4%B9%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20AWS%20Database%20Migration%20Service%E4%BE%86%E5%BF%AB%E9%80%9F%E5%9C%B0%E9%81%94%E5%88%B0%E6%88%91%E5%80%91%E7%9A%84%E7%9B%AE%E6%A8%99%EF%BC%9A%E5%B0%87%20MongoDB%20%E8%B3%87%E6%96%99%E9%81%B7%E7%A7%BB%E5%88%B0%20Redshift%20%E4%B8%8A%E3%80%82&source=https%3A//leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html" target="_blank" title="åˆ†äº«åˆ° LinkedIn">
            <i class="im im-linkedin" aria-hidden="true"></i>
        </a>
    </div>
    <div id="social-wrap">
        <a href="https://twitter.com/intent/tweet?text=AWS%20Data%20Migration%20Service%20-%20%E5%BE%9E%20MongoDB%20%E9%81%B7%E7%A7%BB%E5%88%B0%20Redshift&url=https%3A//leemeng.tw/replicate-data-from-mongodb-to-redshift-using-aws-data-migration-service.html&hashtags=aws,zi-liao-ku,zi-liao-gong-cheng" target="_blank" title="åˆ†äº«åˆ° Twitter">
            <i class="im im-twitter" aria-hidden="true"></i>
        </a>
    </div>


    <!--custom images with icon shown on left nav-->

</div>

            <div class="col-full blog-content__main">

                <div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>åŒæ¨£ä¸€ä»½è³‡æ–™å› æ‡‰ä¸åŒçš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„å­˜å–æ–¹å¼ã€‚è€Œé‡å°é€™äº›ä¸åŒçš„å­˜å–æ–¹å¼ï¼Œæˆ‘å€‘é€šå¸¸éœ€è¦é¸æ“‡æœ€é©åˆçš„è³‡æ–™åº«ä¾†æœ€ä½³åŒ–ä½¿ç”¨è€…é«”é©—ã€‚</p>
<p>é€™ç¯‡æ–‡ç« å°‡ç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ <a href="https://aws.amazon.com/tw/dms/">AWS Database Migration Service</a> (ä»¥ä¸‹ç°¡ç¨± AWS DMS )ä¾†å¿«é€Ÿåœ°é”åˆ°æˆ‘å€‘çš„ç›®æ¨™ï¼šå°‡ MongoDB è³‡æ–™é·ç§»åˆ° Redshift ä¸Šã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ä½¿ç”¨æ¡ˆä¾‹">ä½¿ç”¨æ¡ˆä¾‹<a class="anchor-link" href="#ä½¿ç”¨æ¡ˆä¾‹">&para;</a></h2><p>èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹é›»å­å•†å‹™ç¶²ç«™çš„å¾Œç«¯å¯ä»¥ä½¿ç”¨ä¸€å€‹å…·æœ‰é«˜åº¦å½ˆæ€§çš„ NoSQL è³‡æ–™åº«å¦‚ <a href="https://www.mongodb.com/">MongoDB</a> ä¾†æ‡‰å°è®ŠåŒ–å¿«é€Ÿçš„ä½¿ç”¨è€…éœ€æ±‚ï¼›è€Œå…¬å¸å…§éƒ¨çš„è³‡æ–™ç§‘å­¸å®¶å¯ä»¥åˆ©ç”¨è³‡æ–™å€‰å„²å¦‚ <a href="https://aws.amazon.com/tw/redshift/">Redshift</a> ä¾†æ‰¾å‡º business insight ã€‚ä½†é€™æ™‚å€™ä¸€å€‹å•é¡Œç”¢ç”Ÿäº†ï¼šè³‡æ–™ç§‘å­¸å®¶ç”¨çš„è³‡æ–™å€‰å„² (ä¾‹ï¼šRedshift) çš„è³‡æ–™å“ªè£¡ä¾†ï¼Ÿ</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¸¸è¦‹çš„æ–¹å¼æ˜¯å° MongoDB è£¡é ­çš„è³‡æ–™å®šæœŸåš <a href="https://zh.wikipedia.org/wiki/ETL">ETL</a> ä»¥å¾Œå°‡è½‰æ›éå¾Œçš„è³‡æ–™è¼‰å…¥ Redshift ä¾›åˆ†æéœ€æ±‚ã€‚ç†è«–ä¸Šåœ¨åš ETL æ™‚è¦ä¾ç…§è³‡æ–™å€‰å„²çš„ Data Model é‡æ–°è¨­è¨ˆ Tables (ä¾‹ï¼š <a href="https://en.wikipedia.org/wiki/Star_schema">Star Schema</a>)ï¼Œä½†ç‚ºäº†èƒ½åœ¨æœ€çŸ­çš„æ™‚é–“å°‡ MongoDB ä¸Šçš„è³‡æ–™è½‰åˆ° Redshift é€²è¡Œä¸€äº› Queryï¼Œé€™ç¯‡æ–‡ç« å°‡ç°¡å–®ä»‹ç´¹ AWS DMS çš„é‹ä½œæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é‹ç”¨å®ƒä¾†å¯¦éš›é€²è¡Œè³‡æ–™é·ç§»æ‰€éœ€è¦çš„æ­¥é©Ÿã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/intro.png" width="90%"/>
</center>
<center>
<a href="https://aws.amazon.com/tw/dms/" target="_blank">AWS DMS</a>
<font color="purple">: é·ç§»ï¼ˆä¸¦è½‰æ›ï¼‰ AWS ä¸Šçš„è³‡æ–™åº«</font>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="AWS-DMS-åŸºæœ¬ä»‹ç´¹">AWS DMS åŸºæœ¬ä»‹ç´¹<a class="anchor-link" href="#AWS-DMS-åŸºæœ¬ä»‹ç´¹">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DMS åŸºæœ¬ä¸Šé‹ä½œæ–¹å¼å°±æ˜¯å¹«æˆ‘å€‘å•Ÿå‹•ä¸€å° EC2 æ©Ÿå™¨ (ç¨±ä¹‹ç‚º replication instance) ï¼Œç„¶å¾Œåœ¨ä¸Šé¢è·‘ replication task(s) ã€‚ ä¸€å€‹ instance ä¸Šå¯ä»¥æœ‰å¤šå€‹ tasks é€²è¡Œè³‡æ–™é·ç§»ã€‚ instance å‰‡åˆ†åˆ¥é€é <a href="https://docs.aws.amazon.com/zh_cn/dms/latest/userguide/CHAP_Introduction.Sources.html">Source Endpoint</a> / <a href="https://docs.aws.amazon.com/zh_cn/dms/latest/userguide/CHAP_Introduction.Targets.html">Target Endpoint</a> é€£çµä¾†æº / ç›®æ¨™è³‡æ–™åº«ã€‚åœ¨å¾Œé¢æˆ‘å€‘æœƒçœ‹åˆ°ï¼Œ endpoints å¯¦éš›ä¸Šå°±åªæ˜¯å‘Šè¨´ AWS DMS çš„ replication instance å¦‚ä½•é€£çµåˆ°å¯¦éš›çš„è³‡æ–™åº«çš„è¨­å®šç½·äº†ã€‚åœ¨æˆ‘å€‘çš„ä¾‹å­è£¡é ­ï¼Œä¾†æº / ç›®æ¨™è³‡æ–™åº«åˆ†åˆ¥å°æ‡‰åˆ° MongoDB / Redshift ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/flow.png" style="width:80%"/>
</center>
<center>
<a href="https://docs.aws.amazon.com/zh_cn/dms/latest/userguide/Welcome.html" target="_blank">DMS åŸºæœ¬é‹ä½œæ–¹å¼</a>
<font color="purple">: è³‡æ–™é·ç§»æ˜¯ç”±åœ¨ Replication Instance ä¸ŠåŸ·è¡Œçš„ Replication Task é€é endpoints é€£çµä¾†æº/ç›®æ¨™è³‡æ–™åº«å®Œæˆçš„</font>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="åŸºæœ¬é·ç§»æ­¥é©Ÿ">åŸºæœ¬é·ç§»æ­¥é©Ÿ<a class="anchor-link" href="#åŸºæœ¬é·ç§»æ­¥é©Ÿ">&para;</a></h2><p>åœ¨å‡è¨­ä¾†æº / ç›®æ¨™è³‡æ–™åº«å·²ç¶“åœ¨é‹ä½œçš„æƒ…æ³ä¸‹ï¼Œå¦‚åŒ AWS DMS çš„ Get started, ä¸€èˆ¬æœƒé€²è¡Œä»¥ä¸‹æ­¥é©Ÿä¾†é·ç§»è³‡æ–™ï¼š</p>
<ol>
<li><a href="#å»ºç«‹-replication-instance">å»ºç«‹ replication instance</a></li>
<li><a href="#ç¢ºä¿-replication-instance-èƒ½é€£çµåˆ°ä¾†æº-/-ç›®æ¨™è³‡æ–™åº«">ç¢ºä¿ replication instance èƒ½é€£çµåˆ°ä¾†æº / ç›®æ¨™è³‡æ–™åº«</a></li>
<li><a href="#å®šç¾©-replication-task">å®šç¾© replication task</a></li>
<li><a href="#Debugging">Debuggingï¼šç¢ºä¿ä¸€åˆ‡é‹ä½œæ­£å¸¸</a></li>
</ol>
<p>ä»¥ä¸‹é‡å°æ¯å€‹æ­¥é©Ÿï¼Œæˆ‘æœƒç´€éŒ„ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="å»ºç«‹-replication-instance">å»ºç«‹ replication instance<a class="anchor-link" href="#å»ºç«‹-replication-instance">&para;</a></h2><p>é»æ“Š AWS DMS ä»‹é¢çš„ Get started é¸é …æœƒè«‹æˆ‘å€‘å»ºç«‹æ–°çš„ instance:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/create-replicate-instance.png" width="90%"/>
</center>
<center>
    å»ºç«‹ Replication Instance
    <font color="purple">: æ³¨æ„ VPC /è¨­å®š</font>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>é€™æ­¥é©ŸåŸºæœ¬ä¸Šæ²’ä»€éº¼å•é¡Œï¼Œ replication task æœƒä½”ç”¨å¤§é‡çš„ CPU ä»¥åŠè¨˜æ†¶é«”è³‡æºï¼Œç†æƒ³ä¸Šæ˜¯ä¾æ“šéœ€æ±‚é¸æ“‡ Instance class ï¼Œä¸éç¬¬ä¸€æ¬¡æ¸¬è©¦åŠŸèƒ½çš„è©±ç”¨é è¨­çš„ t2.medium å³å¯ã€‚é€™é‚Šå€¼å¾—æ³¨æ„çš„æ˜¯ VPC ä»¥åŠä¸‹é¢é€²éšé¸é …çš„ VPC Security Group(s) è¨­å®šã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¦‚æœä¾†æº / ç›®æ¨™è³‡æ–™åº«éƒ½å¯ä¾›å…¬é–‹å­˜å–çš„è©±ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦ VPC ã€‚ä½†ä¸€èˆ¬ä¾†èªªæˆ‘å€‘éƒ½æœƒæœ‰å®‰å…¨è€ƒé‡ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚æ‰€æœ‰åœ¨ AWS ä¸Šçš„è³‡æºéƒ½è¦å¥—ç”¨å®‰å…¨è¨­å®šï¼Œå‰‡æœ€ç°¡å–®çš„æ¶æ§‹æ˜¯å°‡ä¾†æºè³‡æ–™åº«ã€ç›®æ¨™è³‡æ–™åº«ä»¥åŠ Replication Instance éƒ½æ”¾å…¥åŒä¸€å€‹ VPC ï¼Œä¸¦åˆ©ç”¨ <a href="https://docs.aws.amazon.com/zh_cn/AmazonVPC/latest/UserGuide/VPC_SecurityGroups.html">security group</a> è¨­å®šä¾†å…è¨±è©² Instance å­˜å–å…©å€‹è³‡æ–™åº«ã€‚æ¦‚å¿µä¸Šæ­¤ VPC çš„æ¶æ§‹æœƒå¦‚ä¸‹ ( <code>sg</code> ç‚º Security Group ä¹‹ç¸®å¯« )ï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/naive-vpc-structure.png" style="width:60%"/>
</center>
<center>
<font color="purple">ä¾†æº / ç›®æ¨™è³‡æ–™åº«æ‰€åœ¨çš„ Security Group è¦å…è¨± Replication Instance æ‰€åœ¨çš„ Security Group å­˜å–</font>
<br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ä»¥ä¸Šåœ–ç‚ºä¾‹ï¼Œ Security Group <code>sg_mongodb</code> ä»¥åŠ <code>sg_redshift</code> çš„ Inbound Rule è¦å…è¨± <code>sg_replicate</code> å­˜å–ã€‚è€Œå…è¨±å­˜å–çš„ Port å‰‡ä¾ç…§è³‡æ–™åº«å¯¦éš›ä½¿ç”¨çš„ Port è¨­å®šå³å¯ (ä¾‹ï¼š MongoDB æ…£ç”¨ 27017ï¼› Redshift å‰‡æ˜¯ 5439)ã€‚æœ€å¾Œåˆ¥å¿˜äº†åœ¨å»ºç«‹ replication instance çš„é€²éšè¨­å®šçš„ VPC Security Group(s) é¸æ“‡ <code>sg_replicate</code>ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¦å¤–ä½ å¯èƒ½å·²ç¶“æ³¨æ„åˆ°ä¸Šåœ–çš„ S3 bucket ã€‚å°± replication tasks çš„ log ä¾†çœ‹ï¼Œ AWS DMS åœ¨é·ç§»è³‡æ–™çš„æ™‚å€™å¯¦éš›ä¸Šæœƒå†ç´°åˆ†ç‚ºå…©æ­¥é©Ÿï¼š</p>
<ul>
<li>Replication Task å°‡ä¾†æºè³‡æ–™åº«çš„è³‡æ–™è¼‰å‡ºã€è½‰æ›ä¸¦æš«å­˜åˆ° S3</li>
<li>Task å°‡å­˜åœ¨ S3 çš„è³‡æ–™è¼‰å…¥ç›®æ¨™è³‡æ–™åº«</li>
</ul>
<p>é›–ç„¶ <a href="https://aws.amazon.com/tw/cloudwatch/">ClodWatch</a> éœ€è¦é¡å¤–æ”¶è²»ï¼Œä½†ç‚ºäº†æ–¹ä¾¿é™¤éŒ¯ï¼Œå»ºè­°ä½¿ç”¨ã€‚åœ¨æ–‡ç« å¾Œé¢çš„ <a href="#Debugging">Debugging</a> æˆ‘å€‘æœƒå¯¦éš›çœ‹ä¸€äº›ä¾‹å­ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ç¢ºä¿-replication-instance-èƒ½é€£çµåˆ°ä¾†æº-/-ç›®æ¨™è³‡æ–™åº«">ç¢ºä¿ replication instance èƒ½é€£çµåˆ°ä¾†æº / ç›®æ¨™è³‡æ–™åº«<a class="anchor-link" href="#ç¢ºä¿-replication-instance-èƒ½é€£çµåˆ°ä¾†æº-/-ç›®æ¨™è³‡æ–™åº«">&para;</a></h2><p>ä¸Šä¸€æ­¥é©Ÿè¨­å®šå¥½ä»¥å¾Œï¼Œ AWS DMS æœƒé¦¬ä¸Šå¹«æˆ‘å€‘å»ºç«‹ä¸€å€‹æ–°çš„ replication instanceã€‚åœ¨ç­‰å¾…çš„åŒæ™‚æˆ‘å€‘å¯ä»¥é–‹å§‹è¨­å®šè³‡æ–™åº«çš„ endpointsã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/check-replication-instance-can-connect-to-both-endpoints.png" width="90%"/>
</center>
<center>
    è¨­å®šä¾†æº / ç›®æ¨™ enpoints
    <font color="purple">: åœ¨æ­¤æ­¥é©Ÿç¢ºä¿ Replication Instance å¯ä»¥é€£åˆ°å…©å€‹è³‡æ–™åº«å¯ä»¥æ¸›å°‘é™¤éŒ¯æ™‚é–“</font>
<br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>é€™æ­¥é©ŸåŸºæœ¬ä¸Šä¾ç…§è³‡æ–™åº«çš„ä¸åŒï¼Œéœ€è¦çš„è¼¸å…¥çš„é …ç›®å¯èƒ½ä¸ä¸€æ¨£ã€‚ä¸éå€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨<a href="#å»ºç«‹-replication-instance">å»ºç«‹ replication instance</a> çš„æ™‚å€™æˆ‘å€‘å·²ç¶“è®“ä¾†æº / ç›®æ¨™è³‡æ–™åº«ä»¥åŠ replication instance éƒ½å¾…åœ¨åŒå€‹ VPC è£¡é ­ã€‚å‡è¨­æˆ‘å€‘çš„ MongoDB æ˜¯é‹è¡Œåœ¨è©² VPC è£¡é ­çš„æŸå€‹ EC2 instance ä¹‹ä¸Šï¼Œè¦å…è¨±åœ¨åŒå€‹ VPC çš„ replication instance å­˜å–è©² EC2 instanceï¼Œæˆ‘å€‘è¦åœ¨ Server name é¸é …è¼¸å…¥é‹è¡Œ MongoDB çš„ EC2 çš„ Private IP (ä¸Šåœ–ç¬¬ä¸€å€‹ç´…æ¡†)ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="MongoDB-as-Source-Database">MongoDB as Source Database<a class="anchor-link" href="#MongoDB-as-Source-Database">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç•¶ MongoDB ç‚ºä¾†æºè³‡æ–™åº«æ™‚æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„äº‹æƒ…å¯ä»¥åƒè€ƒ<a href="https://docs.aws.amazon.com/zh_cn/dms/latest/userguide/CHAP_Source.MongoDB.html">å®˜æ–¹æ–‡ä»¶</a>ã€‚ä»¥ä¸‹æœƒèªªæ˜ä¸€äº›å€¼å¾—ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Metadata-mode">Metadata mode<a class="anchor-link" href="#Metadata-mode">&para;</a></h4><p>Metadata mode é è¨­ç‚º <code>document</code>ï¼ˆä¸Šåœ–ç¬¬äºŒå€‹ç´…æ¡†ï¼‰ï¼Œä¹Ÿå°±æ˜¯æŠŠ MongoDB è£¡é ­çš„ json-formated æ–‡ä»¶æ”¾åˆ° Redshift è£¡é ­å°æ‡‰ Table çš„ä¸€å€‹ <code>_doc</code> æ¬„ä½ã€‚å‡è¨­ MongoDB è£¡æœ‰ä¸€å€‹ <code>users</code> collection ï¼Œè£¡é ­å­˜äº†ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"user"</span><span class="p">:</span> <span class="s2">"leemeng"</span><span class="p">,</span>
    <span class="nt">"favorite"</span><span class="p">:</span> <span class="s2">"chocolate"</span><span class="p">,</span> 
    <span class="nt">"a"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"b"</span><span class="p">:</span> <span class="s2">"For fun!"</span>
    <span class="p">},</span>
    <span class="nt">"unnecessary_field"</span><span class="p">:</span> <span class="s2">"Don't include me!"</span>
<span class="p">}</span>
</pre></div>
<p>å°‡æœƒè¢«ä»¥ä¸‹çš„æ ¼å¼è¼‰å…¥ Redshiftï¼š</p>
<pre><code>_doc                      |
---------------------------
{"user": "leemeng", "fav ..</code></pre>
<p>è€Œé€™é€šå¸¸ä¸æ˜¯æˆ‘å€‘è¦çš„ã€‚å°‡ metadate mode è¨­å®šç‚º <code>table</code> æ¨¡å¼èƒ½è®“ AWS DMS æŠŠæ–‡ä»¶è£¡é ­çš„æ¬„ä½æ‰å¹³åŒ–å¾Œæ”¾å…¥å°æ‡‰çš„æ¬„ä½(column)ï¼š</p>
<div class="highlight"><pre><span></span>user    | favorite  | a.b     | unnecessary_field
-------------------------------------------------
leemeng | chocolate | For fun!| Don't include me!
</pre></div>
<p>æ³¨æ„åˆ°é€™é‚Šæœ‰ä¸€å€‹æˆ‘å€‘ä¸éœ€è¦é·ç§»åˆ° Redshift çš„ <code>unnecessary_field</code> ã€‚åœ¨å¾Œé¢çš„ <a href="#Transformation Rules">Transformation Rules</a> æˆ‘å€‘æœƒäº†è§£æ€éº¼è¾¦è©²æ¬„ä½å»é™¤ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Numbers-of-documents-to-scan">Numbers of documents to scan<a class="anchor-link" href="#Numbers-of-documents-to-scan">&para;</a></h4><p>è€Œ Numbers of documents to scan é¸é …å‰‡è®“æˆ‘å€‘æ±ºå®šè¦è®“ AWS DMS æ‹¿å¤šå°‘æ–‡ä»¶ä¾†æ±ºå®šè¦å»ºç«‹å“ªäº›æ¬„ä½ã€‚å¦‚æœè¦é·ç§»çš„ MongoDB collection çš„æ–‡ä»¶ schema å¾ˆå¸¸è¢«æ›´å‹•ï¼ˆå¸¸æœ‰æ–°éµå€¼ï¼‰çš„è©±ï¼Œå»ºè­°å¯ä»¥è®“ AWS DMS æƒæå¤šä¸€é»æ–‡ä»¶ä¾†å»ºç«‹è¶³å¤ çš„æ¬„ä½ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Redshift-as-Target-Database_1">Redshift as Target Database<a class="anchor-link" href="#Redshift-as-Target-Database">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å¦‚æœæŒ‰ç…§ AWS DMS çš„ Get started ä¸€æ­¥ä¸€æ­¥èµ°çš„è©±åŸºæœ¬ä¸Šæ²’æœ‰å•é¡Œã€‚è¦æ³¨æ„çš„æ˜¯ Redshift è¦æœ‰å…è¨± DMS å­˜å–çš„ AMI Ruleï¼Œå¦å‰‡æœƒå‡ºéŒ¯ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="å®šç¾©-replication-task_1">å®šç¾© replication task<a class="anchor-link" href="#å®šç¾©-replication-task">&para;</a></h2><p>åœ¨ç¢ºå®š replication instance å¯ä»¥é€£ç·šåˆ°å…©å€‹è³‡æ–™åº«å¾Œï¼Œå¯ä»¥é–‹å§‹å»ºç«‹æˆ‘å€‘çš„ replication taskï¼š</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/create-replication-task.png" width="90%"/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>é€™é‚Šæˆ‘å€‘å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ç¨®è³‡æ–™é·ç§»æ–¹å¼ (åœ–ä¸­çš„ Migration type)ï¼š</p>
<ol>
<li>é·ç§»ç›®å‰ MongoDB çš„è³‡æ–™</li>
<li>åŒä¸Šï¼Œä½†åœ¨é·ç§»å¾Œä¹‹å¾Œç¹¼çºŒåŒæ­¥ MongoDB &amp; Redshift (å‰ææ˜¯ MongoDB è¦ä»¥ Replica Set æ¨¡å¼åŸ·è¡Œ)</li>
<li>åªæŠŠ Task å•Ÿå‹•å¾Œ MongoDB çš„è³‡æ–™è®Šå‹•é·ç§»åˆ° Redshift</li>
</ol>
<p>é€™é‚Šé¸æ“‡è‡ªå·±çš„æƒ³è¦çš„é·ç§»æ–¹å¼å³å¯ã€‚æ¥è‘—æˆ‘å€‘è¦å‘Šè¨´ AWS DMS æƒ³è¦é€²è¡Œé·ç§»çš„ MongoDB Collections ä»¥åŠåœ¨æƒ³è¦åšçš„ç°¡å–®è½‰æ›ã€‚å…©è€…åˆ†åˆ¥é€é <a href="#Selection-Rules">Selection Rules</a> é‚„æœ‰ <a href="#Transformation-Rules">Transformation Rules</a> å®šç¾©ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Selection-Rules">Selection Rules<a class="anchor-link" href="#Selection-Rules">&para;</a></h3><p>Selection Rules çš„ç”¨é€”æ˜¯å‘Šè¨´ AWS DMS è©²é·ç§»ä»¥åŠä¸è¦é·ç§»çš„ (MongoDB) collections ã€‚æˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹ general rule è®“ä¸€å€‹ task è™•ç†æŸå€‹ db çš„æ‰€æœ‰ collections ï¼›ä¹Ÿèƒ½è®“ä¸€å€‹ task åªè² è²¬ä¸€å€‹ collection çš„é·ç§»ã€‚å¾Œè€…çš„è¨­å®šæ¯”è¼ƒèŠ±æ™‚é–“ä½†æ˜¯å½ˆæ€§æ¯”è¼ƒé«˜ï¼Œå¯ä»¥ä¾ç…§ä¸åŒ collection ç‰¹æ€§æ±ºå®šé·ç§»çš„æ–¹å¼ã€‚</p>
<p>ä¸‹åœ–æ˜¯å®šç¾©ä¸€å€‹ rule å‘Šè¨´ AWS DMS é·ç§»æ‰€æœ‰åœ¨ MongoDB çš„ Collectionsã€‚å¦å¤–å¦‚æœæƒ³è¦æ’é™¤å“ªå€‹ collection çš„è©±å°±æ–°å¢ä¸€å€‹ rule ä¸¦åœ¨ Action é¸æ“‡ <code>Exclude</code>ã€‚åŸºæœ¬ä¸Šæƒ³è¦åŠ å¹¾å€‹ Selection Rules éƒ½å¯ä»¥ã€‚è€Œ Exclude Rules çš„æ•ˆæœæ˜¯åœ¨æ‰€æœ‰ Include Rules å¾Œå¥—ç”¨ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/selection-rules.png" style=""/>
</center>
<center>
<a href="https://www.netpromoter.com/know/" target="_blank">Selection Rules</a>
<font color="purple">: é¸æ“‡è¦é·ç§»åˆ°ç›®æ¨™è³‡æ–™åº«çš„ Tables / Collections</font>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transformation-Rules">Transformation Rules<a class="anchor-link" href="#Transformation-Rules">&para;</a></h3><p>é€™é‚Šæ‰€è¬‚çš„è½‰æ›ä¸¦ä¸æ˜¯å°æ¬„ä½çš„å¯¦éš›å€¼ (value) é€²è¡Œè½‰æ›ï¼Œè€Œæ˜¯é‡å° Table / Column å±¤ç´šåš</p>
<ul>
<li>æ’é™¤ï¼ˆä¸é·ç§»è©² Table / Columnï¼‰</li>
<li>å¹« Table / Column æ›´åã€å¤§å°å¯«è½‰æ›æˆ–æ˜¯åç¨±åŠ ä¸Š prefix / postfix</li>
</ul>
<p>é€™ç¨®æ“ä½œã€‚ä¸‹åœ–æ˜¯å°‡ <code>users</code> collection è£¡é ­ä¸éœ€è¦é·ç§»çš„éµå€¼ <code>uncessary_field</code> å¾ Redshift æ’é™¤çš„ rules:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/transformation-rules.png" style=""/>
<br/>
</center><p>é€éé€™å€‹ Transformation ruleï¼Œæˆ‘å€‘ä¸Šé¢ <code>users</code> collection çš„ç¯„ä¾‹æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"user"</span><span class="p">:</span> <span class="s2">"leemeng"</span><span class="p">,</span>
    <span class="nt">"favorite"</span><span class="p">:</span> <span class="s2">"chocolate"</span><span class="p">,</span>
    <span class="nt">"a"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"b"</span><span class="p">:</span> <span class="s2">"For fun!"</span>
    <span class="p">},</span>
    <span class="nt">"unnecessary_field"</span><span class="p">:</span> <span class="s2">"Don't include me!"</span>
<span class="p">}</span>
</pre></div>
<p>å°±æœƒè¢«è½‰æˆï¼š</p>
<div class="highlight"><pre><span></span>user    | favorite  | a.b     
------------------------------
leemeng | chocolate | For fun!
</pre></div>
<p>æ³¨æ„ <code>uncessary_field</code> ä¸æœƒè¢«å­˜åˆ° Redshift è£¡é ­ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Debugging_1">Debugging<a class="anchor-link" href="#Debugging">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç•¶å»ºç«‹ä¸¦åŸ·è¡Œä¸€å€‹æ–°çš„ replication task å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¾ Load State çœ‹åˆ°æ¯å€‹ Table è¼‰å…¥çš„ç‹€æ³ã€‚ Load State æœ‰å¹¾ç¨®å¯èƒ½çš„å€¼ï¼š</p>
<ul>
<li>Before Loading</li>
<li>Full Load</li>
<li>Table completed</li>
<li>Table error</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ç•¶å‡ºç¾ <code>Table error</code> æ™‚ï¼Œæˆ‘å€‘å¯ä»¥å…ˆçœ‹ log ç­è§£æƒ…æ³ï¼š</p>
<div class="highlight"><pre><span></span>2018-03-28T01:23:30 [TARGET_LOAD ]E: RetCode: SQL_ERROR SqlState: XX000 NativeError: 30 Message: [Amazon][Amazon Redshift] (30) Error occurred while trying to execute a query: [SQLState XX000] ERROR: Load into table 'users' failed. Check 'stl_load_errors' system table for details. [1022502] (ar_odbc_stmt.c:4406)
</pre></div>
<p>ä¾ç…§ä¸åŒçš„éŒ¯èª¤ã€ä¸åŒçš„ç›®æ¨™è³‡æ–™åº«ï¼Œå¯¦éš›çš„ log å…§å®¹æœƒæœ‰æ‰€ä¸åŒã€‚ä»¥æˆ‘å€‘ç›®æ¨™è³‡æ–™åº« = Redshift çš„æƒ…æ³ä¸‹ï¼Œä¸Šé¢çš„ log å‘Šè¨´æˆ‘å€‘ replication task åœ¨è¼‰å…¥ <code>users</code> Table æ™‚å‡ºéŒ¯ï¼Œè©³æƒ…å¯ä»¥åƒè€ƒ Redshift çš„ <code>stl_load_error</code> Table (<a href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_STL_LOAD_ERRORS.html">å®˜æ–¹æ–‡ä»¶</a>)ï¼š</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">pg_catalog</span><span class="p">.</span><span class="n">stl_load_errors</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">starttime</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center>
<img src="images/aws-dms/load-error-example.png" width="90%"/>
</center>
<center>
    æŸ¥çœ‹ Redshift è£¡é ­ stl_load_error Table ä¾†é™¤éŒ¯
    <br/>
<br/>
</center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>å°±é€™å€‹éŒ¯èª¤ä¾‹å­ä¾†çœ‹ï¼Œ err_reason çš„å…§å®¹å‘Šè¨´æˆ‘å€‘æœ‰å€‹ <code>memo</code> æ¬„ä½ ( colname ) çš„å€¼å¤ªé•·å°è‡´æ²’è¾¦æ³•è¼‰å…¥ Redshiftã€‚é€™æ™‚å€™å¯ä»¥æŠŠæ­£åœ¨é‹è¡Œçš„ replication task æš«åœï¼Œç”¨å‰é¢æåˆ°çš„ <a href="#Transformation-Rules">Transformation Rules</a> ä¾†å»é™¤è©²æ¬„ä½ã€‚è€ŒåŸºæœ¬ä¸Šå…¶ä»–éŒ¯èª¤ä¹Ÿèƒ½ç”¨é¡ä¼¼çš„æ–¹å¼è§£æ±ºã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>åˆ°é€™é‚Šç‚ºæ­¢å¤§è‡´ä¸Šæ‡‰è©²å¯ä»¥é †åˆ©æŠŠ MongoDB çš„è³‡æ–™è¼‰å…¥ Redshift äº†ã€‚ä¹‹å¾Œæƒ³åˆ°ä»€éº¼å†è£œå……ã€‚</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>


                <!-- Tags -->
                <p class="blog-content__tags">
                    <span>Post Tags</span>

                    <span class="blog-content__tag-list">
                        <a href="https://leemeng.tw/tag/aws.html" rel="tag">aws</a>
                        <a href="https://leemeng.tw/tag/zi-liao-ku.html" rel="tag">è³‡æ–™åº«</a>
                        <a href="https://leemeng.tw/tag/zi-liao-gong-cheng.html" rel="tag">è³‡æ–™å·¥ç¨‹</a>
                    </span>

                </p>





































































                <!-- end Tags -->


                <!-- Mail-list-subscribe -->
                <div id="article-inner-subscribe" class="blog-content__pagenav">
                    <div class="blog-content__nav">
                        <div class="blog-content__prev">
                            <a class="open-popup" rel="subscribe">
                                <span>Get Latest Arrivals</span>
                                è¨‚é–±æœ€æ–°æ–‡ç« 
                            </a>
                        </div>
                        <div class="blog-content__next">
                            <p>
                                è·Ÿè³‡æ–™ç§‘å­¸ç›¸é—œçš„æœ€æ–°æ–‡ç« ç›´æ¥é€åˆ°å®¶ã€‚</br>
                                åªè¦åŠ å…¥è¨‚é–±åå–®ï¼Œç•¶æ–°æ–‡ç« å‡ºçˆæ™‚ï¼Œ</br>
                                ä½ å°‡èƒ½é¦¬ä¸Šæ”¶åˆ°é€šçŸ¥ <i class="im im-newspaper-o" aria-hidden="true"></i>
                            </p>
                        </div>
                    </div>
                    <div class="blog-content__all">
                        <a class="open-popup btn btn--primary ">&nbsp;&nbsp;Subscribe&nbsp;&nbsp;&nbsp;</a>
                    </div>
                </div>
                <!-- end Mail-list-subscribe -->

                <!--Pagination-->
                <div id="article-inner-neighbor-pages" class="blog-content__pagenav">
                    <div class="blog-content__nav">
                        <div class="blog-content__prev">
                            <a href="https://leemeng.tw/use-kinesis-streams-and-firehose-to-build-a-data-lake.html" rel="prev">
                                <span>Previous Post</span>
                                åˆ©ç”¨ Kinesis è™•ç†ä¸²æµè³‡æ–™ä¸¦å»ºç«‹è³‡æ–™æ¹–
                            </a>
                        </div>
                        <div class="blog-content__next">
                            <a href="https://leemeng.tw/designing-data-intensive-applications-1-preface.html" rel="next">
                                <span>Next Post</span>
                                Designing Data-Intensive Applications (1) - åºè¨€
                            </a>
                        </div>
                    </div>

                    <div class="blog-content__all">
                        <a href="blog.html" class="btn btn--primary">
                            View All Post
                        </a>
                    </div>
                </div>
                <!-- end Pagination-->

            </div><!-- end blog-content__main -->


        </div>
        </div> <!-- end blog-content -->

    </article>

<div class="comments-wrap">
    <div id="comments" class="row">
        <div class="col-full">
            <div id="disqus_thread"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
var disqus_shortname = 'leemengtaiwan';
var disqus_title = 'AWS Data Migration Service - å¾ MongoDB é·ç§»åˆ° Redshift';

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<!-- footer
================================================== -->
<footer style="background:#0a0809">
    <div class="row">
        <div class="col-full">

            <div class="footer-logo">
                <a class="footer-site-logo" href="#0"><img src="https://leemeng.tw/theme/images/logo.png" alt="Homepage"></a>
            </div>

            <ul class="footer-social">
<li><a href="https://github.com/leemengtaiwan" target="_blank">
    <i class="im im-github" aria-hidden="true"></i>
    <span>Github</span>
</a></li>
<li><a href="https://www.facebook.com/LeeMengTaiwan" target="_blank">
    <i class="im im-facebook" aria-hidden="true"></i>
    <span>Facebook</span>
</a></li>
<li><a href="https://www.instagram.com/leemengtaiwan/" target="_blank">
    <i class="im im-instagram" aria-hidden="true"></i>
    <span>Instagram</span>
</a></li>
<li><a href="https://www.linkedin.com/in/leemeng1990/" target="_blank">
    <i class="im im-linkedin" aria-hidden="true"></i>
    <span>LinkedIn</span>
</a></li>            </ul>
        </div>
    </div>
    <div class="row footer-bottom">
        <div class="col-twelve">
            <div class="go-top">
            <a class="smoothscroll" title="Back to Top" href="#top"><i class="im im-arrow-up" aria-hidden="true"></i></a>
            </div>
        </div>
    </div> <!-- end footer-bottom -->
</footer> <!-- end footer -->


        <!-- Javascript
    ================================================== -->
    <script src="https://leemeng.tw/theme/js/jquery-3.2.1.min.js"></script>
    <script src="https://leemeng.tw/theme/js/plugins.js"></script>
    <script src="https://leemeng.tw/theme/js/main_raw.js"></script>
    <script type='text/javascript' src='https://leemeng.tw/theme/js/scroll-detect.js'></script>

    <!--https://instant.page/-->
    <script src="//instant.page/1.0.0" type="module" integrity="sha384-6w2SekMzCkuMQ9sEbq0cLviD/yR2HfA/+ekmKiBnFlsoSvb/VmQFSi/umVShadQI"></script>


    <script type='text/javascript' src='https://leemeng.tw/theme/js/progress-bar.js'></script>
    <script type='text/javascript' src='https://leemeng.tw/theme/js/scroll-detect.js'></script>

    <!--show and hide left navigation by scrolling-->
    <script>
    $(document).scroll(function() {
        var y = $(this).scrollTop();
      if ( $(window).width() > 980 ) {
        if (y > 600) {
          $('#left-navigation').fadeIn(300);
        } else {
          $('#left-navigation').fadeOut(300);
        }
      }
    });
    </script>

<!--reference: https://gist.github.com/scottmagdalein/259d878ad46ed6f2cdce-->
<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false">
</script>

<script type="text/javascript">
  function showMailingPopUp() {
    require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us18.list-manage.com","uuid":"151cb59f2de814c499c76b77a","lid":"dd1d78cc5e"})})
    document.cookie = "MCPopupClosed=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    document.cookie = "MCPopupSubscribed=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
  };

  $(function() {
    $(".open-popup").on('click', function() {
      showMailingPopUp();
    });
  });
</script><!--https://darkmodejs.learn.uno/-->
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.4.0/lib/darkmode-js.min.js"></script>
<script>
var options = {
  bottom: '32px', // default: '32px'
  right: 'unset', // default: '32px'
  left: '32px', // default: 'unset'
  time: '0.2s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: 'ğŸŒ“', // default: ''
  autoMatchOsTheme: true // default: true
}

const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
<!--reference: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_overlay-->
<script>
function openTocNav() {
    document.getElementById("tocNav").style.width = "100%";
}

function closeTocNav() {
    document.getElementById("tocNav").style.width = "0%";
}

function toggleTocNav() {
    var current_width = document.getElementById("tocNav").style.width;
    if (current_width == "100%") {
        document.getElementById("tocNav").style.width = "0%";
    } else {
        document.getElementById("tocNav").style.width = "100%";
    }
}

function closeLeftNavImage(elementId) {
    document.getElementById(elementId).style.width = "0%";
}

function toggleLeftNavImage(elementId) {
    var current_width = document.getElementById(elementId).style.width;
    if (current_width == "100%") {
        document.getElementById(elementId).style.width = "0%";
    } else {
        document.getElementById(elementId).style.width = "100%";
    }
}

</script>


</body>
</html>