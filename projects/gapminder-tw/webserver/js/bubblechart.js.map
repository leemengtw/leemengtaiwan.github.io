{"version":3,"sources":["webpack:///webpack/bootstrap b95122d050626ef8de8a","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/panzoom.js","webpack:///./src/trail.js","webpack:///./~/css.escape/css.escape.js","webpack:///./src/styles.scss?ccec","webpack:///./src/template.html","webpack:///(webpack)/buildin/global.js"],"names":["VERSION_INFO","version","build","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","validate","ui","chart","lockNonSelected","splash","state","time","parse","start","formatDate","end","default_model","entities","entities_colorlegend","marker","limit","space","axis_x","use","index","type","axis_y","label","size","color","syncModels","size_label","which","scaleType","_important","extent","allow","names","locale","decorations","enabled","xAxisGroups","superhighlightOnMinimapHover","whenHovering","showProjectionLineX","showProjectionLineY","higlightValueX","higlightValueY","labels","dragging","removeLabelBox","margin","left","top","trails","datawarning","doubtDomain","doubtRange","show_ticks","presentation","panWithArrow","adaptMinMaxZoom","cursorMode","zoomOnScrolling","buttons","dialogs","popup","sidebar","moreoptions","versionInfo","utils","helpers","Exporter","svgexport","Labels","axisSmart","DynamicBackground","iconset","iconWarn","warn","iconQuestion","question","BubbleChart","config","context","_this","template","require","model_expects","model_binds","evt","original","isTouchDevice","playing","someHighlighted","clearHighlighted","_readyOnce","filter","hook","dim","length","ready","_trails","create","then","run","record","_export","open","element","reset","toggle","redrawDataPoints","_updateDecorations","path","indexOf","yScale","xScale","updateSize","updateMarkerSizeLimits","draggingNow","approxEqual","_zoomedXYMinMax","zoomedMin","zoomedMax","playAfterZoom","pause","_panZoom","zoomToMaxMin","getZoomedMin","getZoomedMax","postponePause","entityBubbles","source","_val","_previousVal","selectDataPoints","updateBubbleOpacity","_updateDoubtOpacity","_blinkSuperHighlighted","titles","_formatSTitleValues","_updateSTitle","highlightDataPoints","calculationQueue","value","toString","push","getFrame","frame","_frameIsValid","splice","frameChanged","expandCanvas","redrawDataPointsOnlySize","redrawDataPointsOnlyColors","svg","chartSvg","classed","someSelected","clearSelected","sScale","cScale","xAxis","yAxis","COLOR_BLACKISH","COLOR_WHITEISH","isCanvasPreviouslyExpanded","Trail","PanZoom","prefix","deleteClasses","_labels","CSS_PREFIX","LABELS_CONTAINER_CLASS","LINES_CONTAINER_CLASS","LINES_CONTAINER_SELECTOR_PREFIX","_rangeBump","arg","undo","bump","activeProfile","maxRadiusPx","isArray","z1","z2","readyOnce","scrollableAncestor","findScrollableAncestor","d3","select","graph","yAxisElContainer","yAxisEl","xAxisElContainer","xAxisEl","ySubTitleEl","xSubTitleEl","yTitleEl","xTitleEl","sTitleEl","cTitleEl","yearEl","year","yInfoEl","xInfoEl","dataWarningEl","projectionX","projectionY","decorationsEl","lineEqualXY","xAxisGroupsEl","trailsContainer","bubbleContainerCrop","zoomSelection","labelsContainerCrop","bubbleContainer","labelsContainer","linesContainer","zoomRect","eventArea","bubbleCrown","selectAll","attr","location","pathname","tooltipMobile","on","xMin","xMax","yMin","yMax","zoomer","dontFeedToState","rerun","event","metaKey","ctrlKey","root","call","dragRectangle","cursor","defaultPrevented","zoomByIncrement","TIMEDIM","getDimension","KEYS","unique","_getAllDimensions","exceptType","KEY","join","dataKeys","getDataKeysPerHook","updateUIStrings","wScale","scaleLinear","domain","range","Object","keys","endTime","updateIndicators","updateTime","defer","updateEntities","zoomToMarkerMaxMin","resetZoomState","xDomain","getScale","yDomain","zoomedMinX","zoomedMaxX","zoomedMinY","zoomedMaxY","setScales","tickFormat","getTickFormatter","duration","_reorderEntities","_getSubtitle","title","shortTitle","subtitle","replace","slice","regexpResult","exec","trim","layoutProfile","getLayoutProfile","conceptPropsY","getConceptprops","conceptPropsX","conceptPropsS","conceptPropsC","translator","getTFunction","strings","Y","X","S","C","title_short","name_short","unit","ySubTitle","data","enter","append","xSubTitle","yTitle","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","xTitle","sTitle","setIcon","text","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","getBoundingClientRect","chartRect","node","setHook","show","setPos","hide","opacity","getKeys","map","pointer","assign","d","sortValue","getKey","sort","a","b","markers","setVisible","unselectBubblesWithNoData","getVisible","exit","remove","i","_bubblesInteract","mouseover","mouseout","click","onTap","stopPropagation","onLongTap","merge","_select","forEach","sizeA","sizeB","descending","ascending","trailStartTime","status","highlightMarker","showCloseCross","isSelected","selectMarker","time_1","delayAnimations","setText","svgWidth","px2num","svgHeight","marginScaleH","marginMin","ratio","marginScaleW","profiles","small","bottom","right","leftMarginRatio","padding","minRadiusPx","maxRadiusEm","infoElHeight","yAxisTitleBottomMargin","xAxisTitleBottomMargin","medium","large","hideSTitle","presentationProfileChanges","getActiveProfile","containerWH","getVizWidthHeight","Math","max","hypotenuse","width","setCloseCrossHeight","setTooltipFontSize","parseInt","resize","rangePoints","scale","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","viewportLength","formatter","yTitleText","xTitleText","titleBBox","t","transform","hTranslate","translateX","vTranslate","translateY","_resizeDataWarning","set","showxAxisGroups","axisGroupsData","each","view","xAxisGroups_calcs","useShorterLabels","calcs","min","textHeight","textWidth","boundaryMinX_px","boundaryMaxX_px","centerX_px","marginX_px","abs","label_short","isFirst","isLast","minMargin","transition","showLineEqualXY","concat","dataWarningText","dataWarningWidth","remainingWidth","font","warnBB","minRadius","maxRadius","minArea","radiusToArea","maxArea","valuesNow","valuesLocked","selected","valueC","scaledC","find","f","valuesTrailStart","cache","scaledC0","updateLabelOnlyColor","valueS","scaledS","areaToRadius","scaledS0","updateLabelOnlyPosition","lockedFrame","_updateBubble","values","showhide","valueY","valueX","valueL","valueLST","hidden","ease","easeExp","easeLinear","interrupt","write","id","getUTCFullYear","fill","cx","cy","r","_updateLabel","labelX0","labelY0","labelText","_getLabelText","updateLabel","getCompoundLabelText","_setTooltip","tooltipText","s","c","labelValues","tooltipCache","invert","setTooltip","titleS","titleC","unitS","unitC","formatterS","formatterC","isDiscrete","getColorlegendMarker","getItems","sTitleContentON","cTitleContentON","sTitleText","sTitleWidth","remainigHeight","_setBubbleCrown","nonSelectedOpacityZero","glow","skipInnerFill","_axisProjections","radius","highlightValue","highlight","clone","entityOutOfView","hoverTrail","selectedData","target","skipCrownInnerFill","clonedSelectedData","isSuperHighlighted","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","Class","drag","zoom","subject","dragSubject","go","stop","zoomFilter","scaleExtent","Infinity","ratioX","ratioY","self","sourceEvent","touches","targetTouches","mouse","origin","e","compensateDragging","_zoomOnRectangle","_data","k","pan","isNaN","deltaY","wheelDelta","minZoomScale","zoomXOut","zoomYOut","property","zoomIdentity","translate","xPanOffset","yPanOffset","xRange","yRange","xRangeBumped","yRangeBumped","xRangeMinOffset","xRangeMaxOffset","yRangeMinOffset","yRangeMaxOffset","xRangeBounds","yRangeBounds","xRangeBoundsBumped","yRangeBoundsBumped","rangeBands","n","isDate","toFixed","zoomedXRange","zoomedYRange","optionsY","optionsX","transitionDuration","mmX","mmY","suggestedFrame","x1","y1","x2","y2","xBounds","yBounds","TOLERANCE","xBoundsBumped","yBoundsBumped","minX","maxX","minY","maxY","zoomedX1","zoomedY1","zoomedX2","zoomedY2","zoomTransform","minZoom","maxZoom","direction","log","LN2","floor","ceil","locus","pow","scaleBy","_isCreated","actionsQueue","entityTrails","trailsData","trailsInProgress","activePromises","trailTransitions","delayedIterations","drawingQueue","_context","selection","Promise","resolve","reject","timePoints","getAllSteps","promises","_clearActions","selectedEntityData","key","insert","querySelector","trail","trailSegmentData","m","segment","getModelObject","trigger","all","_addActions","selections","actions","promise","_getNextAction","shift","action","pop","executeSequential","response","_remove","parentNode","_resize","transparent","next","lineLength","sqrt","_recolor","strokeColor","getColorShade","colorID","shadeID","_opacityHandler","_findVisible","resolve1","reject1","limits","getEntityLimits","cached","segmentVisibility","visibilityChanged","_groups","_abortAnimation","_reveal","delay","generateTrailSegment","nextIndex","level","datum","nextSegment","previous","nextTime","nextFrame","addNewIntervals","addPointBetween","previousIndex","previousSegment","firstLineLength","secondLineLength","mediumIndex","getPointBetween","first","round","_generateKeys","div","maxValue","minValue","__data__","unshift","processPoints","processPoint","pointIndex","random","point","JSON","stringify","generateTrails","processPointsBetween","framesAreReady","trailKeys","segments"],"mappings":"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","file":"bubblechart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b95122d050626ef8de8a","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\nexport default Vizabi.Tool.extend(\"BubbleChart\", {\n\n  /**\n   * Initializes the tool (Bubble Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"bubblechart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.time\", \"locale\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    this._super(placeholder, external_model);\n\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    if (model.ui.chart.lockNonSelected && (!model.ui.splash || model.state.time.splash === false)) {\n      const time = model.state.time.parse(\"\" + model.ui.chart.lockNonSelected);\n      if (time < model.state.time.start) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.start);\n      if (time > model.state.time.end) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.end);\n    }\n  },\n\n  /**\n   * Determines the default model of this tool\n   */\n  default_model: {\n    state: {\n      time: {\n        \"autoconfig\": {\n          \"type\": \"time\"\n        }\n      },\n      entities: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_colorlegend: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      marker: {\n        limit: 5000,\n        space: [\"entities\", \"time\"],\n        axis_x: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 0,\n            type: \"measure\"\n          }\n        },\n        axis_y: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 1,\n            type: \"measure\"\n          }\n        },\n        label: {\n          use: \"property\",\n          \"autoconfig\": {\n            \"includeOnlyIDs\": [\"name\"],\n            \"type\": \"string\"\n          }\n        },\n        size: {\n          \"autoconfig\": {\n              index: 2,\n              type: \"measure\"\n            }\n        },\n        color: {\n          syncModels: [\"marker_colorlegend\"],\n          \"autoconfig\": {}\n        },\n        size_label: {\n          use: \"constant\",\n          which: \"_default\",\n          scaleType: \"ordinal\",\n          _important: false,\n          extent: [0, 0.33],\n          allow: {\n            names: [\"_default\"]\n          }\n        },\n      },\n      \"marker_colorlegend\": {\n        \"space\": [\"entities_colorlegend\"],\n        \"label\": {\n          \"use\": \"property\",\n          \"which\": \"name\"\n        },\n        \"hook_rank\": {\n          \"use\": \"property\",\n          \"which\": \"rank\"\n        },\n        \"hook_geoshape\": {\n          \"use\": \"property\",\n          \"which\": \"shape_lores_svg\"\n        }\n      }\n    },\n    locale: {},\n    ui: {\n      chart: {\n        decorations: {\n          enabled: true,\n          xAxisGroups: null\n        },\n        superhighlightOnMinimapHover: true,\n        whenHovering: {\n          showProjectionLineX: true,\n          showProjectionLineY: true,\n          higlightValueX: true,\n          higlightValueY: true\n        },\n        labels: {\n          dragging: true,\n          removeLabelBox: false\n        },\n        margin: {\n          left: 0,\n          top:0\n        },\n        trails: true,\n        lockNonSelected: 0\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      show_ticks: true,\n      presentation: false,\n      panWithArrow: false,\n      adaptMinMaxZoom: false,\n      cursorMode: \"arrow\",\n      zoomOnScrolling: false,\n      buttons: [\"colors\", \"find\", \"zoom\", \"trails\", \"lock\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      dialogs: {\n        popup: [\"colors\", \"find\", \"size\", \"zoom\", \"moreoptions\"],\n        sidebar: [\"colors\", \"find\", \"size\", \"zoom\"],\n        moreoptions: [\"opacity\", \"speed\", \"axes\", \"size\", \"colors\", \"label\", \"zoom\", \"presentation\", \"about\"]\n      }\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const { utils } = Vizabi;\n\nconst {\n  svgexport: Exporter,\n  labels: Labels,\n  'd3.axisWithLabelPicker': axisSmart,\n  'd3.dynamicBackground': DynamicBackground\n} = Vizabi.helpers;\n\nconst {\n  warn: iconWarn,\n  question: iconQuestion\n} = Vizabi.iconset;\n\nimport Trail from './trail';\nimport PanZoom from './panzoom';\n\n\n// BUBBLE CHART COMPONENT\nconst BubbleChart = Vizabi.Component.extend(\"bubblechart\", {\n\n  /**\n   * Initializes the component (Bubble Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    const _this = this;\n    this.name = \"bubblechart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    this.model_binds = {\n      \"change:time.playing\": function(evt, original) {\n        if (utils.isTouchDevice() && _this.model.time.playing && _this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n      },\n      \"change:time.start\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        if ([\"color\", \"axis_x\", \"axis_y\"].filter(hook => _this.model.marker[hook].which == _this.model.time.dim).length) {\n          _this.ready();\n          return;          \n        };\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.end\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        if ([\"color\", \"axis_x\", \"axis_y\"].filter(hook => _this.model.marker[hook].which == _this.model.time.dim).length) {\n          _this.ready();\n          return;          \n        };\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.record\": function() {\n        //console.log(\"change time record\");\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:ui.chart.trails\": function(evt) {\n        //console.log(\"EVENT change:time:trails\");\n        if (!_this._readyOnce) return;\n        _this._trails.toggle(_this.model.ui.chart.trails);\n        _this.redrawDataPoints();\n      },\n      \"change:ui.chart.lockNonSelected\": function(evt) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:time:lockNonSelected\");\n        _this.redrawDataPoints(500);\n      },\n      \"change:ui.chart.decorations\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateDecorations(500);\n      },\n      \n      \"change:marker\": function(evt, path) {\n        // bubble size change is processed separately\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n\n        if (path.indexOf(\"marker.color\") !== -1) return;\n        if (path.indexOf(\"marker.size\") !== -1) return;\n        if (path.indexOf(\"marker.size_label\") !== -1) return;\n\n        if (path.indexOf(\"domainMin\") > -1 || path.indexOf(\"domainMax\") > -1) {\n          if (!_this.yScale || !_this.xScale) return; //abort if building of the scale is in progress\n          _this.updateSize();\n          _this.updateMarkerSizeLimits();\n          _this._trails.run(\"findVisible\");\n          _this.redrawDataPoints();\n          _this._trails.run(\"resize\", null, 500);\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          if (_this.draggingNow) return;\n\n          //avoid zooming again if values didn't change.\n          //also prevents infinite loop on forced URL update from zoom.stop()\n          if (utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMin, _this.model.marker.axis_x.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMax, _this.model.marker.axis_x.zoomedMax, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMin, _this.model.marker.axis_y.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMax, _this.model.marker.axis_y.zoomedMax, 0.01)\n          ) return;\n          let playAfterZoom = false;\n          if (_this.model.time.playing) {\n            playAfterZoom = true;\n            _this.model.time.pause(true);\n          }\n          _this._trails.run(\"abortAnimation\");\n          _this._panZoom.zoomToMaxMin(\n            _this.model.marker.axis_x.getZoomedMin(),\n            _this.model.marker.axis_x.getZoomedMax(),\n            _this.model.marker.axis_y.getZoomedMin(),\n            _this.model.marker.axis_y.getZoomedMax(),\n            500 /*duration*/, \"don't feed these zoom values back to state\"\n          );\n          if (playAfterZoom) {\n            _this.model.time.postponePause = false;\n          }\n        }\n\n        //console.log(\"EVENT change:marker\", evt);\n      },\n      \"change:marker.select\": function(evt, path) {\n        if (!_this._readyOnce || !_this.entityBubbles) return;\n        //console.log(\"EVENT change:marker:select\");\n\n        //disable trails if too many items get selected at once\n        //otherwise it's too much waiting time\n        if ((evt.source._val || []).length - (evt.source._previousVal || []).length > 50) _this.model.ui.chart.trails = false;\n\n        _this.selectDataPoints();\n        _this.redrawDataPoints();\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n        _this.updateBubbleOpacity();\n        _this._updateDoubtOpacity();\n      },\n      \"change:marker.superHighlight\": (evt, path) => {\n        if (this._readyOnce) {\n          this._blinkSuperHighlighted();\n        }\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //path have values if trail is highlighted\n        if (path != \"highlight\") {\n          if (path !== null) {\n            const titles = _this._formatSTitleValues(path.size, path.color);\n            _this._updateSTitle(titles[0], titles[1]);\n          } else {\n            _this._updateSTitle();\n          }\n          return;\n        }\n        //console.log(\"EVENT change:marker:highlight\");\n        _this.highlightDataPoints();\n      },\n      \"change:time.value\": function() {\n        if (_this.model.time.splash || !_this._readyOnce || !_this.entityBubbles) return;\n        if (!_this.calculationQueue) { // collect timestamp that we request\n          _this.calculationQueue = [_this.model.time.value.toString()];\n        } else {\n          _this.calculationQueue.push(_this.model.time.value.toString());\n        }\n        (function(time) { // isolate timestamp\n          //_this._bubblesInteract().mouseout();\n          _this.model.marker.getFrame(time, (frame, time) => {\n            if (!_this._frameIsValid(frame)) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n            const index = _this.calculationQueue.indexOf(time.toString()); //\n            if (index == -1) { // we was receive more recent frame before so we pass this frame\n              return;\n            }\n            _this.calculationQueue.splice(0, index + 1); // remove timestamps that added to queue before current timestamp\n            _this.frameChanged(frame, time);\n          });\n\n        })(_this.model.time.value);\n      },\n      \"change:ui.adaptMinMaxZoom\": function() {\n        //console.log(\"EVENT change:ui:adaptMinMaxZoom\");\n        if (_this.model.ui.adaptMinMaxZoom) {\n          _this._panZoom.expandCanvas(500);\n        } else {\n          _this._panZoom.reset();\n        }\n      },\n      \"change:marker.size.extent\": function(evt, path) {\n        //console.log(\"EVENT change:marker:size:max\");\n        if (!_this._readyOnce) return;\n        _this.updateMarkerSizeLimits();\n        _this.redrawDataPointsOnlySize();\n        _this._trails.run(\"resize\");\n      },\n      \"change:marker.color\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:marker:color:palette\");\n        _this.redrawDataPointsOnlyColors();\n        _this._trails.run(\"recolor\");\n      },\n      // 'change:marker.color.palette': function(evt, path) {\n      //   if(!_this._readyOnce) return;\n      //   //console.log(\"EVENT change:marker:color:palette\");\n      //   _this.redrawDataPointsOnlyColors();\n      //   _this._trails.run(\"recolor\");\n      // },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBubbleOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBubbleOpacity();\n        _this._trails.run(\"opacityHandler\");\n      },\n      \"change:ui.cursorMode\": function() {\n        const svg = _this.chartSvg;\n        if (_this.model.ui.cursorMode === \"plus\") {\n          svg.classed(\"vzb-zoomin\", true);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"minus\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", true);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"hand\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", true);\n        } else {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        }\n      },\n      \"change:marker.space\": function() {\n        if (_this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n        if (_this.someSelected) {\n          _this.model.marker.clearSelected();\n        }\n      },\n      \"ready\": function() {\n        // if(_this.model.marker.color.scaleType === 'time') {\n        //   _this.model.marker.color.scale = null;\n        //   utils.defer(function() {\n        //     _this.trigger('ready');\n        //   });\n        // }\n      }\n    };\n\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.sScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n\n    _this.COLOR_BLACKISH = \"#333\";\n    _this.COLOR_WHITEISH = \"#fdfdfd\";\n\n    this.isCanvasPreviouslyExpanded = false;\n    this.draggingNow = null;\n\n    this._trails = new Trail(this);\n    this._panZoom = new PanZoom(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-bc-\")\n      .deleteClasses([\"vzb-bc-bubbles-crop\", \"vzb-hidden\", \"vzb-bc-year\", \"vzb-bc-zoom-rect\",\n        \"vzb-bc-projection-x\", \"vzb-bc-projection-y\", \"vzb-bc-axis-c-title\"\n      ]);\n    this._labels = new Labels(this);\n    this._labels.config({\n      CSS_PREFIX: \"vzb-bc\",\n      LABELS_CONTAINER_CLASS: \"vzb-bc-labels\",\n      LINES_CONTAINER_CLASS: \"vzb-bc-bubbles\",\n      LINES_CONTAINER_SELECTOR_PREFIX: \"bubble-\"\n    });\n  },\n\n  _rangeBump(arg, undo) {\n    const bump = this.activeProfile.maxRadiusPx / 2;\n    undo = undo ? -1 : 1;\n    if (utils.isArray(arg) && arg.length > 1) {\n      let z1 = arg[0];\n      let z2 = arg[arg.length - 1];\n\n      //the sign of bump depends on the direction of the scale\n      if (z1 < z2) {\n        z1 += bump * undo;\n        z2 -= bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 > z2) z1 = z2 = (z1 + z2) / 2;\n      } else if (z1 > z2) {\n        z1 -= bump * undo;\n        z2 += bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 < z2) z1 = z2 = (z1 + z2) / 2;\n      } else {\n        // rangeBump error: the input scale range has 0 length. that sucks but we keep cool\n      }\n      return [z1, z2];\n    }\n    utils.warn(\"rangeBump error: input is not an array or empty\");\n  },\n\n\n  /**\n   * Executes right after the template is in place, but the model is not yet ready\n   */\n  readyOnce() {\n    const _this = this;\n    this._readyOnce = false;\n    this.scrollableAncestor = utils.findScrollableAncestor(this.element);\n    this.element = d3.select(this.element);\n\n    // reference elements\n    this.chartSvg = this.element.select(\"svg\");\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisElContainer = this.graph.select(\".vzb-bc-axis-y\");\n    this.yAxisEl = this.yAxisElContainer.select(\"g\");\n\n    this.xAxisElContainer = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisEl = this.xAxisElContainer.select(\"g\");\n\n    this.ySubTitleEl = this.graph.select(\".vzb-bc-axis-y-subtitle\");\n    this.xSubTitleEl = this.graph.select(\".vzb-bc-axis-x-subtitle\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.xTitleEl = this.graph.select(\".vzb-bc-axis-x-title\");\n    this.sTitleEl = this.graph.select(\".vzb-bc-axis-s-title\");\n    this.cTitleEl = this.graph.select(\".vzb-bc-axis-c-title\");\n    this.yearEl = this.graph.select(\".vzb-bc-year\");\n\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.yInfoEl = this.graph.select(\".vzb-bc-axis-y-info\");\n    this.xInfoEl = this.graph.select(\".vzb-bc-axis-x-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.projectionX = this.graph.select(\".vzb-bc-projection-x\");\n    this.projectionY = this.graph.select(\".vzb-bc-projection-y\");\n    this.decorationsEl = this.graph.select(\".vzb-bc-decorations\");\n    this.lineEqualXY = this.decorationsEl.select(\".vzb-bc-line-equal-xy\");\n    this.xAxisGroupsEl = this.decorationsEl.select(\".vzb-bc-x-axis-groups\");\n\n    this.trailsContainer = this.graph.select(\".vzb-bc-trails\");\n    this.bubbleContainerCrop = this.graph.select(\".vzb-bc-bubbles-crop\");\n    this.zoomSelection = this.graph.select(\".vzb-zoom-selection\");\n    this.labelsContainerCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bubbleContainer = this.graph.select(\".vzb-bc-bubbles\");\n    this.labelsContainer = this.graph.select(\".vzb-bc-labels\");\n    this.linesContainer = this.graph.select(\".vzb-bc-lines\");\n    this.zoomRect = this.element.select(\".vzb-bc-zoom-rect\");\n    this.eventArea = this.element.select(\".vzb-bc-eventarea\");\n\n    this.entityBubbles = null;\n    this.bubbleCrown = this.element.select(\".vzb-bc-bubble-crown\");\n    //set filter\n    this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n      .attr(\"filter\", \"url(\" + location.pathname + \"#vzb-glow-filter)\");\n    this.tooltipMobile = this.element.select(\".vzb-tooltip-mobile\");\n    //component events\n    this.on(\"resize\", () => {\n      //console.log(\"EVENT: resize\");\n      //return if updatesize exists with error\n      _this._trails.run(\"abortAnimation\");\n      if (_this.updateSize()) return;\n      _this.updateMarkerSizeLimits();\n      _this._labels.updateSize();\n      (function(xMin, xMax, yMin, yMax) {\n        _this._panZoom.zoomer.dontFeedToState = true;\n        _this._panZoom.rerun(); // includes redraw data points and trail resize\n        _this._panZoom.zoomToMaxMin(xMin, xMax, yMin, yMax, 0, true);\n      })(_this._zoomedXYMinMax.axis_x.zoomedMin,\n        _this._zoomedXYMinMax.axis_x.zoomedMax,\n        _this._zoomedXYMinMax.axis_y.zoomedMin,\n        _this._zoomedXYMinMax.axis_y.zoomedMax);\n    });\n\n    //keyboard listeners\n    d3.select(\"body\")\n      .on(\"keydown\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (d3.event.metaKey || d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", true);\n      })\n      .on(\"keyup\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      })\n      //this is for the case when user would press ctrl and move away from the browser tab or window\n      //keyup event would happen somewhere else and won't be captured, so zoomin class would get stuck\n      .on(\"mouseenter\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      });\n\n    this.root.on(\"resetZoom\", () => {\n      _this._panZoom.reset(null, 500);\n    });\n\n    this._panZoom.zoomSelection(this.bubbleContainerCrop);\n    this.bubbleContainerCrop\n      .call(this._panZoom.dragRectangle)\n      .call(this._panZoom.zoomer)\n      .on(\"dblclick.zoom\", null)\n      .on(\"mouseup\", () => {\n        _this.draggingNow = false;\n      })\n      .on(\"click\", () => {\n        const cursor = _this.model.ui.cursorMode;\n        if (!d3.event.defaultPrevented && cursor !== \"arrow\" && cursor !== \"hand\") {\n          _this._panZoom.zoomByIncrement(cursor, 500);\n        }\n      });\n\n    this.TIMEDIM = this.model.time.getDimension();\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n\n    this.updateUIStrings();\n\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n\n    this._labels.readyOnce();\n\n    _this._readyOnce = true;\n  },\n\n  _frameIsValid(frame) {\n    return !(!frame\n    || Object.keys(frame.axis_y).length === 0\n    || Object.keys(frame.axis_x).length === 0\n    || Object.keys(frame.size).length === 0);\n  },\n\n  ready() {\n    const _this = this;\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n\n    this.updateUIStrings();\n    const endTime = this.model.time.end;\n    this.updateIndicators();\n    this.updateTime();\n    if (!_this.model.time.splash) {\n      _this._trails.create();\n    }\n    this.model.marker.getFrame(this.model.time.value, (frame, time) => {\n      // TODO: temporary fix for case when after data loading time changed on validation\n      if (time.toString() != _this.model.time.value.toString()) {\n        utils.defer(() => {\n          _this.ready();\n        });\n        return;\n      }\n      if (!_this._frameIsValid(frame)) return utils.warn(\"ready: empty data received from marker.getFrame(). doing nothing\");\n\n      _this.frame = frame;\n      _this.updateSize();\n      _this.updateMarkerSizeLimits();\n      _this.updateEntities();\n      _this._labels.ready();\n      _this.redrawDataPoints();\n      _this.selectDataPoints();\n      _this.updateBubbleOpacity();\n      _this._updateDoubtOpacity();\n      _this.zoomToMarkerMaxMin(); // includes redraw data points and trail resize\n      if (!_this.model.time.splash) {\n        _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      }\n      if (_this.model.ui.adaptMinMaxZoom) _this._panZoom.expandCanvas();\n    });\n  },\n\n  /*\n   * Zoom to the min and max values given in the URL axes markers.\n   */\n  zoomToMarkerMaxMin() {\n    /*\n     * Reset just the zoom values without triggering a zoom event. This ensures\n     * a clean zoom state for the subsequent zoom event.\n     */\n    this._panZoom.resetZoomState();\n\n    const xAxis = this.model.marker.axis_x;\n    const yAxis = this.model.marker.axis_y;\n\n    const xDomain = xAxis.getScale().domain();\n    const yDomain = yAxis.getScale().domain();\n\n    /*\n     * The axes may return null when there is no value given for the zoomed\n     * min and max values. In that case, fall back to the axes' domain values.\n     */\n    const zoomedMinX = xAxis.getZoomedMin();\n    const zoomedMaxX = xAxis.getZoomedMax();\n    const zoomedMinY = yAxis.getZoomedMin();\n    const zoomedMaxY = yAxis.getZoomedMax();\n\n    //by default this will apply no transition and feed values back to state\n    this._panZoom.zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, 0, \"don't feed these zoom values back to state\");\n  },\n\n  /*\n   * UPDATE INDICATORS\n   */\n  updateIndicators() {\n    const _this = this;\n\n    //scales\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.sScale = this.model.marker.size.getScale();\n    this.cScale = this.model.marker.color.getScale();\n    this._labels.setScales(this.xScale, this.yScale);\n\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  frameChanged(frame, time) {\n//    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.frame = frame;\n    this.updateTime();\n\n    this._updateDoubtOpacity();\n    this._trails.run(\"findVisible\");\n    if (this.model.ui.adaptMinMaxZoom) {\n      this._panZoom.expandCanvas();\n    } else {\n      this.redrawDataPoints();\n    }\n    this._trails.run(\"reveal\", null, this.duration);\n    this.tooltipMobile.classed(\"vzb-hidden\", true);\n    this._reorderEntities();\n  },\n\n  _getSubtitle(title, shortTitle) {\n    let subtitle = title.replace(shortTitle,\"\");\n    if (subtitle[0] === \",\") subtitle = subtitle.slice(1);\n    const regexpResult = /^\\((.*)\\)$|.*/.exec(subtitle.trim());\n    return regexpResult[1] || regexpResult[0] || \"\";\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    const layoutProfile = this.getLayoutProfile();\n\n    const conceptPropsY = _this.model.marker.axis_y.getConceptprops();\n    const conceptPropsX = _this.model.marker.axis_x.getConceptprops();\n    const conceptPropsS = _this.model.marker.size.getConceptprops();\n    const conceptPropsC = _this.model.marker.color.getConceptprops();\n    this.translator = this.model.locale.getTFunction();\n\n    this.strings = {\n      title: {\n        Y: conceptPropsY.name,\n        X: conceptPropsX.name,\n        S: conceptPropsS.name,\n        C: conceptPropsC.name\n      },\n      title_short: {\n        Y: conceptPropsY.name_short,\n        X: conceptPropsX.name_short,\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      subtitle: {\n        Y: this._getSubtitle(conceptPropsY.name, conceptPropsY.name_short),\n        X: this._getSubtitle(conceptPropsX.name, conceptPropsX.name_short),\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      unit: {\n        Y: conceptPropsY.unit || \"\",\n        X: conceptPropsX.unit || \"\",\n        S: conceptPropsS.unit || \"\",\n        C: conceptPropsC.unit || \"\"\n      }\n    };\n\n    const ySubTitle = this.ySubTitleEl.selectAll(\"text\").data([0]);\n    ySubTitle.enter().append(\"text\");\n    const xSubTitle = this.xSubTitleEl.selectAll(\"text\").data([0]);\n    xSubTitle.enter().append(\"text\");\n\n    const yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    yTitle.enter().append(\"text\");\n    yTitle\n    //.attr(\"y\", \"-6px\")\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_y\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"bottom\")\n          .updateView()\n          .toggle();\n      });\n\n    const sTitle = this.sTitleEl.selectAll(\"text\").data([0]);\n    sTitle.enter().append(\"text\");\n    sTitle\n      .attr(\"text-anchor\", \"end\");\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.yInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsY.description || conceptPropsY.sourceLink)));\n\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.yInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.yInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.yInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this._updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this._updateDoubtOpacity();\n      });\n  },\n\n  _updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.model.time.formatDate(this.time));\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  /*\n   * UPDATE ENTITIES:\n   * Ideally should only update when show parameters change or data changes\n   */\n  updateEntities() {\n    const _this = this;\n    const dataKeys = this.dataKeys = this.model.marker.getDataKeysPerHook();\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    const getKeys = function(prefix) {\n      prefix = prefix || \"\";\n      return _this.model.marker.getKeys()\n        .map(d => {\n          const pointer = Object.assign({}, d);\n          //pointer[KEY] = d[KEY];\n          pointer[TIMEDIM] = endTime;\n          pointer.sortValue = _this.frame.size[utils.getKey(d, dataKeys.size)] || 0;\n          pointer[KEY] = prefix + utils.getKey(d, KEYS);\n          return pointer;\n        })\n        .sort((a, b) => b.sortValue - a.sortValue);\n    };\n\n    // get array of GEOs, sorted by the size hook\n    // that makes larger bubbles go behind the smaller ones\n    const endTime = this.model.time.end;\n    const markers = getKeys.call(this);\n    this.model.marker.setVisible(markers);\n\n    //unselecting bubbles with no data is used for the scenario when\n    //some bubbles are selected and user would switch indicator.\n    //bubbles would disappear but selection would stay\n    if (!this.model.time.splash) {\n      this.unselectBubblesWithNoData(markers);\n    }\n    this.entityBubbles = this.bubbleContainer.selectAll(\"circle.vzb-bc-entity\")\n      .data(this.model.marker.getVisible(), d => d[KEY]); // trails have not keys\n\n    //exit selection\n    this.entityBubbles.exit().remove();\n\n    //enter selection -- init circles\n    this.entityBubbles = this.entityBubbles.enter().append(\"circle\")\n      .attr(\"class\", d => \"vzb-bc-entity \" + \"bubble-\" + d[KEY])\n      .on(\"mouseover\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n        _this._bubblesInteract().mouseover(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().click(d, i);\n      })\n      .onTap((d, i) => {\n        d3.event.stopPropagation();\n        _this._bubblesInteract().click(d, i);\n      })\n      .onLongTap((d, i) => {\n      })\n      .merge(this.entityBubbles);\n\n    this._reorderEntities();\n  },\n\n  unselectBubblesWithNoData(entities) {\n    const _this = this;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    if (!this.model.marker.select.length) return;\n\n    const _select = [];\n    const keys = entities.map(d => d[KEY]);\n\n    this.model.marker.select.forEach(d => {\n      if (keys.indexOf(utils.getKey(d, KEYS)) !== -1) _select.push(d);\n    });\n\n    if (_select.length !== _this.model.marker.select.length) _this.model.marker.select = _select;\n  },\n\n  _reorderEntities() {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n    const KEY = this.KEY;\n    this.bubbleContainer.selectAll(\".vzb-bc-entity\")\n      .sort((a, b) => {\n        const sizeA = _this.frame.size[utils.getKey(a, dataKeys.size)];\n        const sizeB = _this.frame.size[utils.getKey(b, dataKeys.size)];\n\n        if (typeof sizeA === \"undefined\" && typeof sizeB !== \"undefined\") return -1;\n        if (typeof sizeA !== \"undefined\" && typeof sizeB === \"undefined\") return 1;\n        if (sizeA != sizeB) return d3.descending(sizeA, sizeB);\n        if (a[KEY] != b[KEY]) return d3.ascending(a[KEY], b[KEY]);\n        if (typeof a.trailStartTime !== \"undefined\" || typeof b.trailStartTime !== \"undefined\") return typeof a.trailStartTime !== \"undefined\" ? -1 : 1; // only lines has trailStartTime\n        if (typeof a.status !== \"undefined\" || typeof b.status !== \"undefined\") return typeof a.status !== \"undefined\" ? -1 : 1; // only trails has attribute status\n        return d3.descending(sizeA, sizeB);\n      });\n  },\n\n  _bubblesInteract() {\n    const _this = this;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    return {\n      mouseover(d, i) {\n        _this.model.marker.highlightMarker(d);\n\n        _this._labels.showCloseCross(d, true);\n      },\n\n      mouseout(d, i) {\n        _this.model.marker.clearHighlighted();\n\n        _this._labels.showCloseCross(d, false);\n      },\n\n      click(d, i) {\n        if (_this.draggingNow) return;\n        const isSelected = _this.model.marker.isSelected(d);\n        _this.model.marker.selectMarker(d);\n        //return to highlighted state\n        if (!utils.isTouchDevice()) {\n          if (isSelected) _this.model.marker.highlightMarker(d);\n          _this.highlightDataPoints();\n        }\n      }\n    };\n  },\n\n\n  /*\n   * UPDATE TIME:\n   * Ideally should only update when time or data changes\n   */\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time, \"ui\"), this.duration);\n  },\n\n  /*\n   * RESIZE:\n   * Executed whenever the container is resized\n   */\n  updateSize() {\n\n    const { chartSvg } = this;\n    const svgWidth = utils.px2num(chartSvg.style(\"width\"));\n    const svgHeight = utils.px2num(chartSvg.style(\"height\"));\n    const marginScaleH = (marginMin, ratio = 0) => marginMin + svgHeight * ratio;\n    const marginScaleW = (marginMin, ratio = 0) => marginMin + svgWidth * ratio;\n\n    const profiles = {\n      small: {\n        margin: { top: 30, bottom: 35, left: 30, right: 10},\n        leftMarginRatio: 1,\n        padding: 2,\n        minRadiusPx: 0.5,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 16,\n        yAxisTitleBottomMargin: 6,\n        xAxisTitleBottomMargin: 4\n      },\n      medium: {\n        margin: { top: 15, bottom: 40, left: 40, right: 15},\n        leftMarginRatio: 1.6,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 20,\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4\n      },\n      large: {\n        margin: { top: 15, bottom: marginScaleH(30, 0.03), left: marginScaleW(31, 0.015), right: 20},\n        leftMarginRatio: 1.8,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 22,\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(0, 0.01),\n        hideSTitle: true\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, bottom: 55, left: 50, right: 20 },\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4,\n        infoElHeight: 26,\n      },\n      large: {\n        margin: { top: 30, bottom: marginScaleH(45, 0.03), left: marginScaleW(35, 0.025), right: 30 },\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(-10, 0.01),\n        infoElHeight: 32,\n        hideSTitle: true\n      }\n    };\n    \n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const layoutProfile = this.getLayoutProfile();\n    const containerWH = this.root.getVizWidthHeight();\n    this.activeProfile.maxRadiusPx = Math.max(\n      this.activeProfile.minRadiusPx,\n      this.activeProfile.maxRadiusEm * utils.hypotenuse(containerWH.width, containerWH.height)\n    );\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //labels\n    _this._labels.setCloseCrossHeight(_this.activeProfile.infoElHeight * 1.2);\n    _this._labels.setTooltipFontSize(_this.activeProfile.infoElHeight + \"px\");\n    \n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left * this.activeProfile.leftMarginRatio - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Bubble chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph\n      .attr(\"transform\", \"translate(\" + (margin.left * this.activeProfile.leftMarginRatio) + \",\" + margin.top + \")\");\n\n    this.year.resize(this.width, this.height);\n    this.eventArea\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    //update scales to the new range\n    if (this.model.marker.axis_y.scaleType !== \"ordinal\") {\n      this.yScale.range(this._rangeBump([this.height, 0]));\n    } else {\n      this.yScale.rangePoints([this.height, 0], _this.activeProfile.padding).range();\n    }\n    if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n      this.xScale.range(this._rangeBump([0, this.width]));\n    } else {\n      this.xScale.rangePoints([0, this.width], _this.activeProfile.padding).range();\n    }\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.height,\n        formatter: this.model.marker.axis_y.getTickFormatter()\n      });\n\n    this.xAxis.scale(this.xScale)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.width,\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.bubbleContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.xAxisElContainer\n      .attr(\"width\", this.width + 1)\n      .attr(\"height\", this.activeProfile.margin.bottom + this.height)\n      .attr(\"y\", -1)\n      .attr(\"x\", -1);\n    this.xAxisEl\n      .attr(\"transform\", \"translate(1,\" + (1 + this.height) + \")\");\n\n    this.yAxisElContainer\n      .attr(\"width\", this.activeProfile.margin.left + this.width)\n      .attr(\"height\", Math.max(0, this.height))\n      .attr(\"x\", -this.activeProfile.margin.left);\n    this.yAxisEl\n      .attr(\"transform\", \"translate(\" + (this.activeProfile.margin.left - 1) + \",\" + 0 + \")\");\n\n    this.yAxisEl.call(this.yAxis);\n    this.xAxisEl.call(this.xAxis);\n\n    this.projectionX.attr(\"y1\", _this.yScale.range()[0] + this.activeProfile.maxRadiusPx / 2);\n    this.projectionY.attr(\"x2\", _this.xScale.range()[0] - this.activeProfile.maxRadiusPx / 2);\n\n\n    // reduce font size if the caption doesn't fit\n    this._updateSTitle();\n    this.sTitleEl\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + 20 + \") rotate(-90)\");\n\n    if (layoutProfile !== \"small\") {\n      this.ySubTitleEl.select(\"text\").attr(\"dy\", infoElHeight * 0.6).text(this.strings.subtitle.Y);\n      this.xSubTitleEl.select(\"text\").attr(\"dy\", -infoElHeight * 0.3).text(this.strings.subtitle.X);\n      \n      this.yTitleEl.select(\"text\").text(this.strings.title_short.Y + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"\");\n      this.xTitleEl.select(\"text\").text(this.strings.title_short.X + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"\");\n    } else {\n      this.ySubTitleEl.select(\"text\").text(\"\");\n      this.xSubTitleEl.select(\"text\").text(\"\");\n\n      const yTitleText = this.yTitleEl.select(\"text\").text(this.strings.title.Y);\n      if (yTitleText.node().getBBox().width > this.width) yTitleText.text(this.strings.title_short.Y);\n    \n      const xTitleText = this.xTitleEl.select(\"text\").text(this.strings.title.X);\n      if (xTitleText.node().getBBox().width > this.width - 100) xTitleText.text(this.strings.title_short.X);      \n    }\n\n    const isRTL = this.model.locale.isRTL();\n    this.ySubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + 0 + \",\" + 0 + \") rotate(-90)\");\n    this.xSubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\");\n  \n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (-margin.left - this.activeProfile.yAxisTitleBottomMargin)  + \",\" + (this.height * 0.5) + \") rotate(-90)\"\n        : \n        \"translate(\" + (isRTL ? this.width : 10 - this.activeProfile.margin.left) + \", -\" + this.activeProfile.yAxisTitleBottomMargin + \")\")\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (this.width * 0.5) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\"\n        :\n        \"translate(\" + (isRTL ? this.width : 0) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\");\n    \n    this.xAxisGroupsEl\n      .style(\"font-size\", infoElHeight * 0.8 + \"px\");\n\n    if (this.yInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n      const vTranslate = isRTL ? (t.translateY + infoElHeight * 1.4 + titleBBox.width * 0.5) : (t.translateY - infoElHeight * 0.4 - titleBBox.width * 0.5);\n\n      this.yInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.yInfoEl.attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (t.translateX - infoElHeight * 0.8) + \",\" + vTranslate + \") rotate(-90)\"\n        :\n        \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this._resizeDataWarning();\n\n    this.model.ui.chart.margin.set(\"left\", margin.left * this.activeProfile.leftMarginRatio, false, false);\n  },\n\n\n  _updateDecorations(duration) {\n    const _this = this;\n    \n    // x axis groups used for incomes\n    const showxAxisGroups = this.model.ui.chart.decorations.xAxisGroups \n      && this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which] \n      && this.model.ui.chart.decorations.enabled\n      && this.getLayoutProfile() !== \"small\";\n    \n    this.xAxisGroupsEl.classed(\"vzb-invisible\", !showxAxisGroups);\n    if (showxAxisGroups) {\n      const axisGroupsData = this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which];\n      let xAxisGroups = this.xAxisGroupsEl.selectAll(\".vzb-bc-x-axis-group\").data(axisGroupsData);\n      \n      xAxisGroups.exit().remove();\n      xAxisGroups = xAxisGroups.enter().append(\"g\").attr(\"class\", \"vzb-bc-x-axis-group\")\n        .each(function(){\n          const view = d3.select(this);\n          view.append(\"text\").attr(\"class\", \"vzb-bc-x-axis-group-line\").text(\"\").style(\"text-anchor\",\"middle\");\n          view.append(\"text\").attr(\"class\", \"vzb-bc-x-axis-group-text\");\n        })\n        .merge(xAxisGroups);\n      \n      const xAxisGroups_calcs = [];\n      let useShorterLabels = false;\n      \n      // first pass: calculate label text sizes and margins\n      xAxisGroups.each(function(d, i){\n        const view = d3.select(this);\n        \n        const text = view.select(\"text.vzb-bc-x-axis-group-text\")\n          .text(_this.translator(d.label));\n        \n        const calcs = {min: d.min, max: d.max};\n        \n        calcs.textHeight = text.node().getBBox().height;\n        calcs.textWidth = text.node().getBBox().width;\n        \n        calcs.boundaryMinX_px = _this.xScale(d.min || d.min === 0? d.min : d3.min(_this.xScale.domain()));\n        calcs.boundaryMaxX_px = _this.xScale(d.max || d.max === 0? d.max : d3.max(_this.xScale.domain()));\n        \n        calcs.centerX_px = (calcs.boundaryMinX_px + calcs.boundaryMaxX_px) / 2;\n        calcs.marginX_px = (Math.abs(calcs.boundaryMinX_px - calcs.boundaryMaxX_px) - calcs.textWidth) / 2;\n        \n        if (calcs.marginX_px - calcs.textHeight < 0) useShorterLabels = true;\n        \n        xAxisGroups_calcs[i] = calcs;\n      });\n      \n      // second pass: if at least one of labels doesn't fit, switch to compact mode and recalculate text sizes and margins\n      if (useShorterLabels) {\n        xAxisGroups.each(function(d, i){\n          const view = d3.select(this);\n\n          const text = view.select(\"text.vzb-bc-x-axis-group-text\")\n            .text(_this.translator(d.label_short));\n\n          const calcs = xAxisGroups_calcs[i];\n\n          calcs.textWidth = text.node().getBBox().width;\n          calcs.marginX_px = (Math.abs(calcs.boundaryMinX_px - calcs.boundaryMaxX_px) - calcs.textWidth) / 2;\n\n          xAxisGroups_calcs[i] = calcs;\n        });\n      }\n      \n      // third pass: actually put labels in places\n      xAxisGroups.each(function(d, i){\n        const view = d3.select(this);\n        \n        const isFirst = (i == 0);\n        const isLast = (i == xAxisGroups_calcs.length - 1);\n        const calcs = xAxisGroups_calcs[i];\n        const minMargin = calcs.textHeight/4;\n        let x = calcs.centerX_px;\n        \n        if (isFirst) x = xAxisGroups_calcs[i+1].boundaryMinX_px - Math.max(xAxisGroups_calcs[i+1].marginX_px, minMargin);\n        if (isLast) x = xAxisGroups_calcs[i-1].boundaryMaxX_px + Math.max(xAxisGroups_calcs[i-1].marginX_px, minMargin);\n        \n        const text = view.select(\"text.vzb-bc-x-axis-group-text\")\n          .transition()\n          .duration(duration || 0)\n          .style(\"text-anchor\", isFirst ? \"end\" : isLast ? \"start\" : \"middle\")\n          .attr(\"dy\", \"-0.2em\")\n          .attr(\"y\", calcs.textHeight)\n          .attr(\"x\", x);\n        \n        view.select(\"text.vzb-bc-x-axis-group-line\")\n          .classed(\"vzb-invisible\", isLast)\n          .transition()\n          .duration(duration || 0)\n          .attr(\"dy\", \"-0.2em\")\n          .attr(\"y\", calcs.textHeight * 0.9)\n          .attr(\"x\", calcs.boundaryMaxX_px);\n      })\n    }\n    \n    \n    // diagonal line that is used when the same idicator ID is used for both axis X and Y\n    const showLineEqualXY = \n      this.model.marker.axis_x.which == this.model.marker.axis_y.which \n      && this.model.ui.chart.decorations.enabled\n      && this.getLayoutProfile() !== \"small\";\n    \n    this.lineEqualXY.classed(\"vzb-invisible\", !showLineEqualXY);\n    if (showLineEqualXY) {\n      const min = d3.min(this.yScale.domain().concat(this.xScale.domain()));\n      const max = d3.max(this.yScale.domain().concat(this.xScale.domain()));\n\n      this.lineEqualXY\n        .transition()\n        .duration(duration || 0)\n        .attr(\"y1\", this.yScale(min))\n        .attr(\"y2\", this.yScale(max))\n        .attr(\"x1\", this.xScale(min))\n        .attr(\"x2\", this.xScale(max));\n    }\n  },\n\n  _resizeDataWarning() {\n    // reset font size to remove jumpy measurement\n    const dataWarningText = this.dataWarningEl.select(\"text\").style(\"font-size\", null);\n\n    // reduce font size if the caption doesn't fit\n    const dataWarningWidth = dataWarningText.node().getBBox().width + dataWarningText.node().getBBox().height * 3;\n    const remainingWidth = this.width - this.xTitleEl.node().getBBox().width - this.activeProfile.infoElHeight;\n    const font = parseInt(dataWarningText.style(\"font-size\")) * remainingWidth / dataWarningWidth;\n    dataWarningText.style(\"font-size\", dataWarningWidth > remainingWidth ? font + \"px\" : null);\n\n    // position the warning icon\n    const warnBB = dataWarningText.node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height * 0.75)\n      .attr(\"height\", warnBB.height * 0.75)\n      .attr(\"x\", -warnBB.width - warnBB.height * 1.2)\n      .attr(\"y\", -warnBB.height * 0.65);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\"\n        + (this.model.locale.isRTL() ? warnBB.width + warnBB.height : this.width) + \",\"\n        + (this.height + this.activeProfile.margin.bottom - this.activeProfile.xAxisTitleBottomMargin)\n        + \")\");\n  },\n\n  updateMarkerSizeLimits() {\n    const _this = this;\n    const extent = this.model.marker.size.extent || [0, 1];\n\n    if (!this.activeProfile) return utils.warn(\"updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data\");\n\n    let minRadius = this.activeProfile.minRadiusPx;\n    let maxRadius = this.activeProfile.maxRadiusPx;\n\n    let minArea = utils.radiusToArea(Math.max(maxRadius * extent[0], minRadius));\n    let maxArea = utils.radiusToArea(Math.max(maxRadius * extent[1], minRadius));\n\n    let range = minArea === maxArea? [minArea, maxArea] :\n      d3.range(minArea, maxArea, (maxArea - minArea)/this.sScale.domain().length).concat(maxArea);\n\n    this.sScale.range(range);\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.entityBubbles) return utils.warn(\"redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!\");\n\n    let valuesNow;\n    const dataKeys = this.dataKeys = this.model.marker.getDataKeysPerHook();\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueC = selected ? valuesNow.color[utils.getKey(d, dataKeys.color)] : valuesLocked.color[utils.getKey(d, dataKeys.color)];\n\n        const scaledC = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n\n        d3.select(this).style(\"fill\", scaledC);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledC0 = scaledC;\n            } else {\n              const valueC = valuesTrailStart.color[utils.getKey(d, dataKeys.color)];\n              cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n            }\n\n            _this._labels.updateLabelOnlyColor(d, index, cache);\n\n          });\n        }\n      });\n    });\n\n  },\n\n  redrawDataPointsOnlySize() {\n    const _this = this;\n\n    let valuesNow;\n    const dataKeys = this.dataKeys = this.model.marker.getDataKeysPerHook();\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueS = selected ? valuesNow.size[utils.getKey(d, dataKeys.size)] : valuesLocked.size[utils.getKey(d, dataKeys.size)];\n        if (valueS == null) return;\n\n        const scaledS = utils.areaToRadius(_this.sScale(valueS));\n        d3.select(this).attr(\"r\", scaledS);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledS0 = scaledS;\n            } else {\n              cache.scaledS0 = utils.areaToRadius(_this.sScale(valuesTrailStart.size[utils.getKey(d, dataKeys.size)]));\n            }\n\n            _this._labels.updateLabelOnlyPosition(d, index, cache);\n\n          });\n        }\n      });\n    });\n  },\n\n  /*\n   * REDRAW DATA POINTS:\n   * Here plotting happens\n   * debouncing to improve performance: events might trigger it more than 1x\n   */\n  redrawDataPoints(duration) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (duration == null) duration = _this.duration;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      const time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n\n      //get values for locked frames\n      this.model.marker.getFrame(time, lockedFrame => {\n        if (!lockedFrame) return utils.warn(\"redrawDataPoints: empty data received from marker.getFrames(). doing nothing\");\n\n        // each bubble\n        _this.entityBubbles.each(function(d, index) {\n          const frame = _this.model.marker.isSelected(d) ? _this.frame : lockedFrame;\n          _this._updateBubble(d, frame, index, d3.select(this), duration);\n        });\n      });\n    } else {\n      // each bubble\n      _this.entityBubbles.each(function(d, index) {\n        _this._updateBubble(d, _this.frame, index, d3.select(this), duration);\n      });\n    }\n\n    this._updateDecorations(duration);\n  },\n\n  //redraw Data Points\n  _updateBubble(d, values, index, view, duration) {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n    \n    let showhide = false;\n\n    const valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n    const valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n    const valueS = values.size[utils.getKey(d, dataKeys.size)];\n    const valueL = values.label[utils.getKey(d, dataKeys.label)];\n    const valueC = values.color[utils.getKey(d, dataKeys.color)];\n    const valueLST = values.size_label[utils.getKey(d, dataKeys.size_label)];\n\n    // check if fetching data succeeded\n    if (!valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) {\n      // if entity is missing data it should hide\n      if (!d.hidden) {\n        d.hidden = true;\n        showhide = true;\n      }\n\n      if (showhide) {\n        if (duration) {\n          const opacity = view.style(\"opacity\");\n          view.transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", 0)\n            .on(\"end\", () => {\n              //to avoid transition from null state add class with a delay\n              view.classed(\"vzb-invisible\", d.hidden);\n              view.style(\"opacity\", opacity);\n            });\n        } else {\n          //immediately hide the bubble\n          view.classed(\"vzb-invisible\", d.hidden);\n        }\n      }\n    } else {\n      if (d.hidden || view.classed(\"vzb-invisible\")) {\n        d.hidden = false;\n        showhide = true;\n      }\n\n\n      // if entity has all the data we update the visuals\n      const scaledS = utils.areaToRadius(_this.sScale(valueS));\n\n      view.style(\"fill\", valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH);\n\n      if (duration) {\n        if (showhide) {\n          const opacity = view.style(\"opacity\");\n          view.classed(\"vzb-invisible\", d.hidden);\n          view.style(\"opacity\", 0)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS)\n            .transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", opacity);\n        } else {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS);\n        }\n\n      } else {\n\n        //interrupt the ongoing transition and immediately do the visual updates\n        view.interrupt()\n          .attr(\"cy\", _this.yScale(valueY))\n          .attr(\"cx\", _this.xScale(valueX))\n          .attr(\"r\", scaledS)\n          .transition();\n\n        //show entity if it was hidden\n        if (showhide) view.classed(\"vzb-invisible\", d.hidden);\n      }\n\n      if (this.model.time.record) _this._export.write({\n        type: \"circle\",\n        id: d[KEY],\n        time: this.model.time.value.getUTCFullYear(),\n        fill: valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cx: _this.xScale(valueX),\n        cy: _this.yScale(valueY),\n        r: scaledS\n      });\n\n    } // data exists\n    _this._updateLabel(d, index, values, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide);\n  },\n\n  _updateLabel(d, index, values, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide) {\n    const _this = this;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n    // only for selected markers\n    if (_this.model.marker.isSelected(d)) {\n\n      const cache = {};\n\n      const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n      const time = _this.model.time.formatDate(_this.time);\n      if (!this.model.ui.chart.trails || select.trailStartTime == time || select.trailStartTime == null) {\n        if (this.model.ui.chart.trails && select.trailStartTime == null) select.trailStartTime = time; // need only when trailStartTime == null\n\n        cache.labelX0 = valueX;\n        cache.labelY0 = valueY;\n        cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_this.sScale(valueS)) : null;\n      }\n\n      const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n      const labelText = _this._getLabelText(values, d, select.trailStartTime);\n\n      if (showhide && d.hidden && _this.model.ui.chart.trails && trailStartTime && (trailStartTime < _this.time)) showhide = false;\n      if (d.hidden && !_this.model.ui.chart.trails) showhide = true;\n\n      this._labels.updateLabel(d, index, cache, valueX, valueY, valueS, valueC, labelText, valueLST, duration, showhide);\n\n    }\n  },\n\n  _getLabelText(values, d, time) {\n    return this.model.marker.getCompoundLabelText(d, values)\n      + (time && (this.model.time.start - this.model.time.end !== 0) ? \" \" + time : \"\");\n  },\n\n  _setTooltip(tooltipText, x, y, s, c, d) {\n    if (tooltipText) {\n      const labelValues = {};\n      if (d) {\n        const dataKeys = this.dataKeys;\n        const values = this.frame;\n        labelValues.valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n        labelValues.valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n        labelValues.valueS = values.size[utils.getKey(d, dataKeys.size)];\n        labelValues.valueC = values.color[utils.getKey(d, dataKeys.color)];\n        labelValues.valueLST = values.size_label[utils.getKey(d, dataKeys.size_label)];\n        labelValues.labelText = this._getLabelText(values, d, this.model.time.formatDate(this.time));\n      }\n\n      const tooltipCache = {};\n      tooltipCache.labelX0 = this.xScale.invert(x);\n      tooltipCache.labelY0 = this.yScale.invert(y);\n      tooltipCache.scaledS0 = s;\n      tooltipCache.scaledC0 = null;\n\n      this._labels.setTooltip(d, tooltipText, tooltipCache, labelValues);\n    } else {\n      this._labels.setTooltip();\n    }\n  },\n\n  _formatSTitleValues(titleS, titleC) {\n    const _this = this;\n    const unitS = this.strings.unit.S;\n    const unitC = this.strings.unit.C;\n\n    const formatterS = this.model.marker.size.getTickFormatter();\n    const formatterC = this.model.marker.color.getTickFormatter();\n\n    //resolve labels for colors via the color legend\n    if (this.model.marker.color.isDiscrete() && this.model.marker.color.use !== \"constant\" && titleC && this.model.marker.color.getColorlegendMarker()) {\n      titleC = this.model.marker.color.getColorlegendMarker().label.getItems()[titleC] || \"\";\n    }\n\n    return [formatterS(titleS) + \" \" + unitS,\n      titleC || titleC === 0 ? formatterC(titleC) + \" \" + unitC : this.translator(\"hints/nodata\")];\n  },\n\n  _updateSTitle(titleS, titleC) {\n\n    // vertical text about size and color\n    if (this.activeProfile.hideSTitle\n      && this.model.ui.dialogs.sidebar.indexOf(\"colors\") > -1\n      && this.model.ui.dialogs.sidebar.indexOf(\"size\") > -1) {\n      this.sTitleEl.classed(\"vzb-invisible\", true);\n      return;\n    }\n    if (this.sTitleEl.classed(\"vzb-invisible\")) {\n      this.sTitleEl.classed(\"vzb-invisible\", false);\n    }\n    const sTitleContentON = this.model.marker.size.use !== \"constant\";\n    const cTitleContentON = this.model.marker.color.use !== \"constant\";\n    const sTitleText = this.sTitleEl.select(\"text\")\n    // reset font size to remove jumpy measurement\n      .style(\"font-size\", null)\n      .text(\n        (sTitleContentON ? this.translator(\"buttons/size\") + \": \" + (titleS ? titleS : this.strings.title.S) : \"\") +\n        (sTitleContentON && cTitleContentON ? \", \" : \"\") +\n        (cTitleContentON ? this.translator(\"buttons/colors\") + \": \" + (titleC ? titleC : this.strings.title.C) : \"\")\n      );\n    const sTitleWidth = sTitleText.node().getBBox().width;\n    const remainigHeight = this.height - 30;\n    const font = parseInt(sTitleText.style(\"font-size\")) * remainigHeight / sTitleWidth;\n    sTitleText.style(\"font-size\", sTitleWidth > remainigHeight ? font + \"px\" : null);\n  },\n\n  selectDataPoints() {\n    const _this = this;\n    const KEY = this.KEY;\n\n    if (utils.isTouchDevice()) {\n      _this.model.marker.clearHighlighted();\n      _this._labels.showCloseCross(null, false);\n    } else {\n      //hide tooltip\n      _this._setTooltip();\n      _this._setBubbleCrown();\n    }\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n  },\n\n  _setBubbleCrown(x, y, r, glow, skipInnerFill) {\n    if (x != null) {\n      this.bubbleCrown.classed(\"vzb-hidden\", false);\n      this.bubbleCrown.select(\".vzb-crown\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r)\n        .attr(\"fill\", skipInnerFill ? \"none\" : glow);\n      this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r + 10)\n        .attr(\"stroke\", glow);\n\n    } else {\n      this.bubbleCrown.classed(\"vzb-hidden\", true);\n    }\n\n  },\n\n  /*\n   * Shows and hides axis projections\n   */\n  _axisProjections(d) {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const dataKeys = this.dataKeys;\n\n    if (d != null) {\n\n      this.model.marker.getFrame(d[TIMEDIM], values => {\n        const valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n        const valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n        const valueS = values.size[utils.getKey(d, dataKeys.size)];\n        const radius = utils.areaToRadius(_this.sScale(valueS));\n\n        if (!valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) return;\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineX\n          && _this.xScale(valueX) > 0 && _this.xScale(valueX) < _this.width\n          && (_this.yScale(valueY) + radius) < _this.height) {\n          _this.projectionX\n            .style(\"opacity\", 1)\n            .attr(\"y2\", _this.yScale(valueY) + radius)\n            .attr(\"x1\", _this.xScale(valueX))\n            .attr(\"x2\", _this.xScale(valueX));\n        }\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineY\n          && _this.yScale(valueY) > 0 && _this.yScale(valueY) < _this.height\n          && (_this.xScale(valueX) - radius) > 0) {\n          _this.projectionY\n            .style(\"opacity\", 1)\n            .attr(\"y1\", _this.yScale(valueY))\n            .attr(\"y2\", _this.yScale(valueY))\n            .attr(\"x1\", _this.xScale(valueX) - radius);\n        }\n\n        if (_this.model.ui.chart.whenHovering.higlightValueX) _this.xAxisEl.call(\n          _this.xAxis.highlightValue(valueX)\n        );\n\n        if (_this.model.ui.chart.whenHovering.higlightValueY) _this.yAxisEl.call(\n          _this.yAxis.highlightValue(valueY)\n        );\n      });\n\n    } else {\n\n      this.projectionX.style(\"opacity\", 0);\n      this.projectionY.style(\"opacity\", 0);\n      this.xAxisEl.call(this.xAxis.highlightValue(\"none\"));\n      this.yAxisEl.call(this.yAxis.highlightValue(\"none\"));\n\n    }\n\n  },\n\n  /*\n   * Highlights all hovered bubbles\n   */\n  highlightDataPoints() {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const dataKeys = this.dataKeys;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    this.updateBubbleOpacity();\n\n    if (this.model.marker.highlight.length === 1) {\n      const d = utils.clone(this.model.marker.highlight[0]);\n      d[KEY] = utils.getKey(d, KEYS);\n\n      if (_this.model.ui.chart.lockNonSelected && _this.someSelected && !_this.model.marker.isSelected(d)) {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + _this.model.ui.chart.lockNonSelected);\n      } else {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + d.trailStartTime) || _this.time;\n      }\n\n      _this.model.marker.getFrame(d[TIMEDIM], values => {\n        if (!values) return;\n        const x = _this.xScale(values.axis_x[utils.getKey(d, dataKeys.axis_x)]);\n        const y = _this.yScale(values.axis_y[utils.getKey(d, dataKeys.axis_y)]);\n        const s = utils.areaToRadius(_this.sScale(values.size[utils.getKey(d, dataKeys.size)]));\n        const c = values.color[utils.getKey(d, dataKeys.color)] != null ? _this.cScale(values.color[utils.getKey(d, dataKeys.color)]) : _this.COLOR_WHITEISH;\n        let entityOutOfView = false;\n\n        const titles = _this._formatSTitleValues(values.size[utils.getKey(d, dataKeys.size)], values.color[utils.getKey(d, dataKeys.color)]);\n        _this._updateSTitle(titles[0], titles[1]);\n        if (x + s < 0 || x - s > _this.width || y + s < 0 || y - s > _this.height) {\n          entityOutOfView = true;\n        }\n\n        //show tooltip\n        let text = \"\";\n        let hoverTrail = false;\n        if (_this.model.marker.isSelected(d) && _this.model.ui.chart.trails) {\n          text = _this.model.time.formatDate(_this.time);\n          const selectedData = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n          hoverTrail = text !== selectedData.trailStartTime && !d3.select(d3.event.target).classed(\"bubble-\" + d[KEY]);\n          text = text !== selectedData.trailStartTime && _this.time === d[TIMEDIM] ? text : \"\";\n        } else {\n          text = _this.model.marker.isSelected(d) ? \"\" : _this._getLabelText(values, d);\n        }\n\n        _this._labels.highlight(null, false);\n        _this._labels.highlight(d, true);\n        if (_this.model.marker.isSelected(d)) {\n          const skipCrownInnerFill = !d.trailStartTime || d.trailStartTime == _this.model.time.formatDate(_this.time);\n          _this._setBubbleCrown(x, y, s, c, skipCrownInnerFill);\n        }\n\n        if (!entityOutOfView && !hoverTrail) {\n          _this._axisProjections(d);\n        }\n\n        //set tooltip and show axis projections\n        if (text && !entityOutOfView && !hoverTrail) {\n          _this._setTooltip(text, x, y, s + 3, c, d);\n        }\n\n        const selectedData = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n        if (selectedData) {\n          const clonedSelectedData = utils.clone(selectedData);\n          //change opacity to OPACITY_HIGHLT = 1.0;\n          clonedSelectedData.opacity = 1.0;\n          _this._trails.run([\"opacityHandler\"], clonedSelectedData);\n        }\n      });\n    } else {\n      this._axisProjections();\n      this._trails.run([\"opacityHandler\"]);\n      //hide tooltip\n      _this._updateSTitle();\n      this._setTooltip();\n      this._setBubbleCrown();\n      this._labels.highlight(null, false);\n    }\n\n  },\n\n  _blinkSuperHighlighted() {\n    this.entityBubbles\n      .classed(\"vzb-super-highlighted\", d => this.model.marker.isSuperHighlighted(d));\n  },\n\n  updateBubbleOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.entityBubbles\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.entityBubbles.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BubbleChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","const { utils } = Vizabi;\n\nconst PanZoom = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.dragRectangle = d3.drag();\n    this.zoomer = d3.zoom();\n\n    // this.dragLock = false;\n\n    this.dragRectangle\n      .subject(this.dragSubject())\n      .on(\"start\", this.drag().start)\n      .on(\"drag\", this.drag().go)\n      .on(\"end\", this.drag().stop);\n\n    this.zoomer\n      .filter(this.zoomFilter())\n      .scaleExtent([0.0625, +Infinity])\n      .on(\"start\", this.zoom().start)\n      .on(\"zoom\", this.zoom().go)\n      .on(\"end\", this.zoom().stop);\n\n    this.zoomer.ratioX = 1;\n    this.zoomer.ratioY = 1;\n\n    context._zoomedXYMinMax = {\n      axis_x: { zoomedMin: null, zoomedMax: null },\n      axis_y: { zoomedMin: null, zoomedMax: null }\n    };\n  },\n\n  dragSubject() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      /*\n       * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n       * not enabled. Also do not drag if zoom-pinching on touchmove\n       * events.\n       */\n      if (!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        _this.ui.cursorMode === \"plus\") || (_this.ui.cursorMode === \"minus\") ||\n        (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        return null;\n      }\n\n      return {\n        x: d3.mouse(this)[0],\n        y: d3.mouse(this)[1]\n      };\n    };\n  },\n\n  drag() {\n    const _this = this.context;\n    const self = this;\n\n    return {\n      start(d, i) {\n        /*\n         * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n         * not enabled. Also do not drag if zoom-pinching on touchmove\n         * events.\n         */\n        //   if(!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        //          _this.ui.cursorMode === \"plus\") ||\n        //          (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //          (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //         return;\n        //     }\n\n        // self.dragLock = true;\n        this.origin = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        _this.zoomRect.classed(\"vzb-invisible\", false);\n      },\n\n      go(d, i) {\n        /*\n         * Cancel drag if drag lock is false, or when zoom-pinching via\n         * touchmove events.\n         */\n        // if (!self.dragLock || (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //             (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n\n        //   _this.zoomRect\n        //     .attr(\"width\", 0)\n        //     .attr(\"height\", 0)\n        //     .classed(\"vzb-invisible\", true);\n\n        //   return;\n        // }\n\n        const origin = this.origin;\n        const mouse = {\n          x: d3.event.x,\n          y: d3.event.y\n        };\n\n        _this.zoomRect\n          .attr(\"x\", Math.min(mouse.x, origin.x))\n          .attr(\"y\", Math.min(mouse.y, origin.y))\n          .attr(\"width\", Math.abs(mouse.x - origin.x))\n          .attr(\"height\", Math.abs(mouse.y - origin.y));\n      },\n\n      stop(e) {\n        // if (!self.dragLock) return;\n        // self.dragLock = false;\n\n        _this.zoomRect\n          .attr(\"width\", 0)\n          .attr(\"height\", 0)\n          .classed(\"vzb-invisible\", true);\n\n        this.target = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        if (Math.abs(this.origin.x - this.target.x) < 10 || Math.abs(this.origin.y - this.target.y) < 10) return;\n\n        /*\n         * Only compensate for dragging when the Ctrl key or Meta key\n         * are pressed, or if the cursorMode is not in plus mode.\n         */\n        const compensateDragging = d3.event.sourceEvent.ctrlKey ||\n          d3.event.sourceEvent.metaKey ||\n          _this.ui.cursorMode === \"plus\";\n\n        self._zoomOnRectangle(\n          d3.select(this),\n          this.origin.x,\n          this.origin.y,\n          this.target.x,\n          this.target.y,\n          compensateDragging, 500\n        );\n      }\n    };\n  },\n  zoomFilter() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      const event = d3.event;\n\n      if (event.ctrlKey || event.metaKey) return false;\n\n      // Cancel drag lock when zoom-pinching via touchmove events.\n      if ((event.type === \"touchmove\" || event.type === \"touchstart\") &&\n        (event.touches.length > 1 || event.targetTouches.length > 1)) return true;\n\n      if ((event.type === \"wheel\" || event.type === \"mousewheel\") &&\n        _this.ui.zoomOnScrolling) {\n        // if (_this.scrollableAncestor) {\n        //   _this.scrollableAncestor.scrollTop -= (event.deltaY || -event.wheelDelta);\n        // }\n        // d3.event.scale = null;\n        //zoomer.scale(this.savedScale);\n        return true;\n      }\n\n      if ((event.type === \"mousedown\" || event.type === \"touchstart\") &&\n        (_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\") &&\n        (_this.ui.panWithArrow || _this.ui.cursorMode === \"hand\")) return true;\n\n      return false;\n    };\n  },\n  zoom() {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const self = this;\n\n    return {\n      start() {\n        //this.savedScale = zoomer.scale;\n        if ((_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\")) {\n          _this.chartSvg.classed(\"vzb-zooming\", true);\n        }\n\n        _this.model._data.marker.clearHighlighted();\n        _this._setTooltip();\n\n      },\n      go() {\n\n        const sourceEvent = d3.event.sourceEvent;\n\n        //if (sourceEvent != null && (sourceEvent.ctrlKey || sourceEvent.metaKey)) return;\n\n        // Cancel drag lock when zoom-pinching via touchmove events.\n        // if (sourceEvent !== null &&\n        //             (sourceEvent.type === \"touchmove\" || sourceEvent.type === \"touchstart\") &&\n        //             (sourceEvent.touches.length > 1 || sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n        // }\n\n        //if (self.dragLock) return;\n\n        //send the event to the page if fully zoomed our or page not scrolled into view\n//\n//                    if(d3.event.scale == 1)\n//\n//                    if(utils.getViewportPosition(_this.element.node()).y < 0 && d3.event.scale > 1) {\n//                        _this.scrollableAncestor.scrollTop += d3.event.sourceEvent.deltaY;\n//                        return;\n//                    }\n        /*\n         * Do not zoom on the chart if the scroll event is a wheel\n         * scroll. Instead, redirect the scroll event to the scrollable\n         * ancestor\n         */\n        // if (sourceEvent != null && (sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") &&\n        //             !_this.ui.zoomOnScrolling) {\n        //   if (_this.scrollableAncestor) {\n        //     _this.scrollableAncestor.scrollTop += (sourceEvent.deltaY || -sourceEvent.wheelDelta);\n        //   }\n        //   d3.event.scale = null;\n        //             //zoomer.scale(this.savedScale);\n        //   this.quitZoom = true;\n        //   return;\n        // }\n        // this.quitZoom = false;\n\n        //_this.model._data.marker.clearHighlighted();\n        //_this._setTooltip();\n\n        //var transform = d3.zoomTransform(self.zoomSelection.node())\n        //  .translate(, )\n        //.scale(d3.event.transform.k);\n        let zoom = d3.event.transform.k;\n\n        let pan = [d3.event.transform.x, d3.event.transform.y];//d3.event.translate;\n        let ratioY = zoomer.ratioY;\n        let ratioX = zoomer.ratioX;\n\n        _this.draggingNow = true;\n\n        //value protections and fallbacks\n        if (isNaN(zoom) || zoom == null) zoom = zoomer.scale;\n        if (isNaN(zoom) || zoom == null) zoom = 1;\n\n        //TODO: this is a patch to fix #221. A proper code review of zoom and zoomOnRectangle logic is needed\n        /*\n         * Mouse wheel and touchmove events set the zoom value\n         * independently of axis ratios. If the zoom event was triggered\n         * by a mouse wheel event scrolling down or touchmove event with\n         * more than 1 contact that sets zoom to 1, then set the axis\n         * ratios to 1 as well, which will fully zoom out.\n         */\n        if (zoom === 1 && sourceEvent !== null &&\n          ((sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") && (sourceEvent.deltaY || -sourceEvent.wheelDelta) > 0 ||\n          sourceEvent.type === \"touchmove\" && sourceEvent.touches.length > 1)) {\n          zoomer.ratioX = 1;\n          ratioX = 1;\n          zoomer.ratioY = 1;\n          ratioY = 1;\n        }\n\n//                if(isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = zoomer.translate();\n        if (isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = [0, 0];\n\n        // limit the zooming, so that it never goes below min value of zoom for any of the axes\n        const minZoomScale = zoomer.scaleExtent()[0];\n        if (zoom * ratioY < minZoomScale) {\n          ratioY = minZoomScale / zoom;\n          zoomer.ratioY = ratioY;\n        }\n        if (zoom * ratioX < minZoomScale) {\n          ratioX = minZoomScale / zoom;\n          zoomer.ratioX = ratioX;\n        }\n\n        const zoomXOut = zoom * ratioX < 1;\n        const zoomYOut = zoom * ratioY < 1;\n\n        //limit the panning, so that we are never outside the possible range\n        if (!zoomXOut) {\n          if (pan[0] > 0) pan[0] = 0;\n          if (pan[0] < (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        } else {\n          if (pan[0] < 0) pan[0] = 0;\n          if (pan[0] > (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        }\n\n        if (!zoomYOut) {\n          if (pan[1] > 0) pan[1] = 0;\n          if (pan[1] < (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        } else {\n          if (pan[1] < 0) pan[1] = 0;\n          if (pan[1] > (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        }\n\n        //limit zoom translate\n        self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        const xPanOffset = _this.width * zoom * ratioX;\n        const yPanOffset = _this.height * zoom * ratioY;\n\n        const xRange = [0 * zoom * ratioX + pan[0], xPanOffset + pan[0]];\n        const yRange = [yPanOffset + pan[1], 0 * zoom * ratioY + pan[1]];\n\n        const xRangeBumped = _this._rangeBump(xRange);\n        const yRangeBumped = _this._rangeBump(yRange);\n\n        /*\n         * Shift xRange and yRange by the difference between the bumped\n         * ranges, which is scaled by the zoom factor. This accounts for\n         * the range bump, which controls a gutter around the\n         * bubblechart, while correctly zooming.\n         */\n        const xRangeMinOffset = (xRangeBumped[0] - xRange[0]) * zoom * ratioX;\n        const xRangeMaxOffset = (xRangeBumped[1] - xRange[1]) * zoom * ratioX;\n\n        const yRangeMinOffset = (yRangeBumped[0] - yRange[0]) * zoom * ratioY;\n        const yRangeMaxOffset = (yRangeBumped[1] - yRange[1]) * zoom * ratioY;\n\n        xRange[0] += xRangeMinOffset;\n        xRange[1] += xRangeMaxOffset;\n\n        yRange[0] += yRangeMinOffset;\n        yRange[1] += yRangeMaxOffset;\n\n        // Calculate the maximum xRange and yRange available.\n        const xRangeBounds = [0, _this.width];\n        const yRangeBounds = [_this.height, 0];\n\n        const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n        const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n        /*\n         * Set the pan to account for the range bump by subtracting\n         * offsets and preventing panning past the range bump gutter.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] < xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] > xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] > yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] < yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        }\n\n        //zoomer.translate = pan;\n        //self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        /*\n         * Clamp the xRange and yRange by the amount that the bounds\n         * that are range bumped.\n         *\n         * Additionally, take the amount clamped on the end of the range\n         * and either subtract or add it to the range's other end. This\n         * prevents visible stretching of the range when only panning.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) {\n            xRange[1] -= Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] < xRangeBoundsBumped[1]) {\n            xRange[0] += Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) {\n            xRange[1] += Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] > xRangeBoundsBumped[1]) {\n            xRange[0] -= Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) {\n            yRange[1] += Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] > yRangeBoundsBumped[1]) {\n            yRange[0] -= Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) {\n            yRange[1] -= Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] < yRangeBoundsBumped[1]) {\n            yRange[0] += Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        }\n\n        if (_this.model.marker.axis_x.scaleType === \"ordinal\") {\n          _this.xScale.rangeBands(xRange);\n        } else {\n          _this.xScale.range(xRange);\n        }\n\n        if (_this.model.marker.axis_y.scaleType === \"ordinal\") {\n          _this.yScale.rangeBands(yRange);\n        } else {\n          _this.yScale.range(yRange);\n        }\n\n        const formatter = function(n) {\n          return utils.isDate(n) ? n : +n.toFixed(2);\n        };\n\n        const zoomedXRange = xRangeBoundsBumped;\n        const zoomedYRange = yRangeBoundsBumped;\n\n        /*\n         * Set the zoomed min/max to the correct value depending on if the\n         * min/max values lie within the range bound regions.\n         */\n        /*\n         if(!zoomXOut) {\n         zoomedXRange[0] = xRangeBounds[0] > xRange[0] ? xRangeBounds[0] : xRange[0];\n         zoomedXRange[1] = xRangeBounds[1] < xRange[1] ? xRangeBounds[1] : xRange[1];\n         }\n\n         if(!zoomYOut) {\n         zoomedYRange[0] = yRangeBounds[0] < yRange[0] ? yRangeBounds[0] : yRange[0];\n         zoomedYRange[1] = yRangeBounds[1] > yRange[1] ? yRangeBounds[1] : yRange[1];\n         }\n         */\n\n        _this._zoomedXYMinMax = {\n          axis_x: {\n            zoomedMin: formatter(_this.xScale.invert(zoomedXRange[0])),\n            zoomedMax: formatter(_this.xScale.invert(zoomedXRange[1]))\n          },\n          axis_y: {\n            zoomedMin: formatter(_this.yScale.invert(zoomedYRange[0])),\n            zoomedMax: formatter(_this.yScale.invert(zoomedYRange[1]))\n          }\n        };\n\n\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, null, false /*avoid storing it in URL*/);\n\n        const optionsY = _this.yAxis.labelerOptions();\n        const optionsX = _this.xAxis.labelerOptions();\n        optionsY.limitMaxTickNumber = zoom * ratioY < 1.5 ? 8 : zoom * ratioY * 8;\n        optionsX.limitMaxTickNumber = zoom * ratioX < 1.5 ? 8 : zoom * ratioX * 8;\n        optionsY.transitionDuration = zoomer.duration;\n        optionsX.transitionDuration = zoomer.duration;\n\n        _this.xAxisEl.call(_this.xAxis.labelerOptions(optionsX));\n        _this.yAxisEl.call(_this.yAxis.labelerOptions(optionsY));\n        _this.redrawDataPoints(zoomer.duration);\n        _this._trails.run(\"resize\", null, zoomer.duration);\n\n        zoomer.duration = 0;\n      },\n\n      stop() {\n        _this.chartSvg.classed(\"vzb-zooming\", false);\n\n        _this.draggingNow = false;\n\n        // if (this.quitZoom) return;\n\n        //Force the update of the URL and history, with the same values\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, true, true);\n        zoomer.dontFeedToState = null;\n      }\n    };\n  },\n\n  expandCanvas(duration) {\n    const _this = this.context;\n    if (!duration) duration = _this.duration;\n\n    //d3 extent returns min and max of the input array as [min, max]\n    const mmX = d3.extent(utils.values(_this.frame.axis_x));\n    const mmY = d3.extent(utils.values(_this.frame.axis_y));\n\n    //protection agains unreasonable min-max results -- abort function\n    if (!mmX[0] && mmX[0] !== 0 || !mmX[1] && mmX[1] !== 0 || !mmY[0] && mmY[0] !== 0 || !mmY[1] && mmY[1] !== 0) {\n      return utils.warn(\"panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action\");\n    }\n    /*\n     * Use a range bumped scale to correctly accommodate the range bump\n     * gutter.\n     */\n    const suggestedFrame = {\n      x1: _this.xScale(mmX[0]),\n      y1: _this.yScale(mmY[0]),\n      x2: _this.xScale(mmX[1]),\n      y2: _this.yScale(mmY[1])\n    };\n    const xBounds = [0, _this.width];\n    const yBounds = [_this.height, 0];\n\n    // Get the current zoom frame based on the current dimensions.\n    const frame = {\n      x1: xBounds[0],\n      x2: xBounds[1],\n      y1: yBounds[0],\n      y2: yBounds[1]\n    };\n\n    const TOLERANCE = 0.0;\n\n    /*\n     * If there is no current zoom frame, or if any of the suggested frame\n     * points extend outside of the current zoom frame, then expand the\n     * canvas.\n     */\n    if (!_this.isCanvasPreviouslyExpanded ||\n      suggestedFrame.x1 < frame.x1 * (1 - TOLERANCE) || suggestedFrame.x2 > frame.x2 * (1 + TOLERANCE) ||\n      suggestedFrame.y2 < frame.y2 * (1 - TOLERANCE) || suggestedFrame.y1 > frame.y1 * (1 + TOLERANCE)) {\n      /*\n       * If there is already a zoom frame, then clamp the suggested frame\n       * points to only zoom out and expand the canvas.\n       *\n       * If any of x1, x2, y1, or y2 is within the current frame\n       * boundaries, then clamp them to the frame boundaries. If any of\n       * the above values will translate into a data value that is outside\n       * of the possible data range, then clamp them to the frame\n       * coordinate that corresponds to the maximum data value that can\n       * be displayed.\n       */\n      if (_this.isCanvasPreviouslyExpanded) {\n        /*\n         * Calculate bounds and bumped scale for calculating the data boundaries\n         * to which the suggested frame points need to be clamped.\n         */\n        const xBoundsBumped = _this._rangeBump(xBounds);\n        const yBoundsBumped = _this._rangeBump(yBounds);\n\n        if (suggestedFrame.x1 > xBoundsBumped[0]) suggestedFrame.x1 = xBoundsBumped[0];\n        if (suggestedFrame.x2 < xBoundsBumped[1]) suggestedFrame.x2 = xBoundsBumped[1];\n        if (suggestedFrame.y1 < yBoundsBumped[0]) suggestedFrame.y1 = yBoundsBumped[0];\n        if (suggestedFrame.y2 > yBoundsBumped[0]) suggestedFrame.y2 = yBoundsBumped[1];\n      }\n\n      _this.isCanvasPreviouslyExpanded = true;\n      this._zoomOnRectangle(_this.element, suggestedFrame.x1, suggestedFrame.y1,\n        suggestedFrame.x2, suggestedFrame.y2, false, duration);\n    } else {\n      _this.redrawDataPoints(duration);\n    }\n  },\n\n  zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, duration, dontFeedToState) {\n    const _this = this.context;\n    let minX = zoomedMinX;\n    let maxX = zoomedMaxX;\n    let minY = zoomedMinY;\n    let maxY = zoomedMaxY;\n\n    const xDomain = _this.xScale.domain();\n    const yDomain = _this.yScale.domain();\n\n    /*\n     * Prevent zoomout if only one of zoom edges set outside domain\n     */\n    if (minX < xDomain[0] && maxX < xDomain[1]) minX = xDomain[0];\n    if (minX > xDomain[0] && maxX > xDomain[1]) maxX = xDomain[1];\n    if (minY < yDomain[0] && maxY < yDomain[1]) minY = yDomain[0];\n    if (minY > yDomain[0] && maxY > yDomain[1]) maxY = yDomain[1];\n\n\n    const xRange = [_this.xScale(minX), _this.xScale(maxX)];\n    const yRange = [_this.yScale(minY), _this.yScale(maxY)];\n\n\n    this._zoomOnRectangle(_this.element, xRange[0], yRange[0], xRange[1], yRange[1], false, duration, dontFeedToState);\n  },\n\n  _zoomOnRectangle(element, zoomedX1, zoomedY1, zoomedX2, zoomedY2, compensateDragging, duration, dontFeedToState) {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    const x1 = zoomedX1;\n    const y1 = zoomedY1;\n    const x2 = zoomedX2;\n    const y2 = zoomedY2;\n\n    /*\n     * When dragging to draw a rectangle, the translate vector has (x2 - x1)\n     * added to zoomer.translate()[0], and (y2 - 1) added to\n     * zoomer.translate()[1].\n     *\n     * We need to compensate for this addition when\n     * zooming with a rectangle, because zooming with a rectangle will\n     * update the translate vector with new values based on the rectangle\n     * dimensions.\n     */\n    if (compensateDragging) {\n      transform.translate(\n        x1 - x2,\n        y1 - y2\n      );\n      // zoomer.translate([\n      //     zoomer.translate()[0] + x1 - x2,\n      //     zoomer.translate()[1] + y1 - y2\n      // ]);\n    }\n\n    const xRangeBounds = [0, _this.width];\n    const yRangeBounds = [_this.height, 0];\n\n    const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n    const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n    const minZoom = zoomer.scaleExtent()[0];\n    const maxZoom = zoomer.scaleExtent()[1];\n    let zoom, ratioX, ratioY;\n\n    if (x1 == x2 || y1 == y2 || xRangeBoundsBumped[0] == xRangeBoundsBumped[1] || yRangeBoundsBumped[0] == yRangeBoundsBumped[1]) {\n      return utils.warn(\"_zoomOnRectangle(): can not proceed because this may result in infinity zooms\");\n    }\n\n    if (Math.abs(x1 - x2) > Math.abs(y1 - y2)) {\n      zoom = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioY *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioX = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k / zoom * zoomer.ratioX;\n      ratioY = zoomer.ratioY;\n    } else {\n      zoom = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioX *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioY = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k / zoom * zoomer.ratioY;\n      ratioX = zoomer.ratioX;\n    }\n\n    const pan = [\n      (transform.x - Math.min(x1, x2)) / transform.k / zoomer.ratioX * zoom * ratioX + (xRangeBoundsBumped[0] - xRangeBounds[0]),\n      (transform.y - Math.min(y1, y2)) / transform.k / zoomer.ratioY * zoom * ratioY + (yRangeBoundsBumped[1] - yRangeBounds[1])\n    ];\n\n    zoomer.dontFeedToState = dontFeedToState;\n    //zoomer.scale(zoom);\n    zoomer.ratioY = ratioY || 1; //NaN defaults to 1\n    zoomer.ratioX = ratioX || 1; //NaN defaults to 1\n    //zoomer.translate(pan);\n    zoomer.duration = duration ? duration : 0;\n\n    //zoomer.event(element);\n    this.zoomSelection.call(zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n  },\n\n  /*\n   * Incrementally zoom in or out and pan the view so that it never looses the point where click happened\n   * this function is a modified d3's own zoom behavior on double click\n   * for the original code see https://github.com/mbostock/d3/blob/master/src/behavior/zoom.js\n   * function dblclicked() and what it refers to\n   */\n  zoomByIncrement(direction, duration) {\n    const _this = this.context;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    let ratio = transform.k;\n    const pan = [transform.x, transform.y];\n\n    const mouse = d3.mouse(this.zoomSelection.node());\n    let k = Math.log(ratio) / Math.LN2;\n\n    //change factor direction based on the input. default is no direction supplied\n    if (direction == \"plus\" || !direction) k = Math.floor(k) + 1;\n    if (direction == \"minus\") k = Math.ceil(k) - 1;\n\n    //decode panning\n    let locus = [(mouse[0] - pan[0]) / ratio, (mouse[1] - pan[1]) / ratio];\n\n    //recalculate zoom ratio\n    const scaleExtent = this.zoomer.scaleExtent();\n    if (ratio == scaleExtent[0]) {\n      this.zoomer.ratioY = 1;\n      this.zoomer.ratioX = 1;\n    }\n    ratio = Math.max(scaleExtent[0], Math.min(scaleExtent[1], Math.pow(2, k)));\n\n    //recalculate panning\n    locus = [locus[0] * ratio + pan[0], locus[1] * ratio + pan[1]];\n    pan[0] += mouse[0] - locus[0];\n    pan[1] += mouse[1] - locus[1];\n\n    //save changes to the zoom behavior and run the event\n    //this.zoomer.scale(ratio);\n    //this.zoomer.translate([pan[0], pan[1]]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(_this.element);\n    this.zoomSelection.call(this.zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(ratio));\n\n  },\n\n\n  /*\n   * Reset zoom values without triggering a zoom event.\n   */\n  resetZoomState(element) {\n    //this.zoomer.scaleTo(element, 1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    (element || this.zoomSelection).property(\"__zoom\", d3.zoomIdentity);\n  },\n\n  reset(element, duration) {\n    const _this = this.context;\n    _this.isCanvasPreviouslyExpanded = false;\n\n    //this.zoomer.scale(1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.transform, d3.zoomIdentity);\n  },\n\n  rerun(element) {\n    const _this = this.context;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.scaleBy, 1);\n  },\n\n  zoomSelection(element) {\n    this.zoomSelection = element;\n  }\n\n});\n\nexport default PanZoom;\n\n\n// WEBPACK FOOTER //\n// ./src/panzoom.js","\nimport cssEscape from \"css.escape\";\n\nconst { utils } = Vizabi;\n\nconst Trail = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n    this._isCreated = null;\n    this.actionsQueue = {};\n    this.entityTrails = {};\n    this.trailsData = [];\n    this.trailsInProgress = {};\n    this.activePromises = {};\n    this.trailTransitions = {};\n    this.delayedIterations = {};\n    this.drawingQueue = {};\n  },\n\n  toggle(arg) {\n    const _context = this.context;\n    if (arg) {\n\n      _context._trails.create().then(() => {\n        _context._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      });\n    } else {\n      _context._trails.run(\"remove\");\n      _context.model.marker.select.forEach(d => {\n        delete d.trailStartTime;\n      });\n    }\n  },\n\n  create(selection) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    const TIMEDIM = _context.TIMEDIM;\n    this._isCreated = new Promise((resolve, reject) => {\n      //quit if the function is called accidentally\n      if (!_context.model.ui.chart.trails) return;\n\n      const timePoints = _context.model.time.getAllSteps();\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      const promises = [];\n      selection = selection == null ? _context.model.marker.select : [selection];\n      _this._clearActions(selection);\n      _this.trailsData = _context.model.marker.select.map(d => {\n        const r = {\n          status: \"created\",\n          selectedEntityData: d\n        };\n        KEYS.forEach(key => r[key] = d[key]);\n        r[KEY] = utils.getKey(d, KEYS);\n        return r;\n      });\n      _this.trailTransitions = {};\n      const _trails = _context.bubbleContainer.selectAll(\"g.vzb-bc-entity.entity-trail\")\n        .data(_this.trailsData, d => (d[KEY]));\n\n      _trails.exit().remove();\n      _trails.enter()\n        .insert(\"g\", function(d) {\n          return this.querySelector(\".bubble-\" + cssEscape(d[KEY]));\n        })\n        .attr(\"class\", d => \"vzb-bc-entity entity-trail trail-\" + d[KEY])\n        .merge(_trails)\n        .each(function(d, index) {\n          // used for prevent move trail start time forward when we have empty values at end of time range\n          const trail = this;\n          promises.push(new Promise((resolve, reject) => {\n            const trailSegmentData = timePoints.map(m => ({\n              t: m,\n              key: d[KEY]\n            }));\n            const entityTrails = d3.select(trail).selectAll(\"g\")\n              .data(trailSegmentData)\n              .classed(\"vzb-invisible\", true);\n\n            entityTrails.exit().remove();\n\n            _this.entityTrails[d[KEY]] = entityTrails.enter().append(\"g\")\n              .attr(\"class\", \"vzb-bc-trailsegment vzb-invisible\")\n              .on(\"mouseover\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n\n                const pointer = {};\n                pointer[KEY] = segment.key;\n                pointer[TIMEDIM] = segment.t;\n\n                _context._axisProjections(pointer);\n                _context._labels.highlight(d, true);\n                const text = _context.model.time.formatDate(segment.t);\n                const selectedData = utils.find(_context.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n                _context.model.marker.getFrame(pointer[TIMEDIM], values => {\n                  const x = _context.xScale(values.axis_x[utils.getKey(d, dataKeys.axis_x)]);\n                  const y = _context.yScale(values.axis_y[utils.getKey(d, dataKeys.axis_y)]);\n                  const s = utils.areaToRadius(_context.sScale(values.size[utils.getKey(d, dataKeys.size)]));\n                  const c = values.color[utils.getKey(d, dataKeys.color)] != null ? _context.cScale(values.color[utils.getKey(d, dataKeys.color)]) : _context.COLOR_WHITEISH;\n                  if (text !== selectedData.trailStartTime) {\n                    _context._setTooltip(text, x, y, s + 3, c);\n                  }\n                  _context._setBubbleCrown(x, y, s, c);\n                  _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", {\n                    \"size\": values.size[utils.getKey(d, dataKeys.size)],\n                    \"color\": values.color[utils.getKey(d, dataKeys.color)]\n                  });\n                });\n                //change opacity to OPACITY_HIGHLT = 1.0;\n                d3.select(this).style(\"opacity\", 1.0);\n              })\n              .on(\"mouseout\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n                _context._axisProjections();\n                _context._setTooltip();\n                _context._setBubbleCrown();\n                _context._labels.highlight(null, false);\n                _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", null);\n                d3.select(this).style(\"opacity\", _context.model.marker.opacityRegular);\n              })\n              .each(function(segment, index) {\n                const view = d3.select(this);\n                view.append(\"circle\");\n                view.append(\"line\");\n              })\n              .merge(entityTrails);\n            resolve();\n          }));\n        });\n      if (promises.length > 0) {\n        Promise.all(promises).then(segments => {\n          resolve(true);\n        });\n      } else {\n        resolve(true);\n      }\n    });\n    return this._isCreated;\n  },\n\n  /**\n   * add actions for each selected entities\n   * @param selections\n   * @param actions\n   * @private\n   */\n  _addActions(selections, actions) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n\n    selections.forEach(d => {\n      const key = utils.getKey(d, KEYS);\n      if (!_this.actionsQueue[key]) _this.actionsQueue[key] = [];\n      _this.actionsQueue[key] = [].concat(_this.actionsQueue[key].filter(value => actions.indexOf(value) == -1), actions);\n    });\n  },\n\n  _clearActions(selections) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    \n    selections.forEach(d => {\n      const key = utils.getKey(d, KEYS);\n      if (!_this.actionsQueue[key]) _this.actionsQueue[key] = [];\n      _this.actionsQueue[key] = [];\n      _this.drawingQueue[key] = {};\n      _this.delayedIterations[key] = {};\n      if (!_this.activePromises[key]) _this.activePromises[key] = [];\n      utils.forEach(_this.activePromises[key], (promise, key) => {\n        if (promise.status === \"pending\") promise.reject();\n      });\n      _this.trailsInProgress[key] = null;\n      _this.activePromises[key] = [];\n    });\n  },\n\n  _getNextAction(key) {\n    return this.actionsQueue[key].shift();\n  },\n\n  run(actions, selection, duration) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    if (!this._isCreated || _context.model.time.splash) return;\n    if (typeof actions === \"string\") actions = [actions];\n\n    this._isCreated.then(() => {\n      //quit if function is called accidentally\n      if ((!_context.model.ui.chart.trails || !_context.model.marker.select.length) && actions != \"remove\") return;\n\n      if (!duration) duration = 0;\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      selection = selection == null ? _context.model.marker.select : [selection];\n      for (let i = 0; i < actions.length; i++) {\n        if ([\"resize\", \"recolor\", \"remove\"].indexOf(actions[i]) != -1) {\n          const action = actions.splice(i, 1).pop();\n          --i;\n          _this.trailsData.forEach(d => {\n            const trail = _this.entityTrails[d[KEY]];\n            _context._trails[\"_\" + action](trail, duration, d);\n          });\n        }\n      }\n      if (actions.length == 0) {\n        return;\n      }\n      _this._addActions(selection, actions);\n      _this.trailsData.forEach(d => {\n        if (actions.indexOf(\"findVisible\") != -1) {\n          _this.drawingQueue[d[KEY]] = {};\n          _this.delayedIterations[d[KEY]] = {};\n        }\n        const trail = _this.entityTrails[d[KEY]];\n        //do all the actions over \"trail\"\n        const executeSequential = function(index) { // some function can be async, but we should run next when previous completed\n          const action = _this._getNextAction(d[KEY]);\n          if (action) {\n            _this.trailsInProgress[d[KEY]] = action;\n            const response = _context._trails[\"_\" + action](trail, duration, d);\n            if (response && response instanceof Promise) {\n              response.then(() => {\n                _this.trailsInProgress[d[KEY]] = null;\n                executeSequential(index + 1);\n              }, () => {\n                _this.trailsInProgress[d[KEY]] = null;\n              });\n            } else {\n              _this.trailsInProgress[d[KEY]] = null;\n              executeSequential(index + 1);\n            }\n          }\n        };\n        if (!_this.trailsInProgress[d[KEY]]) {\n          executeSequential(0);\n        }\n      });\n    });\n\n  },\n\n\n  _remove(trail, duration, d) {\n    this.actionsQueue[d[this.context.KEY]] = [];\n    if (trail) { // TODO: in some reason run twice\n      d3.select(this.entityTrails[d[this.context.KEY]].node().parentNode).remove();\n      this.entityTrails[d[this.context.KEY]] = null;\n    }\n  },\n\n  _resize(trail, duration, d) {\n    const _context = this.context;\n    if (_context.model.time.splash) {\n      return;\n    }\n//    this._isCreated.then(function() {\n    let updateLabel = false;\n\n    trail.each(function(segment, index) {\n\n      if (segment.valueY == null || segment.valueX == null || segment.valueS == null) return;\n\n      const view = d3.select(this);\n      if (duration) {\n        view.select(\"circle\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"circle\").interrupt()\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n\n      if (!updateLabel && !segment.transparent) {\n        updateLabel = true;\n        _context._labels.updateLabelOnlyPosition(d, null, { \"scaledS0\": utils.areaToRadius(_context.sScale(segment.valueS)) });\n      }\n\n      if (!segment.next) return;\n      const next = segment.next;\n      if (next == null) return;\n      if (next.valueY == null || next.valueX == null) return;\n\n      const lineLength = Math.sqrt(\n        Math.pow(_context.xScale(segment.valueX) - _context.xScale(next.valueX), 2) +\n        Math.pow(_context.yScale(segment.valueY) - _context.yScale(next.valueY), 2)\n      );\n      if (duration) {\n        view.select(\"line\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"line\").interrupt()\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n    });\n  },\n\n  _recolor(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n        //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n        _context.model.marker.color.getColorShade({\n          colorID: segment.valueC,\n          shadeID: \"shade\"\n        })\n        :\n        //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n        (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n      view.select(\"circle\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n      view.select(\"line\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"stroke\", strokeColor);\n    });\n  },\n\n  _opacityHandler(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      view\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"opacity\", d.opacity || _context.model.marker.opacityRegular);\n    });\n  },\n\n\n  _findVisible(trail, duration, d) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    return new Promise((resolve, reject) => {\n      new Promise((resolve1, reject1) => {\n        if (!d.limits) {\n          _context.model.marker.getEntityLimits(d[KEY]).then(limits => {\n            d.limits = limits;\n            resolve1();\n          });\n        } else {\n          resolve1();\n        }\n      }).then(() => {\n        if (!d.selectedEntityData.trailStartTime) {\n          d.selectedEntityData.trailStartTime = _context.model.time.formatDate(_context.time);\n        }\n        let trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n        if (_context.time - trailStartTime < 0 || d.limits.min - trailStartTime > 0) {\n          if (_context.time - trailStartTime < 0) {\n            // move trail start time with trail label back if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d3.max([_context.time, d.limits.min]));\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          } else {\n            // move trail start time with trail label to start time if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d.limits.min);\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          }\n          const cache = _context._labels.cached[d[KEY]];\n          const valueS = _context.frame.size[utils.getKey(d, dataKeys.size)];\n          const valueC = _context.frame.color[utils.getKey(d, dataKeys.color)];\n          cache.labelX0 = _context.frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          cache.labelY0 = _context.frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n          cache.scaledC0 = valueC != null ? _context.cScale(valueC) : _context.COLOR_WHITEISH;\n          _context._updateLabel(d, 0, _context.frame, cache.labelX0, cache.labelY0, valueS, valueC, _context.frame.label[utils.getKey(d, dataKeys.label)], _context.frame.size_label[utils.getKey(d, dataKeys.size_label)], 0, true);\n        }\n        trail.each((segment, index) => {\n          // segment is transparent if it is after current time or before trail StartTime\n          const segmentVisibility = segment.transparent;\n          segment.transparent = d.selectedEntityData.trailStartTime == null || (segment.t - _context.time > 0) || (trailStartTime - segment.t > 0)\n            //no trail segment should be visible if leading bubble is shifted backwards, beyond start time\n            || (d.selectedEntityData.trailStartTime - _context.model.time.formatDate(_context.time) >= 0);\n          // always update nearest 2 points\n          if (segmentVisibility != segment.transparent || Math.abs(_context.model.time.formatDate(segment.t) - _context.model.time.formatDate(_context.time)) < 2) segment.visibilityChanged = true; // segment changed, so need to update it\n          if (segment.transparent) {\n            d3.select(trail._groups[0][index]).classed(\"vzb-invisible\", segment.transparent);\n          }\n        });\n        _this.drawingQueue[d[KEY]] = {};\n        _this.delayedIterations[d[KEY]] = {};\n        resolve();\n      });\n    });\n  },\n\n  _abortAnimation() {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    _this.trailsData.forEach(d => {\n      if (_this.trailTransitions[d[KEY]]) {\n        _this.trailTransitions[d[KEY]].select(\"line\").interrupt().transition();\n      }\n    });\n  },\n\n  _reveal(trail, duration, d) {\n    const _context = this.context;\n    if(_context.model.time.playing) duration = _context.model.time.delay;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    d.status = \"reveal\";\n    const trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n    const generateTrailSegment = function(trail, index, nextIndex, level) {\n      return new Promise((resolve, reject) => {\n        const view = d3.select(trail._groups[0][index]);\n\n        const segment = view.datum();\n\n        //console.log(d[KEY] + \" transparent: \" + segment.transparent + \" vis_changed:\" + segment.visibilityChanged);\n        if (nextIndex - index == 1) {\n          if (segment.transparent) {\n            view.classed(\"vzb-invisible\", segment.transparent);\n            return resolve();\n          } else if (!segment.visibilityChanged) { // pass segment if it is not changed\n            return resolve();\n          }\n        }\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame) return resolve();\n          segment.valueY = frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          segment.valueX = frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          segment.valueS = frame.size[utils.getKey(d, dataKeys.size)];\n          segment.valueC = frame.color[utils.getKey(d, dataKeys.color)];\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            return resolve();\n          }\n\n          // fix label position if it not in correct place\n          if (trailStartTime && trailStartTime.toString() == segment.t.toString()) {\n            const cache = _context._labels.cached[d[KEY]];\n            cache.labelX0 = segment.valueX;\n            cache.labelY0 = segment.valueY;\n            const valueS = segment.valueS;\n            cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n            cache.scaledC0 = segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH;\n            _context._updateLabel(d, index, frame, segment.valueX, segment.valueY, segment.valueS, segment.valueC, frame.label[utils.getKey(d, dataKeys.label)], frame.size_label[utils.getKey(d, dataKeys.size_label)], 0, true);\n          }\n          view.select(\"circle\")\n          //.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _context.yScale(segment.valueY))\n            .attr(\"cx\", _context.xScale(segment.valueX))\n            .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n            .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n          view.select(\"line\")\n            .attr(\"x2\", _context.xScale(segment.valueX))\n            .attr(\"y2\", _context.yScale(segment.valueY))\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY));\n\n          // last point should have data for line but it is invisible\n          if (_context.time - segment.t > 0) {\n            segment.visibilityChanged = false;\n            view.classed(\"vzb-invisible\", segment.transparent);\n          } else {\n            view.classed(\"vzb-invisible\", true);\n          }\n\n          if (!trail._groups[0][nextIndex] || _context.time.toString() == segment.t.toString()) {\n            return resolve();\n          }\n\n          const next = d3.select(trail._groups[0][nextIndex]);\n          const nextSegment = next.datum();\n          nextSegment.previous = segment;\n          segment.next = nextSegment;\n          let nextTime = nextSegment.t;\n          if (_context.time - nextSegment.t < 0) { // time is not equal start of year\n            segment.visibilityChanged = true; // redraw needed next time because line not have full length\n            nextTime = _context.time;\n          }\n          _context.model.marker.getFrame(nextTime, nextFrame => {\n            if (d.status != \"reveal\") return resolve();\n            if (!nextFrame || segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n              return resolve();\n            }\n\n            if (nextFrame.axis_x[utils.getKey(d, dataKeys.axis_x)] == null || nextFrame.axis_y[utils.getKey(d, dataKeys.axis_y)] == null) {\n              return resolve();\n            }\n\n            nextSegment.valueY = nextFrame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n            nextSegment.valueX = nextFrame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n            nextSegment.valueS = nextFrame.size[utils.getKey(d, dataKeys.size)];\n            nextSegment.valueC = nextFrame.color[utils.getKey(d, dataKeys.color)];\n\n            _this.trailTransitions[d[KEY]] = view;\n            const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n              //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n              _context.model.marker.color.getColorShade({\n                colorID: segment.valueC,\n                shadeID: \"shade\"\n              })\n              :\n              //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n              (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n            const lineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextSegment.valueX), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextSegment.valueY), 2)\n            );\n            view.select(\"line\")\n              .attr(\"stroke-dasharray\", lineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor)\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY));\n            if (nextIndex - index > 1) {\n              addNewIntervals(index, nextIndex);\n              return resolve();\n            }\n            return resolve();\n          });\n        });\n      });\n    };\n    const addPointBetween = function(previousIndex, nextIndex, index) {\n      return new Promise((resolve, reject) => {\n        const previous = d3.select(trail._groups[0][previousIndex]);\n        const next = d3.select(trail._groups[0][nextIndex]);\n        const view = d3.select(trail._groups[0][index]);\n        const previousSegment = previous.datum();\n        const nextSegment = next.datum();\n        const segment = view.datum();\n\n        if ((!previousSegment.previous && !previousSegment.next) || (!nextSegment.previous && !nextSegment.next)) {\n          // segment data cleared by create action\n          return resolve();\n        }\n\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame ||\n            (typeof frame.axis_x === \"undefined\") || frame.axis_x[utils.getKey(d, dataKeys.axis_x)] == null ||\n            (typeof frame.axis_y === \"undefined\") || frame.axis_y[utils.getKey(d, dataKeys.axis_y)] == null) {\n            utils.warn(\"Frame for trail missed: \" + segment.t);\n            return resolve();\n          }\n          segment.valueY = frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          segment.valueX = frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          segment.valueS = frame.size[utils.getKey(d, dataKeys.size)];\n          segment.valueC = frame.color[utils.getKey(d, dataKeys.color)];\n\n          segment.previous = previousSegment;\n          segment.next = nextSegment;\n          previousSegment.next = segment;\n          nextSegment.previous = segment;\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            utils.warn(\"Data for trail point missed: \" + segment.t);\n            return resolve();\n          }\n\n          const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n            //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n            _context.model.marker.color.getColorShade({\n              colorID: segment.valueC,\n              shadeID: \"shade\"\n            })\n            :\n            //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n            (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n          const firstLineLength = Math.sqrt(\n            Math.pow(_context.xScale(previousSegment.valueX) - _context.xScale(segment.valueX), 2) +\n            Math.pow(_context.yScale(previousSegment.valueY) - _context.yScale(segment.valueX), 2)\n          );\n\n          previous.select(\"line\")\n            .transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY))\n            .attr(\"x2\", _context.xScale(previousSegment.valueX))\n            .attr(\"y2\", _context.yScale(previousSegment.valueY))\n            .attr(\"stroke-dasharray\", firstLineLength)\n            .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(previousSegment.valueS)))\n            .style(\"stroke\", strokeColor);\n\n          view.classed(\"vzb-invisible\", segment.transparent);\n\n          if (!segment.transparent) {\n            view.select(\"circle\")\n            //.transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"cy\", _context.yScale(segment.valueY))\n              .attr(\"cx\", _context.xScale(segment.valueX))\n              .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n            const secondLineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextSegment.valueX), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextSegment.valueY), 2)\n            );\n\n            view.select(\"line\")\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY))\n              .attr(\"stroke-dasharray\", secondLineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor);\n          }\n          addNewIntervals(previousIndex, index, nextIndex);\n          resolve();\n        });\n      });\n    };\n    const addNewIntervals = function(previousIndex, index, nextIndex) {\n      let mediumIndex;\n      if (index - previousIndex > 1) {\n        mediumIndex = getPointBetween(previousIndex, index);\n        _this.delayedIterations[d[KEY]][previousIndex] = {\n          first: previousIndex,\n          next: index,\n          medium: mediumIndex\n        };\n      }\n      if (nextIndex && nextIndex - index > 1) {\n        mediumIndex = getPointBetween(index, nextIndex);\n        _this.delayedIterations[d[KEY]][index] = {\n          first: index,\n          next: nextIndex,\n          medium: mediumIndex\n        };\n      }\n    };\n    const getPointBetween = function(previous, next) {\n      return Math.round(previous + (next - previous) / 2);\n    };\n\n    const _generateKeys = function(d, trail, div) {\n      const response = [];\n      let min = 0, max = 0;\n      const maxValue = d3.min([d.limits.max, _context.time]);\n      const minValue = d3.max([d.limits.min, _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime)]);\n      utils.forEach(trail._groups[0], (segment, index) => {\n        const data = segment.__data__;\n        if (data.t - minValue == 0) {\n          min = index;\n        } else if (data.t - maxValue == 0) {\n          max = index;\n        } else {\n          if (data.t > minValue && data.t < maxValue) {\n            if (_context.model.time.formatDate(data.t) % div == 0 || (data.next && data.previous)) {\n              response.push(index);\n            }\n          }\n        }\n      });\n      response.unshift(min);\n      if (max > 0) {\n        response.push(max);\n      }\n      return response;\n    };\n\n    const processPoints = function() {\n      return new Promise((resolve, reject) => {\n        const processPoint = function() {\n          const pointIndex = Object.keys(_this.drawingQueue[d[KEY]])[Math.floor(Math.random() * Object.keys(_this.drawingQueue[d[KEY]]).length)];\n          const point = JSON.parse(JSON.stringify(_this.drawingQueue[d[KEY]][pointIndex]));\n          delete _this.drawingQueue[d[KEY]][pointIndex];\n          addPointBetween(point.first, point.next, point.medium).then(() => {\n            if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n              processPoint();\n            } else {\n              resolve();\n            }\n          });\n        };\n        if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n          processPoint(_this.drawingQueue[d[KEY]]);\n        } else {\n          resolve();\n        }\n      });\n    };\n\n    return new Promise((resolve, reject) => {\n      /**\n       * iteration for each point from first segment to last\n       * @param trail\n       * @param index\n       */\n      const generateTrails = function(trail, index) {\n        if (index < 0 || index >= trail._groups[0].length) {\n          return resolve();\n        }\n        generateTrailSegment(trail, index, index + 1).then(() => {\n          generateTrails(trail, index + 1);\n        }, () => resolve());\n      };\n\n      /**\n       * recursive iteration for drawing point between points calculated in previous step\n       */\n      const processPointsBetween = function() {\n        processPoints().then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            return resolve();\n          }\n          _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n          _this.delayedIterations[d[KEY]] = {};\n          processPointsBetween();\n        }, () => resolve());\n      };\n\n      if (_context.model.marker.framesAreReady()) {\n        generateTrails(trail, 0);\n      } else {\n        _this.delayedIterations[d[KEY]] = {};\n        _this.drawingQueue[d[KEY]] = {};\n        const trailKeys = _generateKeys(d, trail, 50);\n        const segments = [];\n        if (trailKeys.length <= 1) {\n          return resolve();\n        }\n\n        _this.delayedIterations[d[KEY]] = {};\n        for (let i = 0; i < trailKeys.length - 1; i++) {\n          segments.push(generateTrailSegment(trail, trailKeys[i], trailKeys[i + 1], 1));\n        }\n        Promise.all(segments).then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            resolve();\n          } else {\n            _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n            _this.delayedIterations[d[KEY]] = {};\n            processPointsBetween();\n          }\n        }, () => {\n          resolve();\n        });\n      }\n    });\n  }\n});\n\nexport default Trail;\n\n\n\n// WEBPACK FOOTER //\n// ./src/trail.js","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: theres no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, []\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), []\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), []\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, []\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), []\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/css.escape/css.escape.js\n// module id = 4\n// module chunks = 0 1","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 5\n// module chunks = 0 1","module.exports = \"<!-- Bubble Chart Component -->\\n<div class=\\\"vzb-bubblechart\\\">\\n    <svg class=\\\"vzb-bubblechart-svg vzb-export\\\">\\n        <g class=\\\"vzb-bc-graph\\\">\\n            <g class=\\\"vzb-bc-year\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-axis-x\\\"><g></g></svg>\\n            <svg class=\\\"vzb-bc-axis-y\\\"><g></g></svg>\\n            <line class=\\\"vzb-bc-projection-x\\\"></line>\\n            <line class=\\\"vzb-bc-projection-y\\\"></line>\\n\\n            <svg class=\\\"vzb-bc-bubbles-crop\\\">\\n                <g class=\\\"vzb-zoom-selection\\\"></g>\\n                <g class=\\\"vzb-bc-decorations\\\">\\n                    <line class=\\\"vzb-bc-line-equal-xy vzb-invisible\\\"></line>\\n                    <g class=\\\"vzb-bc-x-axis-groups\\\"></g>\\n                </g>\\n                <rect class=\\\"vzb-bc-eventarea\\\"></rect>\\n                <g class=\\\"vzb-bc-trails\\\"></g>\\n                <g class=\\\"vzb-bc-bubbles\\\"></g>\\n                <g class=\\\"vzb-bc-lines\\\"></g>\\n                <g class=\\\"vzb-bc-bubble-crown vzb-hidden\\\">\\n                    <circle class=\\\"vzb-crown-glow\\\"></circle>\\n                    <circle class=\\\"vzb-crown\\\"></circle>\\n                </g>\\n            </svg>\\n\\n            <g class=\\\"vzb-bc-axis-y-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-s-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-c-title\\\"></g>\\n\\n            <g class=\\\"vzb-bc-axis-y-info vzb-noexport\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-labels-crop\\\">\\n                <g class=\\\"vzb-bc-labels\\\"></g>\\n            </svg>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <rect class=\\\"vzb-bc-zoom-rect\\\"></rect>\\n        </g>\\n    </svg>\\n    <svg>\\n        <defs>\\n            <filter id=\\\"vzb-glow-filter\\\" x=\\\"-50%\\\" y=\\\"-50%\\\" width=\\\"200%\\\" height=\\\"200%\\\">\\n                <feGaussianBlur in=\\\"SourceGraphic\\\" stdDeviation=\\\"2\\\"></feGaussianBlur>\\n            </filter>\\n        </defs>\\n    </svg>\\n    <!-- This could possibly be another component -->\\n    <div class=\\\"vzb-tooltip vzb-hidden vzb-tooltip-mobile\\\"></div>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 6\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 7\n// module chunks = 0 1"],"sourceRoot":""}